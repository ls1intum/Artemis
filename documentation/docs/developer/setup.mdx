import TumLiveVideo from "../../src/components/TumLiveVideo/TumLiveVideo";
import Callout from "../../src/components/Callout/Callout";
import {CalloutVariant} from "../../src/components/Callout/Callout.types";

# Setup Guide

This guide explains how to set up Artemis in your development environment or a demo production environment. For production setups, you would need to additionally consider topics discussed in the [Administration Setup](/admin/intro).

Running Artemis consists of two main steps:

1. **Set up the development environment** (see [Development Environment Setup](#development-environment-setup)).
2. **Set up Artemis** (see [Set up Artemis](#set-up-artemis)), which includes setting up optional but recommended features such as programming exercises. The installation guide provides two options for programming exercises, including version control and build system setup.

Artemis is based on [JHipster](https://jhipster.github.io), combining:

- [Spring Boot](http://projects.spring.io/spring-boot) (Java 25) for the application server.
- [Angular 21](https://angular.dev) (TypeScript) for the web application that serves the user interface.

To get an overview of the technology stack, visit the [JHipster Technology Stack](https://jhipster.github.io/tech-stack) and refer to other tutorials on the JHipster homepage.

---

## Development Environment Setup

Before installing Artemis, install and configure the following dependencies:

### Required Dependencies

1. **Java JDK 25**
   Download and install Java (e.g., from [Oracle JDK](https://www.oracle.com/java/technologies/javase-downloads.html))

2. **Database Server**
   Artemis uses Hibernate for database interactions and Liquibase for schema migrations.
   You can either use MySQL or PostgreSQL as the database server. See [Database Setup](#database-setup) for details.

3. **Node.js (LTS ≥ 24.7.0 < 25)**
   Download from [Node.js](https://nodejs.org/en/download).
   Required for compiling and running the Angular client.

4. **npm (≥ 11.5.1)**
   Installed automatically with Node.js but can be updated separately.

5. **Graphviz (Optional, but Recommended for Production Setups)**
   Install from [Graphviz](https://www.graphviz.org/download/) to enable graph generation in exercise descriptions.

<Callout variant={CalloutVariant.warning}>
    Missing Graphviz in production may cause rendering errors for exercise descriptions.
</Callout>

---

### IDE Setup

We recommend using [IntelliJ IDEA Ultimate](https://www.jetbrains.com/idea) for development.
Refer to JHipster's guide on configuring an IDE: [JHipster IDE Setup](https://jhipster.github.io/configuring-ide).

<Callout variant={CalloutVariant.info}>
    The Community Edition of IntelliJ IDEA lacks Spring Boot support. See the [comparison matrix](https://www.jetbrains.com/idea/features/editions_comparison_matrix.html) for details.
</Callout>

---

## Set up Artemis

Once the development environment is set up, the next step is to configure the Artemis server. This includes optional features such as programming exercises, which require a version control and build system.

Start by following the [Database Setup](#database-setup) guide, then proceed with [Server Setup](#server-setup) and [Client Setup](#client-setup).

---

## Database Setup

Artemis supports MySQL and PostgreSQL databases. The required Artemis schema is created or updated automatically when the server application starts.

### MySQL Setup

You can set up a MySQL database for Artemis using one of the following methods:

#### 1. Using Docker (Recommended)

The easiest way to set up a MySQL database for development is by using Docker.
Run the following command to start a MySQL database using the provided Docker Compose file:

```bash
docker compose -f docker/mysql.yml up
```

This method simplifies setup and management, making it ideal for development environments.

#### 2. Using a Local MySQL Installation

If you prefer to install MySQL locally, download and install the [MySQL Community Server (9.2.x)](https://dev.mysql.com/downloads/mysql) from the official MySQL website.

When running a local MySQL server, ensure the following settings for character encoding and collation:

- **character-set:** `utf8mb4`
- **collation:** `utf8mb4_unicode_ci`

These settings can be configured using a `my.cnf` file located in `/etc`:

```ini
[client]
default-character-set = utf8mb4
[mysql]
default-character-set = utf8mb4
[mysqld]
character-set-client-handshake = TRUE
init-connect='SET NAMES utf8mb4'
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
```

Ensure that MySQL loads this configuration file when starting the server.
For more details, refer to the official MySQL documentation: [MySQL Option Files](https://dev.mysql.com/doc/refman/9.2/en/option-files.html).

#### Users for MySQL

For the development environment, the default MySQL user is `root` with an empty password.
(In case you want to use a different password, make sure to change the value in `application-local.yml` *(spring > datasource > password)* and in `liquibase.gradle` *(within the 'liquibaseCommand' as argument password)*).

#### Set empty root password for MySQL 9

If you have problems connecting to the MySQL 9 database using an empty root password, you can try the following command to reset the root password to an empty password:

```bash
mysql -u root --execute "ALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY ''";
```

<Callout variant={CalloutVariant.warning}>
    Empty root passwords should only be used in a development environment. The root password for a production environment must never be empty.
</Callout>

### PostgreSQL Setup

No special PostgreSQL settings are required.
You can either use your package manager's version, or set it up using a container.
An example Docker Compose setup based on the [official container image](https://hub.docker.com/_/postgres) is provided in `docker/postgres.yml`.

When setting up the Artemis server, the following values need to be added/updated in the server configuration (see setup steps below) to connect to PostgreSQL instead of MySQL:

```yaml
spring:
    datasource:
        url: jdbc:postgresql://localhost:5432/Artemis?ssl=false
        username: Artemis
    jpa:
        database: POSTGRESQL
```

<Callout variant={CalloutVariant.info}>
    This example assumes that you use the mentioned Docker Compose file on your localhost, leading to a database called `Artemis` that runs on port `5432` and where no password is necessary. You might have to update `spring.datasource.url` if you use another configuration and set the password in `spring.datasource.password`.
</Callout>

---

## Server Setup

<Callout variant={CalloutVariant.info}>
    **First-time deployment checklist:**

    Before starting the Artemis server for the first time:

    1. **Database**: Ensure a database is running. See [Database Setup](#database-setup) for instructions.
    2. **Configuration**: Create `application-local.yml` in `src/main/resources/config` (see [Configuration Setup](#configuration-setup) below).
    3. **Deployment**: We recommend deploying **Artemis (Server, LocalVC & LocalCI)** for local development.
</Callout>

To start the Artemis application server from the development environment, first import the project into IntelliJ IDEA.
Make sure to install the **Spring Boot** plugins for IntelliJ IDEA, this will make it easier to run the server.

As an alternative, you may consider running the entire Artemis application using the Helios application. See [Setup with Helios](#setup-with-helios) for more details.

Before starting the application, update the required configuration settings.

### Configuration Setup

Configuration settings are stored in `application-artemis.yml` (located in `src/main/resources/config`).
However, **do not modify this file directly**, as it may lead to accidental commits of sensitive information.

Instead, follow these best practices:

1. **Create a custom configuration file**
    - In `src/main/resources/config`, create a new file named `application-local.yml`.
    - This file is used to override settings in application.yml for local development environments. It is configured to be ignored by Git to ensure that local configurations are not committed.

2. **Customize configuration settings**
    - If you want to change application properties, you should do that in `application-local.yml`.
    - If needed, you can modify values such as database credentials, authentication and application settings.

3. **Activate the correct profile**
    - When running Artemis, ensure the `local` profile is selected in the run configurations.
    - For additional custom configurations, create `application-<name>.yml` and activate the `<name>` profile.

### Common Configuration Options

For **development purposes, these settings are preconfigured, and no action is necessary** in this step.
You only need to modify them if your specific work or production environments require changes.

```yaml
artemis:
    repo-clone-path: ./repos/
    legal-path: ./legal/
    repo-download-clone-path: ./repos-download/
    bcrypt-salt-rounds: 11   # The number of salt rounds for bcrypt password hashing.
                             # Lower values improve speed but reduce security.
                             # Use the bcrypt benchmark tool to determine an optimal value: https://github.com/ls1intum/bcrypt-Benchmark

    user-management:
        use-external: true # enables ldap authentication
        password-reset:
            links:
                en: '<link>'
                de: '<link>'
        ldap:
            url: <url>
            user-dn: <user-dn>
            password: <password>
            base: <base>
            allowed-username-pattern: '^([a-z]{2}\d{2}[a-z]{3})$'    # example for a TUM identifier, e.g. ab12cde

    git:
        name: Artemis
        email: artemis@in.tum.de

    athena:
        # If you want to use Athena, refer to the dedicated configuration section. Under Administration Guide, Setup of Extension Services.
```

<Callout variant={CalloutVariant.info}>
    If you use a password for authentication, update it in `gradle/liquibase.gradle`.
</Callout>

### Version Control & Continuous Integration Setup

If you are setting up **programming exercises**, additional configuration is required for the version control and build system.
Refer to one of the following guides based on your preferred setup:

- **[Integrated Code Lifecycle Setup](#integrated-code-lifecycle-setup) (Recommended)**
- **[LocalVC + Jenkins Setup](jenkins-localvc)**

### Run the server via a run configuration in IntelliJ

The project comes with some pre-configured run / debug configurations that are stored in the `.idea` directory.
When you import the project into IntelliJ the run configurations will also be imported.

The recommended way is to run the server and the client separately. This provides fast rebuilds of the server and hot module replacement in the client.

- **Artemis (Client):** Will execute `npm install` and `npm run start`. The client will be available at [http://localhost:9000/](http://localhost:9000/) with hot module replacement enabled (also see [Client Setup](#client-setup)).
- **Artemis (Server, LocalVC & LocalCI):** The server will be started separated from the client with the profiles `dev,artemis,localci,localvc,scheduling,buildagent,core,ldap,local`.
- **Artemis (Server, LocalVC & Jenkins):** The server will be started separated from the client with the profiles `dev,jenkins,localvc,artemis,scheduling,core,local`.
- **Artemis (Server, LocalVC & LocalCI, Athena):** The server will be started separated from the client with the profiles `dev,localci,localvc,artemis,scheduling,athena,buildagent,core,local`.
- **Artemis (Server, LocalVC & LocalCI, Iris):** The server will be started separated from the client with the profiles `dev,localci,localvc,artemis,scheduling,iris,buildagent,core,local`.
- **Artemis (Server, LocalVC & LocalCI, Theia):** The server will be started separated from the client with the profiles `theia,dev,localci,localvc,artemis,scheduling,buildagent,core,ldap,local`.
- **Artemis (BuildAgent):** The server will be started separated from the client with the profiles `buildagent,local`. This configuration is used to run the build agent for the local CI. This configuration is rarely needed for development.
- **Artemis (Server, Prod, LocalCI):** The server will be started separated from the client with the profiles `prod,core,ldap,localvc,localci,scheduling,local`. This configuration is used for production-like testing.

<details>
<summary>Deprecated Options</summary>

- **Artemis (Server):** The server will be started separated from the client. The startup time decreases significantly.
- **Artemis (Server & Client):** Will start the server and the client. The client will be available at [http://localhost:8080/](http://localhost:8080/) with hot module replacement disabled.

</details>

### Run the server via Docker

<Callout variant={CalloutVariant.info}>
    This method provides a fast way to start Artemis for demonstration purposes. It is **not recommended** for development, as it does not support code modifications or debugging.
</Callout>

Artemis provides a Docker image named `ghcr.io/ls1intum/artemis:<TAG/VERSION>`:

- The **current develop branch** is available under the tag `develop`.
- The **latest stable release** can be retrieved using the tag `latest`.
- **Specific releases**, such as `7.10.8`, can be accessed with `ghcr.io/ls1intum/artemis:7.10.8`.
- **Branches tied to a pull request** can be obtained using `PR-<PR NUMBER>`.

#### Dockerfile

You can find the latest Artemis Dockerfile at `docker/artemis/Dockerfile`.

- The Dockerfile has [multiple stages](https://docs.docker.com/build/building/multi-stage/): A **builder** stage, building the `.war` file, an optional **external_builder** stage to import a pre-built `.war` file, a **war_file** stage to choose between the builder stages via build argument and a **runtime** stage with minimal dependencies just for running artemis.

- The Dockerfile defines three Docker volumes (at the specified paths inside the container):

    - **/opt/artemis/config:**

      This can be used to store additional configurations of Artemis in YAML files.
      The usage is optional, and we recommend using the environment files for overriding your custom configurations instead of using `src/main/resources/application-local.yml` as such an additional configuration file.
      The other configurations like `src/main/resources/application.yml`, ... are built into the `.war` file and therefore are not needed in this directory.

      <Callout variant={CalloutVariant.info}>
        Instead of mounting this config directory, you can also use environment variables for the configuration as defined by the [Spring relaxed binding](https://github.com/spring-projects/spring-boot/wiki/Relaxed-Binding-2.0#environment-variables). You can either place those environment variables directly in the `environment` section, or create a [.env-file](https://docs.docker.com/compose/environment-variables/set-environment-variables/#substitute-with-an-env-file). When starting an Artemis container directly with the Docker-CLI, an .env-file can also be given via the `--env-file` option. To ease the transition of an existing set of YAML configuration files into the environment variable style, a [helper script](https://github.com/b-fein/spring-yaml-to-env) can be used.
      </Callout>

    - **/opt/artemis/data:**

      This directory should be used for any data (e.g., local clone of repositories).
      This is preconfigured in the `docker` Java Spring profile (which sets the following values: `artemis.repo-clone-path`, `artemis.repo-download-clone-path`, `artemis.course-archives-path`, `artemis.submission-export-path` `artemis.legal-path`, and `artemis.file-upload-path`).

    - **/opt/artemis/public/content:**

      This directory will be used for branding. You can specify a favicon here.

- The Dockerfile assumes that the mounted volumes are located on a file system with the following locale settings (see [#4439](https://github.com/ls1intum/Artemis/issues/4439) for more details):

    - LC_ALL `en_US.UTF-8`
    - LANG `en_US.UTF-8`
    - LANGUAGE `en_US.UTF-8`

<Callout variant={CalloutVariant.warning}>
    **ARM64 Image builds** might run out of memory if not provided with enough memory and/or swap space.
    On an *Apple M1* we had to set the **Docker Desktop** memory limit to 12GB or more.
</Callout>

#### Debugging with Docker

The Docker containers have the possibility to enable Java Remote Debugging via Java environment variables.
Java Remote Debugging lets you use your preferred debugger connected to port 5005.
For IntelliJ, you can use the `Remote Java Debugging for Docker` profile shipped in the git repository.

With the following Java environment variable, you can configure the Remote Java Debugging inside a container:

```
_JAVA_OPTIONS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"
```

This is already pre-set in the Docker Compose **Artemis-Dev-MySQL** Setup.
For issues at the startup, you might have to suspend the java command until a Debugger is connected.
This is possible by setting `suspend=y`.

### Run the server with Spring Boot and Spring profiles

The Artemis server should startup by running the main class `de.tum.cit.aet.artemis.ArtemisApp` using Spring Boot.

<Callout variant={CalloutVariant.info}>
    Artemis uses Spring profiles to segregate parts of the application configuration and make it only available in certain environments. For development purposes, the following program arguments can be used to enable the `dev` profile and the profiles for Jenkins and LocalVC:
</Callout>

```
--spring.profiles.active=dev,jenkins,localvc,artemis,scheduling
```

If you use IntelliJ (Community or Ultimate) you can set the active profiles by:

- Choosing `Run | Edit Configurations...`
- Going to the `Configuration Tab`
- Expanding the `Environment` section to reveal `VM Options` and setting them to `-Dspring.profiles.active=dev,jenkins,localvc,artemis,scheduling`

#### Set Spring profiles with IntelliJ Ultimate

If you use IntelliJ Ultimate, add the following entry to the section `Active Profiles` (within `Spring Boot`) in the server run configuration:

```
dev,jenkins,localvc,artemis,scheduling
```

### Run the server with the command line (Gradle wrapper)

If you want to run the application via the command line instead, make sure to pass the active profiles to the `gradlew` command like this:

```bash
./gradlew bootRun --args='--spring.profiles.active=dev,jenkins,localvc,artemis,scheduling'
```

### Hyperion (Optional)

Hyperion provides AI-assisted exercise creation features via Spring AI. No external Edutelligence service is required, only a LLM provider such as OpenAI or Azure OpenAI.

<Callout variant={CalloutVariant.info}>
    For local development with LM Studio (no cloud API keys required), see the [Spring AI Development Guide](/developer/spring-ai).
</Callout>

For production setup, see [Hyperion Service](/admin/hyperion) in the Administration Guide for instructions on enabling the module in production and configuring LLM credentials.

---

## Client Setup

You need to install Node and npm on your local machine.

### Using IntelliJ

If you are using [IntelliJ](https://www.jetbrains.com/idea/download/) you can use the pre-configured `Artemis (Client)` run configuration that will be delivered with this repository:

- Choose `Run | Edit Configurations...`
- Select the `Artemis (Client)` configuration from the `npm section`
- Now you can run the configuration in the upper right corner of IntelliJ

### Using the command line

You should be able to run the following command to install development tools and dependencies. You will only need to run this command when dependencies change in `package.json`.

```bash
npm install
```

To start the client application in the browser, use the following command:

```bash
npm run start
```

This compiles TypeScript code to JavaScript code, starts the live reloading feature (i.e. whenever you change a TypeScript file and save, the client is automatically reloaded with the new code) and will start the client application in your browser on http://localhost:9000.
If you have configured `application-artemis.yml` correctly, then you should be able to login with your TUM Online account.

<Callout variant={CalloutVariant.info}>
    In case you encounter any problems regarding JavaScript heap memory leaks when executing `npm run start` or any other scripts from `package.json`, you can adjust a [memory limit parameter](https://nodejs.org/docs/latest-v24.x/api/cli.html#--max-old-space-sizesize-in-megabytes) (`node-options=--max-old-space-size=6144`) which is set by default in the project-wide `.npmrc` file. If you still face the issue, you can try to set a lower/higher value than 6144 MB. Recommended values are 3072 (3GB), 4096 (4GB), 5120 (5GB), 6144 (6GB), 7168 (7GB), and 8192 (8GB). You can override the project-wide `.npmrc` file by [using a per-user config file (~/.npmrc)](https://docs.npmjs.com/cli/v8/configuring-npm/npmrc). Make sure to **not commit changes** in the project-wide `.npmrc` unless the Github build also needs these settings.
</Callout>

For more information, review [Working with Angular](https://angular.dev/tutorials).
For further instructions on how to develop with JHipster, have a look at [Using JHipster in development](http://www.jhipster.tech/development).

---

## Common Setup Problems

### General Setup Problems

- Restarting IntelliJ with invalidated caches *(File > Invalidate Caches...)* might resolve the current issue.
- When facing issues with deep dependencies and changes were made to the `package.json` file, executing `npm install --force` might resolve the issue.
- When encountering a compilation error due to `invalid source release` make sure that you have set the Java version properly at 3 places:
  - File > Project Structure > Project Settings > Project > Project SDK
  - File > Project Structure > Project Settings > Project > Project Language Level
  - File > Settings > Build, Execution, Deployment > Build Tools > Gradle > Gradle JVM

### Database

- One typical problem in the development setup is that an exception occurs during the database initialization. Artemis uses [Liquibase](https://www.liquibase.org) to automatically upgrade the database scheme after the data model has changed. This ensures that the changes can also be applied to the production server. In case you encounter errors with Liquibase checksum values:
  - Run the following command in your terminal / command line: <br />
    ```./gradlew liquibaseClearChecksums```
  - You can manually adjust the checksum for a breaking changelog: <br />
    ```UPDATE `DATABASECHANGELOG` SET `MD5SUM` = NULL WHERE `ID` = '<changelogId>'```

### Client

- If you are using a machine with limited RAM *(e.g. ~8 GB RAM)* you might have issues starting the Artemis Client. You can resolve this by following the description in [Using the command line](#using-the-command-line).

---

## Production Setup and Extension Services

### Production Setup

A production setup of these core services might need further adaptation to ensure security.
For details on securing your production environment, see the [Administration Setup](/admin/intro).

### Extension Services

Artemis allows extension with several additional services, such as:

- Mobile notifications via **Hermes**
- Automatic feedback generation using large language models (e.g., **Iris/Athena**)
- And more...

The setup for these additional services is described as part of the [Extension Service Setup](/admin/extensions-setup).

---

## Setup with Helios

[Helios](https://helios.aet.cit.tum.de/) is an application that provides a well-designed UI for deploying various services the AET is building using GitHub Actions.
You can use Helios to deploy an Artemis test server without needing to set up the server and client manually.

This is particularly useful for:
- Quick deployment of test environments
- Deploying Artemis without local development setup
- Testing pull request branches in isolated environments

For detailed instructions on setting up Artemis with Helios, refer to the official [Helios User Guide](https://ls1intum.github.io/Helios/user_guide/deployments/testserver/).

<Callout variant={CalloutVariant.info}>
    If the above link is unavailable, go to the [Helios documentation homepage](https://ls1intum.github.io/Helios/) and navigate to **User Guide → Helios User Guide**.
</Callout>

---

## Additional Setup Guides

For more advanced setup scenarios and development tools, see the following guides:

- **[Jenkins and LocalVC Setup](/admin/production-setup/jenkins-localvc)** - Alternative CI/CD setup using Jenkins with LocalVC
- **[Aeolus Setup](/developer/aeolus)** - Custom build plans for Jenkins and Integrated Code Lifecycle
- **[OpenAPI and API-driven Development](/developer/openapi)** - Working with OpenAPI specifications
- **[Docker Compose Setup](/developer/docker-compose)** - Alternative Docker Compose-based deployment
- **[Docker Debugging](/developer/docker-debugging)** - Debugging Artemis in Docker containers
- **[Local Database Tests](/developer/local-database-tests)** - Running database tests locally
