name: 'E2E Test Report'
description: 'Download test results and generate JUnit report'

inputs:
  artifact-name:
    description: 'Name of the artifact to download'
    required: true
  download-path:
    description: 'Path to download the artifact to'
    required: true
  check-name:
    description: 'Name for the GitHub check run'
    required: true
  commit-sha:
    description: 'Commit SHA for the test report'
    required: true

outputs:
  summary:
    description: 'Test summary from JUnit report'
    value: ${{ steps.test-report.outputs.summary }}

runs:
  using: 'composite'
  steps:
    - name: Download test results
      if: success() || failure()
      uses: actions/download-artifact@v6
      continue-on-error: true
      with:
        name: ${{ inputs.artifact-name }}
        path: ${{ inputs.download-path }}

    - name: Generate Test Report
      id: test-report
      uses: mikepenz/action-junit-report@v6.3.0
      if: success() || failure()
      with:
        commit: ${{ inputs.commit-sha }}
        check_name: ${{ inputs.check-name }}
        fail_on_failure: false
        require_tests: false
        annotate_only: false
        detailed_summary: true
        include_time_in_summary: true
        report_paths: '${{ inputs.download-path }}/results.xml'
