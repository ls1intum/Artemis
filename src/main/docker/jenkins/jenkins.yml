# ----------------------------------------------------------------------------------------------------------------------
# Jenkins base service
# ----------------------------------------------------------------------------------------------------------------------

services:
    jenkins:
        container_name: artemis-jenkins
        build: .
        user: root
        volumes:
            - artemis-jenkins-data:/var/jenkins_home
            - ./jenkins-disable-csrf.groovy:/var/jenkins_home/init.groovy # Disable CSRF token
            - ./master-key-only-for-testing.key:/var/jenkins_home/master.key # Preset master key to use pre-generated secrets
            - ./jenkins-casc-config.yml:/usr/share/jenkins/ref/jenkins-casc-config.yml:ro
            - /var/run/docker.sock:/var/run/docker.sock
            - /usr/bin/docker:/usr/bin/docker:ro
        ports:
            - "8082:8080"
        networks:
            - artemis
        environment:
            - CASC_JENKINS_CONFIG=/usr/share/jenkins/ref/jenkins-casc-config.yml
            - JAVA_OPTS

networks:
    artemis:
        driver: "bridge"
        name: artemis
volumes:
    artemis-jenkins-data:
        name: artemis-jenkins-data
