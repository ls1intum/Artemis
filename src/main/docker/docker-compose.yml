services:
    artemis-app:
        platform: linux/x86_64
        image: ghcr.io/ls1intum/artemis
        build:
            context: ../../..
            dockerfile: src/main/docker/artemis/Dockerfile
        volumes:
            - ../resources/config/application-dev.yml:/opt/artemis/application-dev.yml:ro
            - ../resources/config/application-artemis.yml:/opt/artemis/application-artemis.yml:ro
            - ./scripts/wait-for-it.sh:/usr/local/bin/wait-for-it.sh
        environment:
            _JAVA_OPTIONS: -Xmx5120m -Xms2560m
            SPRING_PROFILES_ACTIVE: dev,bamboo,bitbucket,jira,artemis,scheduling,athene,local
            SPRING_DATASOURCE_URL: jdbc:mysql://artemis-mysql:3306/Artemis?createDatabaseIfNotExist=true&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=utf8&useSSL=false&useLegacyDatetimeCode=false&serverTimezone=UTC
            SPRING_DATASOURCE_USERNAME: root
            SPRING_DATASOURCE_PASSWORD:
            JHIPSTER_SLEEP: 30 # gives time for other services to boot before the application
        command: /bin/bash -c '/usr/local/bin/wait-for-it.sh -t 0 artemis-mysql:3306 -- /run_artemis.sh'
        ports:
            - 8080:8080
        networks:
            - artemis
        depends_on:
            - artemis-mysql
    artemis-mysql:
        extends:
            file: mysql.yml
            service: artemis-mysql

networks:
    artemis:
        driver: "bridge"
volumes:
    artemis-mysql-data:
