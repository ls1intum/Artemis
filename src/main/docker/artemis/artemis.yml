# ----------------------------------------------------------------------------------------------------------------------
# Artemis base service
# ----------------------------------------------------------------------------------------------------------------------

services:
    artemis-app:
        container_name: artemis-app
        extra_hosts:
            - "host.docker.internal:host-gateway"
        platform: amd64
        # look in the docs for more information about how to build your Artemis code with Docker
        # https://docs.artemis.cit.tum.de/dev/setup/#
        image: ghcr.io/ls1intum/artemis
        build:
            context: ../../../..
            dockerfile: src/main/docker/artemis/Dockerfile
            pull: true
        volumes:
            - artemis-data:/opt/artemis/data
        env_file:
            - ../../resources/config/docker-artemis-prod-mysql-application-local.env
        # environments can also be used for custom overrides (alternative to application-local.yml)
        # the following environments are necessary for docker images orchestrated by docker compose
        environment:
            _JAVA_OPTIONS: -Xmx5120m -Xms2560m
            SPRING_PROFILES_ACTIVE: artemis,scheduling,athene,prod,docker
        healthcheck:
            test: wget -nv -t1 --spider http://localhost:8080/actuator/health || exit 1
            start_period: 300s
            interval: 1s
        ports:
            - "8080:8080"
        # also expose the port to make it reachable docker internally even if the external port mapping changes
        expose:
            - "8080"
        networks:
            - artemis

networks:
    artemis:
        driver: "bridge"
        name: artemis
volumes:
    artemis-data:
        name: artemis-data
