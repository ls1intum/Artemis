# ----------------------------------------------------------------------------------------------------------------------
# Artemis-Dev-MySQL-GitLab-Jenkins Setup
# ----------------------------------------------------------------------------------------------------------------------

services:
    artemis-app:
        extends:
            file: ./artemis/artemis.yml
            service: artemis-app
        ports:
            - 5005:5005 # Java Remote Debugging port declared in the java cmd options
        command: >
            /bin/sh -c
            '/usr/local/bin/wait-for -t 0 artemis-mysql:3306
            && /usr/local/bin/wait-for -t 0 http://gitlab/-/readiness
            && /usr/local/bin/wait-for -t 0 http://jenkins:8080/login
            && /run_artemis.sh'
        volumes:
            - ./specialized-local-configs/artemis-dev-mysql-gitlab-jenkins-local.yml:/opt/artemis/config/application-local.yml:ro
            - ./scripts/wait-for.sh:/usr/local/bin/wait-for:ro
        environment:
            SPRING_PROFILES_ACTIVE: dev,jenkins,gitlab,artemis,scheduling,athene,docker,local
            JAVA_REMOTE_DEBUG: true
    mysql:
        extends:
            file: mysql.yml
            service: mysql
    gitlab:
        extends:
            file: ./gitlab/gitlab.yml
            service: gitlab
    jenkins:
        extends:
            file: ./jenkins/jenkins.yml
            service: jenkins

networks:
    artemis:
        driver: "bridge"
        name: artemis
volumes:
    artemis-gitlab-data:
        name: artemis-gitlab-data
    artemis-gitlab-logs:
        name: artemis-gitlab-logs
    artemis-gitlab-config:
        name: artemis-gitlab-config
    artemis-jenkins-data:
        name: artemis-jenkins-data
    artemis-mysql-data:
        name: artemis-mysql-data
    artemis-data:
        name: artemis-data
