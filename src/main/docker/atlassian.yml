version: "2"
services:
    jira:
        container_name: artemis_jira
        image: ghcr.io/ls1intum/artemis-jira:8.20.6
        volumes:
          - artemis-jira:/var/atlassian/application-data/jira
        ports:
            - "8081:8080"
        hostname: jira
        networks:
            artemis:
                ipv4_address: 172.20.0.2
    bitbucket:
        container_name: artemis_bitbucket
        image: ghcr.io/ls1intum/artemis-bitbucket:7.21.0
        volumes:
            - artemis-bitbucket:/var/atlassian/application-data/bitbucket
        environment:
            - SPRING_APPLICATION_JSON={"plugin":{"ssh":{"baseurl":"ssh://bitbucket:7999"}}}
        ports:
            - "7990:7990"
            - "7999:7999"
        hostname: bitbucket
        networks:
            artemis:
                ipv4_address: 172.20.0.3
    bamboo:
        container_name: artemis_bamboo
        image: ghcr.io/ls1intum/artemis-bamboo:8.1.3
        volumes:
            - artemis-bamboo:/var/atlassian/application-data/bamboo
        ports:
            - "54663:54663"
            - "8085:8085"
        hostname: bamboo
        networks:
            artemis:
                ipv4_address: 172.20.0.4
    bamboo_build_agent:
        container_name: artemis_bamboo_build_agent
        image: ghcr.io/ls1intum/artemis-bamboo-build-agent:8.1.3
        volumes:
            - artemis-bamboo-build-agent:/var/atlassian/application-data/bamboo
            - /var/run/docker.sock:/var/run/docker.sock
        hostname: bamboo-build-agent
        environment:
            - BAMBOO_SERVER=http://bamboo:8085
        networks:
            artemis:
                ipv4_address: 172.20.0.5

networks:
  artemis:
      driver: "bridge"
      ipam:
        driver: default
        config:
            - subnet: 172.20.0.0/24

volumes:
    artemis-jira:
    artemis-bitbucket:
    artemis-bamboo:
    artemis-bamboo-build-agent:
