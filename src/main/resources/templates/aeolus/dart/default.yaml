api: v0.0.1
metadata:
  name: "Dart"
  id: dart
  description: "Default build configuration for Dart exercises"
actions:
  - name: install_dependencies
    script: |-
      cd "${testWorkingDirectory}"
      dart pub get
  - name: syntax_check
    script: |-
      cd "${testWorkingDirectory}"
      # Check for compilation errors in the student code
      dart analyze --fatal-errors "${studentParentWorkingDirectoryName}"
      COMPILATION_EXIT_CODE=$?

      if [ $COMPILATION_EXIT_CODE -ne 0 ]; then
          exit 1
      fi
  - name: test
    script: |-
      cd "${testWorkingDirectory}"
      # Run the tests
      dart test --reporter=json | tojunit | xmlstarlet ed -d '//failure/@message' -d '//error/@message' > report.xml || true
    results:
      - name: Minitest Test Results
        path: "${testWorkingDirectory}/report.xml"
        type: junit
