api: v0.0.1
metadata:
  name: "Ruby Static Code Analysis"
  id: ruby_static
  description: "Default build configuration for Ruby exercises with static code analysis"
actions:
  - name: install_dependencies
    script: |-
      cd "${testWorkingDirectory}"
      bundler install
  - name: syntax_check
    script: |-
      # Check for syntax errors in the student code
      find "${studentParentWorkingDirectoryName}" -name "*.rb" -exec ruby -c {} +
      COMPILATION_EXIT_CODE=$?

      if [ $COMPILATION_EXIT_CODE -ne 0 ]; then
          exit 1
      fi
  - name: static_code_analysis
    script: |-
      cd "${testWorkingDirectory}"
      bundler exec rake ci:rubocop
    results:
      - name: Rubocop Code Issues
        path: "${testWorkingDirectory}/rubocop.sarif"
        type: sca
  - name: test
    script: |-
      cd "${testWorkingDirectory}"
      # Run the tests
      bundler exec rake ci:test || true
    results:
      - name: Minitest Test Results
        path: "${testWorkingDirectory}/report.xml"
        type: junit
