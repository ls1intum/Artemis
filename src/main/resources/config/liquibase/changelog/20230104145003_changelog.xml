<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.9.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">
    <changeSet id="20230104145003-1" author="maximiliansoelch">
        <modifyDataType tableName="answer_post" columnName="creation_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="attachment" columnName="release_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="attachment" columnName="upload_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="build_log_entry" columnName="time" newDataType="datetime(3)"/>

        <modifyDataType tableName="complaint" columnName="submitted_time" newDataType="datetime(3)"/>

        <modifyDataType tableName="complaint_response" columnName="submitted_time" newDataType="datetime(3)"/>
        <modifyDataType tableName="complaint_response" columnName="created_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="complaint_response" columnName="last_modified_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="conversation" columnName="creation_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="conversation" columnName="last_message_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="conversation_participant" columnName="last_read" newDataType="datetime(3)"/>

        <modifyDataType tableName="course" columnName="end_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="course" columnName="start_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="exam" columnName="end_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam" columnName="start_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam" columnName="visible_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam" columnName="exam_student_review_end" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam" columnName="exam_student_review_start" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam" columnName="example_solution_publication_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam" columnName="publish_results_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="exam_session" columnName="last_modified_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exam_session" columnName="created_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="exercise" columnName="release_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exercise" columnName="due_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exercise" columnName="assessment_due_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exercise" columnName="example_solution_publication_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="exercise" columnName="start_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="exercise_hint_activation" columnName="activation_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="feedback_conflict" columnName="created_at" newDataType="datetime(3)"/>
        <modifyDataType tableName="feedback_conflict" columnName="solved_at" newDataType="datetime(3)"/>

        <modifyDataType tableName="jhi_user" columnName="created_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="jhi_user" columnName="reset_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="jhi_user" columnName="last_modified_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="jhi_user" columnName="last_notification_read" newDataType="datetime(3)"/>
        <modifyDataType tableName="jhi_user" columnName="hide_notifications_until" newDataType="datetime(3)"/>

        <modifyDataType tableName="lecture" columnName="end_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="lecture" columnName="start_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="lecture_unit" columnName="release_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="notification" columnName="notification_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="notification" columnName="expire_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="participant_score" columnName="last_modified_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="participation" columnName="initialization_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="participation" columnName="individual_due_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="plagiarism_case" columnName="last_modified_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="plagiarism_case" columnName="verdict_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="plagiarism_result" columnName="last_modified_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="post" columnName="creation_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="programming_exercise_details" columnName="build_and_test_student_submissions_after_due_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="quiz_batch" columnName="start_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="reaction" columnName="creation_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="result" columnName="completion_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="result" columnName="last_modified_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="student_exam" columnName="last_modified_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="student_exam" columnName="created_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="student_exam" columnName="submission_date" newDataType="datetime(3)"/>
        <modifyDataType tableName="student_exam" columnName="started_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="submission" columnName="submission_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="submission_version" columnName="last_modified_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="team" columnName="last_modified_date" newDataType="datetime(3)"/>

        <modifyDataType tableName="tutorial_group_session" columnName="session_start" newDataType="datetime(3)"/>
        <modifyDataType tableName="tutorial_group_session" columnName="session_end" newDataType="datetime(3)"/>

        <modifyDataType tableName="tutorial_group_free_period" columnName="period_start" newDataType="datetime(3)"/>
        <modifyDataType tableName="tutorial_group_free_period" columnName="period_end" newDataType="datetime(3)"/>

        <!--
        Due to mysql SQL limitations, modifyDataType will lose primary key/autoincrement/not null/comment settings explicitly redefined in the change.
        Therefore, we have to explicitly set not null again for the affected columns!
        -->
        <addNotNullConstraint tableName="conversation" columnName="creation_date" columnDataType="datetime(3)"/>
        <addNotNullConstraint tableName="exercise_hint_activation" columnName="activation_date" columnDataType="datetime(3)"/>
        <addNotNullConstraint tableName="tutorial_group_session" columnName="session_start" columnDataType="datetime(3)"/>
        <addNotNullConstraint tableName="tutorial_group_session" columnName="session_end" columnDataType="datetime(3)"/>
        <addNotNullConstraint tableName="tutorial_group_free_period" columnName="period_start" columnDataType="datetime(3)"/>
        <addNotNullConstraint tableName="tutorial_group_free_period" columnName="period_end" columnDataType="datetime(3)"/>
    </changeSet>
</databaseChangeLog>
