<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    <changeSet id="20251023184348" author="maximiliansoelch">
        <!-- Remove duplicate entries in course_learner_profile table -->
        <sql>
            DELETE t1
            FROM course_learner_profile t1
            JOIN course_learner_profile t2
              ON t1.learner_profile_id = t2.learner_profile_id
             AND t1.course_id = t2.course_id
             AND t1.id &gt; t2.id;
        </sql>

        <!-- Add unique constraint to prevent future duplicates -->
        <addUniqueConstraint
                tableName="course_learner_profile"
                columnNames="learner_profile_id, course_id"
                constraintName="uq_course_learner_profile_pair"/>
        <rollback>
            <dropUniqueConstraint
                    tableName="course_learner_profile"
                    constraintName="uq_course_learner_profile_pair"/>
        </rollback>
    </changeSet>
</databaseChangeLog>