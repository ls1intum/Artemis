<div>
    <h5 *adminTitleBarTitle id="build-agent-title-bar" class="mb-0">
        <span jhiTranslate="artemisApp.buildAgents.details"></span>: {{ buildAgent()?.buildAgent?.displayName || agentName }}
    </h5>
    <div *adminTitleBarActions>
        @if (buildAgent(); as agent) {
            @if (agent.status === 'PAUSED' || agent.status === 'SELF_PAUSED') {
                <button class="btn btn-success btn-sm" (click)="resumeBuildAgent()">
                    <fa-icon [icon]="faPlay" />
                    <span jhiTranslate="artemisApp.buildAgents.resume"></span>
                </button>
            } @else {
                <button class="btn btn-danger btn-sm" (click)="pauseBuildAgent()">
                    <fa-icon [icon]="faPause" />
                    <span jhiTranslate="artemisApp.buildAgents.pause"></span>
                </button>
            }
        }
    </div>
    @if (buildAgent(); as agent) {
        <div class="mb-4">
            <div class="mb-3">
                <span class="text-muted" id="build-agent-info">{{ agent.buildAgent?.name }} - {{ agent.buildAgent?.memberAddress }}</span>
            </div>
            <div class="mb-4">
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.status"></span>
                    <span class="bold">:</span>
                    <fa-icon [icon]="agent.status === 'PAUSED' || agent.status === 'SELF_PAUSED' ? faPauseCircle : faCircleCheck" />
                    <span>{{ agent.status }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.startDate"></span>
                    <span class="bold">:</span>
                    <span>{{ agent.buildAgentDetails?.startDate | artemisDate }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.lastBuildDate"></span>
                    <span class="bold">:</span>
                    <span>{{ agent.buildAgentDetails?.lastBuildDate | artemisDate }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.averageBuildDuration"></span>
                    <span class="bold">:</span>
                    <span>{{ agent.buildAgentDetails?.averageBuildDuration }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.maxNumberOfConcurrentBuildJobs"></span>
                    <span class="bold">:</span>
                    <span>{{ agent.maxNumberOfConcurrentBuildJobs }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.gitRevision"></span>
                    <span class="bold">:</span>
                    <span>{{ agent.buildAgentDetails?.gitRevision }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.dockerVersion"></span>
                    <span class="bold">:</span>
                    <span>{{ agent.buildAgentDetails?.dockerVersion }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.consecutiveBuildFailures"></span>
                    <span>{{ agent.buildAgentDetails?.consecutiveBuildFailures }}</span>
                </div>
                <div>
                    <span class="bold" jhiTranslate="artemisApp.buildAgents.pauseAfterConsecutiveFailures"></span>
                    <span>{{ agent.pauseAfterConsecutiveBuildFailures }}</span>
                </div>
            </div>

            <jhi-build-job-statistics [buildJobStatisticsInput]="buildJobStatistics()" class="mb-4" />

            <div>
                <h4 id="build-queue-running-heading">
                    <span jhiTranslate="artemisApp.buildAgents.runningBuildJobs"></span>
                    <span class="badge bg-primary ms-2">{{ runningBuildJobs()?.length ?? 0 }}</span>
                </h4>
                <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3"></div>
                <jhi-running-jobs-table
                    [buildJobs]="runningBuildJobs()"
                    [showCourseId]="true"
                    [isAdminView]="true"
                    (cancelJob)="cancelBuildJob($event)"
                    (cancelAll)="cancelAllBuildJobs()"
                    (jobClick)="navigateToJobDetail($event)"
                />
            </div>
        </div>
    }
    @if (agentNotFound()) {
        <div class="alert alert-warning mb-4">
            <span jhiTranslate="artemisApp.buildAgents.notFound" [translateValues]="{ agentName: agentName }"></span>
            <br />
            <span class="text-muted" jhiTranslate="artemisApp.buildAgents.notFoundHint"></span>
        </div>
    }
    @if (buildAgent() || agentNotFound()) {
        <div>
            <div class="d-flex justify-content-between mb-2">
                <div class="d-flex align-items-center">
                    <h4 id="build-agents-recent-builds-heading" class="my-0">
                        <span jhiTranslate="artemisApp.buildQueue.finishedBuildJobs"></span>
                        <span class="badge bg-info ms-2">{{ finishedBuildJobs()?.length ?? 0 }}</span>
                    </h4>
                    <div class="form-group form-inline my-0 mx-1">
                        <input class="form-control ms-3" type="text" name="searchTerm" id="field_searchTerm" [(ngModel)]="searchTerm" (focusout)="triggerLoadFinishedJobs()" />
                        <jhi-help-icon class="ps-1" text="artemisApp.buildQueue.filter.search.tooltip" />
                        <button class="btn btn-primary ms-3" (click)="triggerLoadFinishedJobs()">
                            <span jhiTranslate="artemisApp.buildQueue.filter.search.title"></span>
                        </button>
                    </div>
                    <button class="btn btn-primary" (click)="loadFinishedBuildJobs()">
                        <fa-icon [icon]="faSync" />
                        <span jhiTranslate="metrics.refresh.button"></span>
                    </button>
                    @if (isLoading()) {
                        <span class="ms-3" jhiTranslate="artemisApp.buildQueue.filter.search.loading"></span>
                    }
                </div>
                <div>
                    <button
                        class="btn"
                        (click)="this.openFilterModal()"
                        [ngClass]="{ 'btn-secondary': !finishedBuildJobFilter?.numberOfAppliedFilters, 'btn-success': !!finishedBuildJobFilter?.numberOfAppliedFilters }"
                    >
                        <fa-icon [icon]="faFilter" />
                        <span class="d-s-none d-md-inline">
                            <span jhiTranslate="artemisApp.buildQueue.filter.open" [translateValues]="{ num: finishedBuildJobFilter?.numberOfAppliedFilters ?? 0 }"></span>
                        </span>
                    </button>
                </div>
            </div>
            <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3"></div>
            <jhi-finished-jobs-table
                [buildJobs]="finishedBuildJobs()"
                [showCourseId]="true"
                [isAdminView]="true"
                [(predicate)]="predicate"
                [(ascending)]="ascending"
                (sortChange)="loadFinishedBuildJobs()"
                (jobClick)="navigateToJobDetail($event)"
                (viewLogs)="viewBuildLogs($event)"
            />
            @if (finishedBuildJobs()) {
                <div class="row justify-content-center">
                    <jhi-slice-navigator [config]="paginationConfig" [hasMoreItems]="hasMore()" [isLoading]="isLoading()" (pageChange)="onPageChange($event)" />
                </div>
            }
        </div>
    }
</div>
