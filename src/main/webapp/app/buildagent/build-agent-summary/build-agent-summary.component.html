<div>
    <h5 *adminTitleBarTitle id="build-agents-heading" class="mb-0" jhiTranslate="artemisApp.buildAgents.title"></h5>
    <div *adminTitleBarActions>
        <button class="btn btn-success btn-sm" (click)="resumeAllBuildAgents()">
            <fa-icon [icon]="faPlay" />
            <span jhiTranslate="artemisApp.buildAgents.resumeAll"></span>
        </button>
        <button class="btn btn-danger btn-sm" (click)="displayPauseBuildAgentModal()">
            <fa-icon [icon]="faPause" />
            <span jhiTranslate="artemisApp.buildAgents.pauseAll"></span>
        </button>
        <button class="btn btn-danger btn-sm" (click)="displayClearDistributedDataModal()">
            <fa-icon [icon]="faTrash" />
            <span jhiTranslate="artemisApp.buildAgents.clearDistributedData.title"></span>
        </button>
    </div>
    @if (buildAgents()) {
        <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
            <p class="mb-0">
                {{ buildAgents().length }} <span jhiTranslate="artemisApp.buildAgents.onlineAgents"></span>: {{ currentBuilds() }}
                <span jhiTranslate="artemisApp.buildAgents.of"></span> {{ buildCapacity() }} <span jhiTranslate="artemisApp.buildAgents.buildJobsRunning"></span>
            </p>
        </div>
        <div class="build-agents-section">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="build-agents-column-strings" jhiTranslate="artemisApp.buildAgents.name"></th>
                            <th class="build-agents-column-strings" jhiTranslate="artemisApp.buildAgents.memberAddress"></th>
                            <th class="build-agents-column" jhiTranslate="artemisApp.buildAgents.status"></th>
                            <th class="build-agents-column" jhiTranslate="artemisApp.buildAgents.maxNumberOfConcurrentBuildJobs"></th>
                            <th class="build-agents-column" jhiTranslate="artemisApp.buildAgents.numberOfCurrentBuildJobs"></th>
                            <th class="build-agents-column-jobs" jhiTranslate="artemisApp.buildAgents.runningBuildJobs"></th>
                            <th class="build-agents-column" jhiTranslate="artemisApp.buildQueue.actions"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (agent of buildAgents(); track agent.buildAgent?.name) {
                            <tr class="clickable-row" [routerLink]="['/admin/build-agents/details']" [queryParams]="{ agentName: agent.buildAgent?.name }">
                                <td class="build-agents-column-strings">
                                    <a [routerLink]="['/admin/build-agents/details']" [queryParams]="{ agentName: agent.buildAgent?.name }" (click)="$event.stopPropagation()">
                                        {{ agent.buildAgent?.displayName }}
                                    </a>
                                </td>
                                <td class="build-agents-column-strings">{{ agent.buildAgent?.memberAddress }}</td>
                                <td class="build-agents-column">
                                    @switch (agent.status) {
                                        @case ('ACTIVE') {
                                            <span class="text-success" jhiTranslate="artemisApp.buildAgents.running"></span>
                                        }
                                        @case ('IDLE') {
                                            <span class="text-muted" jhiTranslate="artemisApp.buildAgents.idle"></span>
                                        }
                                        @case ('PAUSED') {
                                            <span class="text-warning" jhiTranslate="artemisApp.buildAgents.paused"></span>
                                        }
                                        @case ('SELF_PAUSED') {
                                            <span class="text-warning" jhiTranslate="artemisApp.buildAgents.selfPaused"></span>
                                        }
                                    }
                                </td>
                                <td class="build-agents-column">{{ agent.maxNumberOfConcurrentBuildJobs }}</td>
                                <td class="build-agents-column">{{ agent.runningBuildJobs?.length ?? agent.numberOfCurrentBuildJobs ?? 0 }}</td>
                                <td class="build-agents-column-jobs" (click)="$event.stopPropagation()">
                                    @for (job of agent.runningBuildJobs; track job.id) {
                                        <div class="running-job-item">
                                            <a class="job-link" [routerLink]="['/admin/build-overview', job.id, 'job-details']">
                                                {{ job.name ?? job.id }}
                                            </a>
                                            @if (job.id) {
                                                <button
                                                    class="btn btn-danger btn-xs"
                                                    (click)="cancelBuildJob(job.id)"
                                                    [attr.aria-label]="'artemisApp.buildQueue.cancel' | artemisTranslate"
                                                >
                                                    <fa-icon [icon]="faTimes" />
                                                </button>
                                            }
                                        </div>
                                    }
                                </td>
                                <td class="build-agents-column" (click)="$event.stopPropagation()">
                                    @if (agent.runningBuildJobs?.length) {
                                        <button class="btn btn-danger btn-sm" (click)="cancelAllBuildJobs(agent.buildAgent)">
                                            <fa-icon [icon]="faTimes" />
                                            <span class="ms-1" jhiTranslate="artemisApp.buildQueue.cancelAll"></span>
                                        </button>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>
