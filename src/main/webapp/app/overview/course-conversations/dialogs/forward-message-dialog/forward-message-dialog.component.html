<div class="modal-header">
    <h4 class="modal-title">Forward this message</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="activeModal.dismiss()"></button>
</div>
<div class="modal-body">
    <div class="autocomplete-container mt-1 mb-2">
        <div class="tag-input-container" (click)="focusInput()">
            @for (channel of selectedChannels; track channel) {
                <ng-container>
                    <span class="badge bg-primary me-1">
                        {{ channel.name }}
                        <button type="button" class="btn-close btn-close-white btn-sm ms-1" aria-label="Remove" (click)="removeSelectedChannel(channel)"></button>
                    </span>
                </ng-container>
            }
            @for (chat of selectedChats; track chat) {
                <ng-container>
                    <span class="badge bg-secondary me-1">
                        {{ chat.otherUserName }}
                        <button type="button" class="btn-close btn-close-white btn-sm ms-1" aria-label="Remove" (click)="removeSelectedChat(chat)"></button>
                    </span>
                </ng-container>
            }
            <input
                #searchInput
                type="text"
                class="tag-input"
                placeholder="Search channels or names"
                [(ngModel)]="searchTerm"
                (input)="filterItems($event)"
                (focus)="onInputFocus()"
                (blur)="onInputBlur($event)"
            />
        </div>
        @if (showDropdown && filteredOptions.length > 0) {
            <ul class="list-group autocomplete-dropdown" tabindex="0">
                @for (option of filteredOptions; track option) {
                    <li
                        class="list-group-item list-group-item-action"
                        [ngClass]="{ 'channel-option': option.type === 'channel', 'chat-option': option.type === 'chat' }"
                        (mousedown)="selectOption(option)"
                    >
                        @if (option.type === 'channel') {
                            <span class="me-2">#</span>
                        } @else {
                            <jhi-profile-picture
                                imageSizeInRem="1.5"
                                fontSizeInRem="0.6"
                                imageId="user-profile-picture"
                                defaultPictureId="user-default-profile-picture"
                                [authorId]="postToForward?.author?.id"
                                [authorName]="postToForward?.author?.name"
                                [imageUrl]="option.img"
                                style="margin-right: 0.2rem"
                            />
                        }
                        {{ option.name }}
                    </li>
                }
            </ul>
        }
    </div>

    <h5>Add a message</h5>
    <jhi-markdown-editor-monaco
        class="markdown-editor background-editor-color w-100"
        [markdown]="newPost.content"
        (markdownChange)="updateField($event)"
        [enableResize]="false"
        [showDefaultPreview]="true"
        [defaultActions]="defaultActions"
        [colorAction]="undefined"
        [metaActions]="[]"
        [headerActions]="undefined"
        [initialEditorHeight]="editorHeight"
        [resizableMinHeight]="editorHeight"
        [resizableMaxHeight]="MarkdownEditorHeight.MEDIUM"
    ></jhi-markdown-editor-monaco>

    @if (postToForward) {
        <div class="forwarded-message-container">
            <div class="left-border-line"></div>
            <div class="forwarded-message-content">
                <div class="forwarded-message-header">
                    <jhi-profile-picture
                        imageSizeInRem="1.5"
                        fontSizeInRem="0.6"
                        imageId="user-profile-picture"
                        defaultPictureId="user-default-profile-picture"
                        [authorId]="postToForward?.author?.id"
                        [authorName]="postToForward?.author?.name"
                        [imageUrl]="postToForward?.author?.imageUrl"
                        style="margin-right: 0.2rem"
                    >
                    </jhi-profile-picture>
                    <span class="forwarded-message-author">{{ postToForward?.author?.name }}</span>
                </div>
                <div class="forwarded-message-body" [ngClass]="{ 'preserve-line-breaks': postToForward?.content?.includes('\n') }">
                    {{ postToForward?.content }}
                </div>
            </div>
        </div>
    }
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-primary" [disabled]="!hasSelections()" (click)="send()">Send</button>
</div>
