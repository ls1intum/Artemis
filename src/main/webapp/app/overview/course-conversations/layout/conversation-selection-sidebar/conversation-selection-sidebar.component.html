<div *ngIf="course" class="h-100">
    <div *ngIf="!collapsed; else collapsedConversations" class="expanded-conversations">
        <div class="card">
            <!-- header -->
            <div class="card-header d-flex bg-primary text-white" [ngbTooltip]="'artemisApp.messages.conversation.hide' | artemisTranslate" (click)="collapsed = true">
                <h3 class="card-title">
                    <fa-icon [icon]="faConversation"></fa-icon>
                    <span class="ms-2" jhiTranslate="artemisApp.messages.conversation.header">Conversations</span>
                </h3>
                <div class="col-auto">
                    <fa-icon [icon]="faChevronLeft"></fa-icon>
                </div>
            </div>
            <!-- body -->
            <div class="card-body">
                <div class="input-group p-1">
                    <span class="input-group-text">
                        <fa-icon [icon]="faMagnifyingGlass" size="xs"></fa-icon>
                    </span>
                    <input (input)="onSearchQueryInput($event)" class="form-control" id="searchQuery" type="text" />
                </div>
                <div class="text-center my-1">
                    <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="button" (click)="expandAll()">
                        <fa-icon [icon]="faExpand"></fa-icon> <span>{{ 'artemisApp.assessmentInstructions.expandAll' | artemisTranslate }}</span>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="button" (click)="collapseAll()">
                        <fa-icon [icon]="faCompress"></fa-icon> <span>{{ 'artemisApp.assessmentInstructions.collapseAll' | artemisTranslate }}</span>
                    </button>
                </div>
                <div>
                    <!-- Starred -->
                    <!-- ToDo: Translate -->
                    <div [hidden]="searchTerm && searchTerm.length > 0 && !displayedStarredConversations?.length">
                        <jhi-sidebar-section
                            [label]="'Starred'"
                            [headerKey]="'starred'"
                            [conversations]="displayedStarredConversations"
                            [activeConversation]="activeConversation"
                            (conversationSelected)="onConversationSelected($event)"
                            [course]="course"
                            (settingsChanged)="onSettingsChanged()"
                        >
                        </jhi-sidebar-section>
                        <hr class="m-0" />
                    </div>
                    <!-- Channels -->
                    <div [hidden]="searchTerm && searchTerm.length > 0 && !displayedChannelConversations?.length">
                        <jhi-sidebar-section
                            [label]="'Channels'"
                            [headerKey]="'channels'"
                            [conversations]="displayedChannelConversations"
                            [activeConversation]="activeConversation"
                            (conversationSelected)="onConversationSelected($event)"
                            (settingsChanged)="onSettingsChanged()"
                            [course]="course"
                        >
                            <ng-template>
                                <div ngbDropdown class="d-inline-block">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" ngbDropdownToggle>
                                        <fa-icon [icon]="faPlus" size="xs"></fa-icon>
                                    </button>
                                    <div ngbDropdownMenu>
                                        <button ngbDropdownItem (click)="openChannelOverviewDialog($event)">Browse Channels</button>
                                        <button ngbDropdownItem [hidden]="!course.isAtLeastInstructor" (click)="openCreateChannelDialog($event)" *ngIf="canCreateChannel(course)">
                                            Create Channel
                                        </button>
                                    </div>
                                </div>
                            </ng-template>
                        </jhi-sidebar-section>
                        <hr class="m-0" />
                    </div>
                    <!-- Group Chats -->
                    <div [hidden]="searchTerm && searchTerm.length > 0 && !displayedGroupChats?.length">
                        <jhi-sidebar-section
                            [label]="'GroupChats'"
                            [headerKey]="'groupChats'"
                            [conversations]="displayedGroupChats"
                            [activeConversation]="activeConversation"
                            (conversationSelected)="onConversationSelected($event)"
                            (settingsChanged)="onSettingsChanged()"
                            [course]="course"
                        >
                            <ng-template>
                                <div class="d-inline-block">
                                    <button class="btn btn-sm btn-outline-secondary" type="button" (click)="openCreateGroupChatDialog($event)">
                                        <fa-icon [icon]="faPlus" size="xs"></fa-icon>
                                    </button>
                                </div>
                            </ng-template>
                        </jhi-sidebar-section>
                        <hr class="m-0" />
                    </div>
                    <!-- Direct Messages -->
                    <div [hidden]="searchTerm && searchTerm.length > 0 && !displayedOneToOneChats?.length">
                        <jhi-sidebar-section
                            [label]="'Direct Messages'"
                            [headerKey]="'directMessages'"
                            [conversations]="displayedOneToOneChats"
                            [activeConversation]="activeConversation"
                            (conversationSelected)="onConversationSelected($event)"
                            (settingsChanged)="onSettingsChanged()"
                            [course]="course"
                        >
                            <ng-template>
                                <div class="d-inline-block">
                                    <button class="btn btn-sm btn-outline-secondary" type="button" (click)="openCreateOneToOneChatDialog($event)">
                                        <fa-icon [icon]="faPlus" size="xs"></fa-icon>
                                    </button>
                                </div>
                            </ng-template>
                        </jhi-sidebar-section>
                    </div>
                </div>
                <!-- no conversations -->
                <div class="conversation-empty" *ngIf="allConversations === undefined || allConversations.length === 0">
                    <fa-icon size="3x" [icon]="faConversation"></fa-icon>
                    <h5 class="mb-3 font-weight-bold">{{ 'artemisApp.messages.conversation.notFound' | artemisTranslate }}</h5>
                    <span jhiTranslate="artemisApp.messages.conversation.instructionForNewConversation"></span>
                </div>
            </div>
        </div>
        <div class="draggable-right">
            <fa-icon [icon]="faGripLinesVertical"></fa-icon>
        </div>
    </div>
    <!-- collapsed conversations -->
    <ng-template #collapsedConversations>
        <div class="collapsed-conversations bg-primary text-white" (click)="collapsed = false" [ngbTooltip]="'artemisApp.messages.conversation.show' | artemisTranslate">
            <fa-icon class="expand-conversations-icon" [icon]="faChevronRight"></fa-icon>
            <span jhiTranslate="artemisApp.messages.conversation.header">Conversation</span>
            <fa-icon class="fa-rotate-270" [icon]="faConversation"></fa-icon>
            <fa-icon class="expand-conversations-icon" [icon]="faChevronRight"></fa-icon>
        </div>
    </ng-template>
</div>
