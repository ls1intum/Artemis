@if (exercise) {
    <jhi-header-exercise-page-with-details [exercise]="exercise" [exam]="exam" [isTestRun]="isTestRun">
        <ng-template pagetitle>
            @if (!isTestRun) {
                <span>{{ 'artemisApp.exerciseAssessmentDashboard.pageHeader' | artemisTranslate }} {{ exercise?.title }}</span>
            } @else {
                <span>{{ 'artemisApp.exerciseAssessmentDashboard.testRunPageHeader' | artemisTranslate }} {{ exercise?.title }}</span>
            }
        </ng-template>
    </jhi-header-exercise-page-with-details>
}

@if (exercise) {
    <div>
        @if (!isTestRun) {
            <div class="row my-3 d-flex justify-content-between">
                <div class="col-12 col-md-7 col-xl-4">
                    <p class="h3">
                        {{ 'artemisApp.exerciseAssessmentDashboard.yourStatus' | artemisTranslate }}:
                        {{ 'artemisApp.exerciseAssessmentDashboard.tutorParticipationStatus.title.' + yourStatusTitle | artemisTranslate }}
                    </p>
                    <jhi-tutor-participation-graph
                        class="d-block"
                        [exercise]="exercise"
                        [tutorParticipation]="tutorParticipation"
                        [numberOfSubmissions]="numberOfSubmissions"
                        [totalNumberOfAssessments]="totalNumberOfAssessments"
                        [numberOfComplaints]="complaintsDashboardInfo.total"
                        [numberOfOpenComplaints]="complaintsDashboardInfo.total - complaintsDashboardInfo.done!"
                        [numberOfMoreFeedbackRequests]="moreFeedbackRequestsDashboardInfo.total"
                        [numberOfOpenMoreFeedbackRequests]="moreFeedbackRequestsDashboardInfo.total - moreFeedbackRequestsDashboardInfo.done!"
                        [numberOfAssessmentsOfCorrectionRounds]="numberOfAssessmentsOfCorrectionRounds"
                    />
                    <p>
                        {{ 'artemisApp.exerciseAssessmentDashboard.tutorParticipationStatus.description.' + tutorParticipation.status!.toString() | artemisTranslate }}
                    </p>

                    @if (exercise.isAtLeastInstructor && exam?.numberOfCorrectionRoundsInExam && exam?.numberOfCorrectionRoundsInExam! > 1 && isExamMode && !isTestRun) {
                        <div class="d-inline-block">
                            <jhi-second-correction-enable-button
                                (ngModelChange)="toggleSecondCorrection()"
                                [secondCorrectionEnabled]="secondCorrectionEnabled"
                                [togglingSecondCorrectionButton]="togglingSecondCorrectionButton"
                            />
                        </div>
                    }
                </div>

                @if (numberOfSubmissions.total > 0) {
                    <div class="col-12 col-md-5 col-xl-4 d-flex justify-content-center justify-content-lg-end chart-col">
                        <ngx-charts-pie-chart
                            class="chart overflow-hidden"
                            [customColors]="customColors"
                            [view]="view"
                            [results]="assessments"
                            [legend]="true"
                            [legendTitle]="''"
                            [legendPosition]="legendPosition"
                            [animations]="false"
                            [trimLabels]="false"
                        >
                            <ng-template #tooltipTemplate let-model="model"> {{ ((model.value * 100) / this.numberOfSubmissions.total).toFixed(2) }}% </ng-template>
                        </ngx-charts-pie-chart>
                    </div>
                }

                <div class="col-12 col-lg-7 col-xl-4 table-col">
                    <jhi-side-panel
                        [panelHeader]="'artemisApp.exerciseAssessmentDashboard.exerciseInformation' | artemisTranslate"
                        [panelDescriptionHeader]="'artemisApp.exerciseAssessmentDashboard.totalYours' | artemisTranslate"
                    >
                        <div class="row g-0 mb-1">
                            <div class="col-7">
                                {{ 'artemisApp.assessmentDashboard.submissions' | artemisTranslate }}
                            </div>
                            <div class="col-5">
                                <span class="text-success">{{ numberOfSubmissions.inTime }}</span>
                                @if (numberOfSubmissions.late > 0) {
                                    <span> - </span>
                                }
                                @if (numberOfSubmissions.late > 0) {
                                    <span class="text-danger">{{ numberOfSubmissions.late }}</span>
                                }
                                |
                                {{ numberOfTutorAssessments }} ({{ tutorAssessmentPercentage }}%)
                            </div>
                        </div>

                        @if (complaintsEnabled) {
                            <div class="row g-0 mb-1">
                                <div class="col-7">{{ 'artemisApp.assessmentDashboard.complaints' | artemisTranslate }}</div>
                                <div class="col-5">
                                    @if (exercise.isAtLeastInstructor) {
                                        <div>
                                            <a [routerLink]="complaintsLink">
                                                {{ complaintsDashboardInfo.done }} / {{ complaintsDashboardInfo.total }} ({{ complaintsDashboardInfo.doneToTotalPercentage }})
                                            </a>
                                            |
                                            <a [routerLink]="complaintsLink" [queryParams]="{ tutorId: tutor?.id }">
                                                {{ complaintsDashboardInfo.tutor }}
                                            </a>
                                        </div>
                                    }
                                    @if (!exercise.isAtLeastInstructor) {
                                        <div>
                                            {{ complaintsDashboardInfo.done }} / {{ complaintsDashboardInfo.total }} ({{ complaintsDashboardInfo.doneToTotalPercentage }}) |
                                            <a [routerLink]="complaintsLink" [queryParams]="{ tutorId: tutor?.id }">
                                                {{ complaintsDashboardInfo.tutor }}
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        }

                        @if (feedbackRequestEnabled) {
                            <div class="row g-0 mb-1">
                                <div class="col-7">
                                    {{ 'artemisApp.assessmentDashboard.moreFeedbackRequests' | artemisTranslate }}
                                </div>
                                <div class="col-5">
                                    @if (exercise.isAtLeastInstructor) {
                                        <div>
                                            <a [routerLink]="moreFeedbackRequestsLink">
                                                {{ moreFeedbackRequestsDashboardInfo.done }} / {{ moreFeedbackRequestsDashboardInfo.total }} ({{
                                                    moreFeedbackRequestsDashboardInfo.doneToTotalPercentage
                                                }})
                                            </a>
                                            |
                                            <a [routerLink]="moreFeedbackRequestsLink" [queryParams]="{ tutorId: tutor?.id }">
                                                {{ moreFeedbackRequestsDashboardInfo.tutor }}
                                            </a>
                                        </div>
                                    }
                                    @if (!exercise.isAtLeastInstructor) {
                                        <div>
                                            {{ moreFeedbackRequestsDashboardInfo.done }} / {{ moreFeedbackRequestsDashboardInfo.total }} ({{
                                                moreFeedbackRequestsDashboardInfo.doneToTotalPercentage
                                            }}) |
                                            <a [routerLink]="moreFeedbackRequestsLink" [queryParams]="{ tutorId: tutor?.id }">
                                                {{ moreFeedbackRequestsDashboardInfo.tutor }}
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        }

                        <div class="row g-0 mb-1">
                            <div class="col-7">{{ 'artemisApp.exerciseAssessmentDashboard.ratings' | artemisTranslate }}</div>
                            <div class="col-5">{{ ratingsDashboardInfo.total }} | {{ ratingsDashboardInfo.tutor }}</div>
                        </div>
                        <div class="row g-0 mb-1">
                            <a [routerLink]="getExerciseDetailsLink()" [queryParams]="" class="btn btn-info btn-sm me-1 mb-3" id="exercise-details">
                                <fa-icon [icon]="faListAlt" [fixedWidth]="true" />
                                <span class="d-none d-md-inline">{{ 'artemisApp.exerciseAssessmentDashboard.exerciseDetails' | artemisTranslate }}</span>
                            </a>
                        </div>
                    </jhi-side-panel>

                    <div class="me-2 d-block float-end">
                        <div>
                            <div class="square bg-success d-inline-block"></div>
                            <span>{{ 'artemisApp.exerciseAssessmentDashboard.stats.intime' | artemisTranslate }}</span>
                        </div>
                        @if (numberOfSubmissions.late > 0) {
                            <div>
                                <div class="square bg-danger d-inline-block"></div>
                                <span>{{ 'artemisApp.exerciseAssessmentDashboard.stats.late' | artemisTranslate }}</span>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }

        @if (tutorParticipationStatus === NOT_PARTICIPATED && !isTestRun) {
            <div class="guided-tour-markdown-preview markdown-preview">
                @if (exercise.problemStatement && exercise.problemStatement.length > 0) {
                    <jhi-info-panel [panelHeader]="'artemisApp.exerciseAssessmentDashboard.problemStatement' | artemisTranslate">
                        @if (exercise.type !== ExerciseType.PROGRAMMING) {
                            <div [innerHTML]="formattedProblemStatement" class="no-bottom-space"></div>
                        } @else {
                            <!-- Programming exercises have a couple of custom render modules, so we load the instructions component here.-->
                            <jhi-programming-exercise-instructions
                                [exercise]="programmingExercise"
                                [participation]="programmingExercise.templateParticipation!"
                                [personalParticipation]="false"
                            />
                        }
                    </jhi-info-panel>
                }

                @if ((exercise.type === ExerciseType.TEXT || exercise.type === ExerciseType.FILE_UPLOAD) && formattedSampleSolution) {
                    <jhi-info-panel [panelHeader]="'artemisApp.exerciseAssessmentDashboard.exampleSolution' | artemisTranslate">
                        <div [innerHTML]="formattedSampleSolution" class="no-bottom-space"></div>
                    </jhi-info-panel>
                }

                @if (exercise.type === ExerciseType.MODELING && exampleSolutionModel) {
                    <jhi-info-panel [panelHeader]="'artemisApp.exerciseAssessmentDashboard.exampleSolution' | artemisTranslate">
                        <div>
                            <jhi-modeling-editor [umlModel]="exampleSolutionModel" [diagramType]="modelingExercise.diagramType" [readOnly]="true" />
                        </div>
                    </jhi-info-panel>
                }

                @if (exercise.type === ExerciseType.MODELING && modelingExercise.exampleSolutionExplanation) {
                    <jhi-info-panel [panelHeader]="'artemisApp.exerciseAssessmentDashboard.exampleSolutionExplanation' | artemisTranslate">
                        <div [innerHTML]="formattedSampleSolution" class="no-bottom-space"></div>
                    </jhi-info-panel>
                }

                @if (exercise.type === ExerciseType.PROGRAMMING) {
                    <div class="col-12">
                        <h4>{{ 'artemisApp.exerciseAssessmentDashboard.exampleSolution' | artemisTranslate }}</h4>
                        @if (!localVCEnabled) {
                            <a jhiSecureLink [href]="programmingExercise.solutionParticipation?.repositoryUri || ''">
                                <jhi-button jhiTranslate="artemisApp.exerciseAssessmentDashboard.programmingExercise.exampleSolution" />
                            </a>
                        } @else {
                            <jhi-clone-repo-button [smallButtons]="true" [repositoryUri]="programmingExercise.solutionParticipation?.repositoryUri || ''" />
                        }
                    </div>
                }

                @if (exercise.gradingInstructions && exercise.gradingInstructions.length > 0) {
                    <jhi-info-panel [panelHeader]="'artemisApp.exerciseAssessmentDashboard.gradingInstructions' | artemisTranslate">
                        <div [innerHTML]="formattedGradingInstructions" class="no-bottom-space"></div>
                    </jhi-info-panel>
                }

                @if (exercise.gradingCriteria && exercise.gradingCriteria.length > 0) {
                    <div class="col-md-6 mt-4">
                        <h4>{{ 'artemisApp.exerciseAssessmentDashboard.structuredGradingInstructions' | artemisTranslate }}</h4>
                        <jhi-structured-grading-instructions-assessment-layout [readonly]="true" [criteria]="exercise.gradingCriteria || []" />
                    </div>
                }
            </div>
        }

        @if (tutorParticipationStatus === NOT_PARTICIPATED && !isTestRun) {
            <div class="col-12 text-center mt-2 mb-4">
                <p>{{ 'artemisApp.exerciseAssessmentDashboard.pleaseContactIfUnclear' | artemisTranslate }}</p>

                <button id="participate-in-assessment" class="btn btn-primary guided-tour-instructions-button p-1" (click)="readInstruction()" [disabled]="isLoading">
                    @if (exercise.gradingInstructions && exercise.gradingInstructions.length > 0) {
                        <span>
                            {{ 'artemisApp.exerciseAssessmentDashboard.readAndUnderstood' | artemisTranslate }}
                        </span>
                    }

                    @if (!exercise.gradingInstructions || exercise.gradingInstructions.length === 0) {
                        <span>
                            {{ 'artemisApp.exerciseAssessmentDashboard.startYourParticipation' | artemisTranslate }}
                        </span>
                    }
                </button>
            </div>
        }

        @if (tutorParticipationStatus !== NOT_PARTICIPATED || isTestRun) {
            <div class="d-flex">
                <div *jhiExtensionPoint="overrideAssessmentTable" class="guided-tour-exercise-dashboard-table flex-grow-1">
                    @if (tutorParticipationStatus === REVIEWED_INSTRUCTIONS && !isTestRun) {
                        <div class="alert alert-warning row" role="alert">
                            <span
                                jhiTranslate="artemisApp.exerciseAssessmentDashboard.totalExampleSubmissions"
                                [translateValues]="{
                                    total: stats.toReview.total + stats.toAssess.total,
                                    toRead: stats.toReview.total,
                                    toAssess: stats.toAssess.total,
                                }"
                            ></span>
                        </div>
                    }

                    @if (tutorParticipationStatus !== NOT_PARTICIPATED && !isTestRun) {
                        <div class="row">
                            @if (stats.toReview.total > 0) {
                                <div class="col-6">
                                    <p class="h3">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.readSubmissions' | artemisTranslate }} ({{ stats.toReview.done }} / {{ stats.toReview.total }})
                                    </p>

                                    @if (stats.toReview.done < stats.toReview.total) {
                                        <button
                                            class="btn btn-primary review-example-submission mb-4"
                                            [class.guided-tour]="exercise === exerciseForGuidedTour"
                                            (click)="openExampleSubmission(nextExampleSubmissionId, true, false)"
                                        >
                                            @if (stats.toReview.done <= 0) {
                                                <span>
                                                    {{ 'artemisApp.exerciseAssessmentDashboard.start' | artemisTranslate }}
                                                </span>
                                            } @else {
                                                {{ 'artemisApp.exerciseAssessmentDashboard.continue' | artemisTranslate }}
                                            }

                                            {{ 'artemisApp.exerciseAssessmentDashboard.readingExampleSubmissions' | artemisTranslate }}
                                        </button>
                                    }

                                    @if (stats.toReview.done >= stats.toReview.total) {
                                        <ul>
                                            @for (exampleSubmission of exampleSubmissionsToReview; track exampleSubmission; let i = $index) {
                                                <li>
                                                    <button
                                                        class="btn btn-link review-example-submission"
                                                        [class.guided-tour]="exercise === exerciseForGuidedTour"
                                                        (click)="openExampleSubmission(exampleSubmission.id!, true, false)"
                                                    >
                                                        {{ 'artemisApp.exerciseAssessmentDashboard.readExampleSubmission' | artemisTranslate }} {{ i + 1 }}
                                                    </button>
                                                    @if (hasBeenCompletedByTutor(exampleSubmission.id!)) {
                                                        <fa-icon class="text-success" [icon]="faCheckCircle" />
                                                    }
                                                </li>
                                            }
                                        </ul>
                                    }
                                </div>
                            }

                            @if (stats.toAssess.total > 0 && stats.toReview.done >= stats.toReview.total) {
                                <div class="col-6">
                                    <p class="h3">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.assessedSubmissions' | artemisTranslate }} ({{ stats.toAssess.done }} /
                                        {{ stats.toAssess.total }})
                                    </p>
                                    @if (stats.toAssess.done < stats.toAssess.total) {
                                        <button
                                            class="btn btn-primary assess-example-submission mb-4"
                                            [class.guided-tour]="exercise === exerciseForGuidedTour"
                                            (click)="openExampleSubmission(nextExampleSubmissionId, false, true)"
                                        >
                                            @if (stats.toAssess.done <= 0) {
                                                <span>
                                                    {{ 'artemisApp.exerciseAssessmentDashboard.start' | artemisTranslate }}
                                                </span>
                                            } @else {
                                                {{ 'artemisApp.exerciseAssessmentDashboard.continue' | artemisTranslate }}
                                            }

                                            {{ 'artemisApp.exerciseAssessmentDashboard.assessingExampleSubmission' | artemisTranslate }}
                                        </button>
                                    }

                                    @if (stats.toAssess.done >= stats.toAssess.total) {
                                        <ul>
                                            @for (exampleSubmission of exampleSubmissionsToAssess; track exampleSubmission; let i = $index) {
                                                <li>
                                                    <button
                                                        class="btn btn-link assess-example-submission"
                                                        [class.guided-tour]="exercise === exerciseForGuidedTour"
                                                        (click)="openExampleSubmission(exampleSubmission.id!, false, true)"
                                                    >
                                                        {{ 'artemisApp.exerciseAssessmentDashboard.assessExampleSubmission' | artemisTranslate }} {{ i + 1 }}
                                                    </button>
                                                    @if (hasBeenCompletedByTutor(exampleSubmission.id!)) {
                                                        <fa-icon class="text-success" [icon]="faCheckCircle" />
                                                    }
                                                </li>
                                            }
                                        </ul>
                                    }
                                </div>
                            }
                        </div>
                    }
                    @if (submissionLockLimitReached && tutorParticipationStatus !== REVIEWED_INSTRUCTIONS) {
                        <div class="alert alert-danger">
                            {{ 'artemisApp.submission.lockedSubmissionsLimitReached' | artemisTranslate }}
                        </div>
                    }
                    @for (roundState of numberOfAssessmentsOfCorrectionRounds; track roundState; let correctionRound = $index) {
                        <div>
                            @if ((tutorParticipationStatus === TRAINED || exercise.isAtLeastInstructor || tutorParticipationStatus === COMPLETED) && !isTestRun) {
                                @if (!isExamMode) {
                                    <h4 class="d-inline-block">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.studentsSubmissions' | artemisTranslate }}
                                    </h4>
                                }
                                @if (isExamMode) {
                                    <h4 class="d-inline-block">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.studentsSubmissionsExam' | artemisTranslate: { round: correctionRound + 1 } }}
                                    </h4>
                                }
                                @if (correctionRound > 0) {
                                    <fa-icon
                                        class="text-secondary"
                                        [icon]="faQuestionCircle"
                                        ngbTooltip="{{ 'artemisApp.exerciseAssessmentDashboard.noSubmissionsBecauseFirstAssessedByYourself' | artemisTranslate }}"
                                    />
                                }
                            }
                            @if (numberOfCorrectionRoundsEnabled > correctionRound) {
                                @if (isTestRun) {
                                    <h4>
                                        {{ 'artemisApp.exerciseAssessmentDashboard.testRunSubmissions' | artemisTranslate }}
                                    </h4>
                                }
                                @if (tutorParticipationStatus === TRAINED || exercise.isAtLeastInstructor || tutorParticipationStatus === COMPLETED || isTestRun) {
                                    <div class="table-responsive">
                                        @if (showSubmissionsForRound(correctionRound)) {
                                            <table class="table exercise-table">
                                                <thead>
                                                    <tr
                                                        jhiSort
                                                        [(predicate)]="sortPredicates[0]"
                                                        [(ascending)]="reverseOrders[0]"
                                                        (sortChange)="sortSubmissionRows(correctionRound)"
                                                    >
                                                        <th>#</th>
                                                        <th jhiSortBy="submissionDate">
                                                            <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.submissionDate' | artemisTranslate }}</a>
                                                            <fa-icon [icon]="faSort" />
                                                        </th>
                                                        <th jhiSortBy="results.correctionRound.score">
                                                            <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.result' | artemisTranslate }}</a>
                                                            <fa-icon [icon]="faSort" />
                                                        </th>
                                                        @if (exercise.type === ExerciseType.TEXT) {
                                                            <th jhiSortBy="language">
                                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.language' | artemisTranslate }}</a>
                                                                <fa-icon [icon]="faSort" />
                                                            </th>
                                                        }
                                                        <th>{{ 'artemisApp.exerciseAssessmentDashboard.action' | artemisTranslate }}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (unassessedSubmissionByRound?.get(correctionRound)?.id && !exercise.teamMode && !isTestRun) {
                                                        <tr>
                                                            <td></td>
                                                            <td>{{ unassessedSubmissionByRound!.get(correctionRound)!.submissionDate | artemisDate }}</td>
                                                            <td></td>
                                                            @if (exercise.type === ExerciseType.TEXT) {
                                                                <td>
                                                                    <jhi-language-table-cell [submission]="unassessedSubmissionByRound!.get(correctionRound)!" />
                                                                </td>
                                                            }
                                                            <td>
                                                                <a
                                                                    *jhiExtensionPoint="
                                                                        overrideOpenAssessmentButton;
                                                                        context: {
                                                                            submission: 'new',
                                                                            queryParams: getAssessmentQueryParams(correctionRound),
                                                                            buttonLabel: 'startAssessment',
                                                                        }
                                                                    "
                                                                    id="start-new-assessment"
                                                                    class="btn btn-success btn-sm guided-tour-new-assessment-btn"
                                                                    [routerLink]="getAssessmentLink('new')"
                                                                    [queryParams]="getAssessmentQueryParams(correctionRound)"
                                                                    [class.disabled]="exercise === exerciseForGuidedTour || openingAssessmentEditorForNewSubmission"
                                                                    [class.guided-tour]="exercise === exerciseForGuidedTour"
                                                                    [ngStyle]="exercise === exerciseForGuidedTour ? { cursor: 'not-allowed' } : {}"
                                                                >
                                                                    @if (openingAssessmentEditorForNewSubmission) {
                                                                        <fa-icon [icon]="faSpinner" animation="spin" />
                                                                    }
                                                                    <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />
                                                                    {{ 'artemisApp.exerciseAssessmentDashboard.startAssessment' | artemisTranslate }}
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    }
                                                    @for (submission of assessedSubmissionsByRound.get(correctionRound); track submission; let i = $index) {
                                                        <tr>
                                                            <td>{{ i + 1 }}</td>
                                                            <td>{{ submission.submissionDate | artemisDate }}</td>
                                                            <td>
                                                                <jhi-result
                                                                    [result]="getSubmissionResultByCorrectionRound(submission, correctionRound)"
                                                                    [participation]="submission.participation!"
                                                                    [exercise]="exercise"
                                                                />
                                                            </td>
                                                            @if (exercise.type === ExerciseType.TEXT) {
                                                                <td>
                                                                    <jhi-language-table-cell [submission]="submission" />
                                                                </td>
                                                            }
                                                            <td>
                                                                @if ((isTestRun && complaints.length === 0) || !isTestRun) {
                                                                    <ng-container
                                                                        *jhiExtensionPoint="
                                                                            overrideOpenAssessmentButton;
                                                                            context: {
                                                                                submission: submission,
                                                                                queryParams: getAssessmentQueryParams(correctionRound),
                                                                                buttonLabel:
                                                                                    submission && calculateSubmissionStatusIsDraft(submission, correctionRound)
                                                                                        ? 'continueAssessment'
                                                                                        : 'openAssessment',
                                                                            }
                                                                        "
                                                                    >
                                                                        @if (submission && calculateSubmissionStatusIsDraft(submission, correctionRound)) {
                                                                            <a
                                                                                [routerLink]="getAssessmentLink(submission)"
                                                                                [queryParams]="getAssessmentQueryParams(correctionRound)"
                                                                                class="btn btn-warning btn-sm"
                                                                                id="continue-assessment"
                                                                            >
                                                                                <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />&nbsp;{{
                                                                                    'artemisApp.exerciseAssessmentDashboard.continueAssessment' | artemisTranslate
                                                                                }}
                                                                            </a>
                                                                        } @else {
                                                                            @if (!!submission.results && !!submission.results[correctionRound]) {
                                                                                <a
                                                                                    [routerLink]="getAssessmentLink(submission)"
                                                                                    [queryParams]="getAssessmentQueryParams(correctionRound)"
                                                                                    class="btn btn-primary btn-sm"
                                                                                    id="open-assessment"
                                                                                >
                                                                                    <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />
                                                                                    &nbsp;{{ 'artemisApp.exerciseAssessmentDashboard.openAssessment' | artemisTranslate }}
                                                                                </a>
                                                                            }
                                                                        }
                                                                    </ng-container>
                                                                }
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        } @else {
                                            <jhi-assessment-warning [exercise]="exercise" />
                                            @if (!exercise.teamMode) {
                                                <div class="alert alert-info">
                                                    {{ 'artemisApp.exerciseAssessmentDashboard.noSubmissions' | artemisTranslate }}
                                                </div>
                                            } @else {
                                                <div class="alert alert-warning">
                                                    {{ 'artemisApp.exerciseAssessmentDashboard.startAssessmentFromTeamPages' | artemisTranslate }}
                                                </div>
                                            }
                                        }
                                        @if (
                                            isExamMode &&
                                            (!unassessedSubmissionByRound?.get(correctionRound)?.id || exercise.teamMode || isTestRun) &&
                                            numberOfSubmissions.inTime !== roundState.inTime
                                        ) {
                                            <div class="alert alert-info">
                                                <span
                                                    jhiTranslate="artemisApp.exerciseAssessmentDashboard.noSubmissionsInfo"
                                                    [translateValues]="{
                                                        notYetAssessed: notYetAssessed[correctionRound],
                                                        lockedSubmissionsByOtherTutor: lockedSubmissionsByOtherTutor[correctionRound],
                                                    }"
                                                ></span>
                                                @if (correctionRound === 1) {
                                                    <span
                                                        jhiTranslate="artemisApp.exerciseAssessmentDashboard.noSubmissionsInfoSecondCorrection"
                                                        [translateValues]="{ firstRoundAssessments: firstRoundAssessments }"
                                                    ></span>
                                                }
                                            </div>
                                        }
                                    </div>
                                }
                            }
                            @if (numberOfCorrectionRoundsEnabled <= correctionRound) {
                                <div class="alert alert-info">
                                    {{ 'artemisApp.exerciseAssessmentDashboard.correctionRoundNotYetEnabled' | artemisTranslate }}
                                </div>
                            }
                        </div>
                    }
                    <!-- Complaints -->
                    @if (tutorParticipationStatus === TRAINED || exercise.isAtLeastInstructor || tutorParticipationStatus === COMPLETED || isTestRun) {
                        <h4 class="d-inline-block">
                            {{ 'artemisApp.exerciseAssessmentDashboard.complaints' | artemisTranslate }}
                        </h4>
                        <fa-icon class="text-secondary" [icon]="faQuestionCircle" [ngbTooltip]="'artemisApp.exerciseAssessmentDashboard.complaintHint' | artemisTranslate" />
                        <div class="table-responsive">
                            @if (submissionsWithComplaints && submissionsWithComplaints!.length > 0) {
                                <table class="table exercise-table">
                                    <thead>
                                        <tr jhiSort [(predicate)]="sortPredicates[1]" [(ascending)]="reverseOrders[1]" (sortChange)="sortComplaintRows()">
                                            <th>#</th>
                                            <th jhiSortBy="complaint.submittedTime">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.submissionDate' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th jhiSortBy="submission.latestResult.score">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.result' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th jhiSortBy="responseTime">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.responseTime' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th jhiSortBy="complaint.accepted">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.status' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th>{{ 'artemisApp.exerciseAssessmentDashboard.action' | artemisTranslate }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for (submissionWithComplaint of submissionsWithComplaints; track submissionWithComplaint; let i = $index) {
                                            <tr>
                                                <td>{{ i + 1 }}</td>
                                                <td>{{ submissionWithComplaint.complaint.submittedTime | artemisDate }}</td>
                                                <td>
                                                    <jhi-result
                                                        [result]="submissionWithComplaint.submission.latestResult"
                                                        [participation]="submissionWithComplaint.complaint.result!.participation!"
                                                        [exercise]="exercise"
                                                    />
                                                </td>
                                                <td>
                                                    @if (submissionWithComplaint.complaint.accepted === undefined) {
                                                        &gt;=
                                                    }
                                                    {{ complaintService.getResponseTimeInSeconds(submissionWithComplaint.complaint) | artemisDurationFromSeconds: true }}
                                                    @if (complaintService.shouldHighlightComplaint(submissionWithComplaint.complaint)) {
                                                        <fa-icon
                                                            [icon]="faExclamationTriangle"
                                                            class="text-warning"
                                                            ngbTooltip="{{ 'artemisApp.complaint.oneWeekUnanswered' | artemisTranslate }}"
                                                        />
                                                    }
                                                </td>
                                                <td>
                                                    @if (submissionWithComplaint.complaint.accepted === undefined) {
                                                        <span class="text-warning">
                                                            {{ 'artemisApp.complaint.listOfComplaints.noReply' | artemisTranslate }}
                                                        </span>
                                                    }
                                                    @if (submissionWithComplaint.complaint.accepted === true) {
                                                        <span class="text-success">
                                                            {{ 'artemisApp.complaint.listOfComplaints.accepted' | artemisTranslate }}
                                                        </span>
                                                    }
                                                    @if (submissionWithComplaint.complaint.accepted === false) {
                                                        <span class="text-danger">
                                                            {{ 'artemisApp.complaint.listOfComplaints.rejected' | artemisTranslate }}
                                                        </span>
                                                    }
                                                </td>
                                                <td>
                                                    <ng-container
                                                        *jhiExtensionPoint="
                                                            overrideOpenAssessmentButton;
                                                            context: {
                                                                submission: submissionWithComplaint.submission,
                                                                queryParams: getComplaintQueryParams(submissionWithComplaint.complaint),
                                                                disabled: isComplaintLocked(submissionWithComplaint.complaint),
                                                                buttonLabel: submissionWithComplaint.complaint.accepted === undefined ? 'evaluateComplaint' : 'showComplaint',
                                                            }
                                                        "
                                                    >
                                                        @if (submissionWithComplaint.complaint.accepted === undefined) {
                                                            <a
                                                                [class.disabled]="isComplaintLocked(submissionWithComplaint.complaint)"
                                                                [routerLink]="getAssessmentLink(submissionWithComplaint.submission)"
                                                                [queryParams]="getComplaintQueryParams(submissionWithComplaint.complaint)"
                                                                class="btn btn-success btn-sm"
                                                                id="evaluate-complaint"
                                                            >
                                                                <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />
                                                                {{ 'artemisApp.exerciseAssessmentDashboard.evaluateComplaint' | artemisTranslate }}
                                                            </a>
                                                        } @else {
                                                            <a
                                                                [routerLink]="getAssessmentLink(submissionWithComplaint.submission)"
                                                                [queryParams]="getComplaintQueryParams(submissionWithComplaint.complaint)"
                                                                class="btn btn-primary btn-sm"
                                                            >
                                                                <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />
                                                                {{ 'artemisApp.exerciseAssessmentDashboard.showComplaint' | artemisTranslate }}
                                                            </a>
                                                        }
                                                    </ng-container>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            } @else {
                                @if (complaintsDashboardInfo.total === 0) {
                                    <div class="alert alert-info">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.noComplaints' | artemisTranslate }}
                                    </div>
                                }
                                @if (complaintsDashboardInfo.total !== 0) {
                                    <div class="alert alert-info">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.noComplaintsDisplayed' | artemisTranslate }}
                                    </div>
                                }
                            }
                        </div>
                    }

                    <!-- More Feedback Requests -->
                    @if ((tutorParticipationStatus === TRAINED || exercise.isAtLeastInstructor || tutorParticipationStatus === COMPLETED) && !isExamMode) {
                        <h4 class="d-inline-block">
                            {{ 'artemisApp.exerciseAssessmentDashboard.moreFeedback' | artemisTranslate }}
                        </h4>
                        <fa-icon
                            class="text-secondary"
                            [icon]="faQuestionCircle"
                            [ngbTooltip]="'artemisApp.exerciseAssessmentDashboard.moreFeedbackRequestHint' | artemisTranslate"
                        />
                        <div class="table-responsive">
                            @if (submissionsWithMoreFeedbackRequests && submissionsWithMoreFeedbackRequests!.length > 0) {
                                <table class="table exercise-table">
                                    <thead>
                                        <tr jhiSort [(predicate)]="sortPredicates[2]" [(ascending)]="reverseOrders[2]" (sortChange)="sortMoreFeedbackRows()">
                                            <th>#</th>
                                            <th jhiSortBy="complaint.submittedTime">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.submissionDate' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th jhiSortBy="submission.latestResult.score">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.result' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th jhiSortBy="responseTime">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.responseTime' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th jhiSortBy="complaint.accepted">
                                                <a class="th-link">{{ 'artemisApp.exerciseAssessmentDashboard.status' | artemisTranslate }}</a>
                                                <fa-icon [icon]="faSort" />
                                            </th>
                                            <th>{{ 'artemisApp.exerciseAssessmentDashboard.action' | artemisTranslate }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for (moreFeedbackRequest of submissionsWithMoreFeedbackRequests; track moreFeedbackRequest; let i = $index) {
                                            <tr>
                                                <td>{{ i + 1 }}</td>
                                                <td>{{ moreFeedbackRequest.complaint.submittedTime | artemisDate }}</td>
                                                <td>
                                                    <jhi-result [result]="moreFeedbackRequest.complaint.result" [exercise]="exercise" />
                                                </td>
                                                <td>
                                                    @if (moreFeedbackRequest.complaint.accepted === undefined) {
                                                        &gt;=
                                                    }
                                                    {{ complaintService.getResponseTimeInSeconds(moreFeedbackRequest.complaint) | artemisDurationFromSeconds: true }}
                                                    @if (complaintService.shouldHighlightComplaint(moreFeedbackRequest.complaint)) {
                                                        <fa-icon
                                                            [icon]="faExclamationTriangle"
                                                            class="text-warning"
                                                            ngbTooltip="{{ 'artemisApp.complaint.oneWeekUnanswered' | artemisTranslate }}"
                                                        />
                                                    }
                                                </td>
                                                <td>
                                                    @if (moreFeedbackRequest.complaint.accepted === undefined) {
                                                        <span class="text-warning">
                                                            {{ 'artemisApp.complaint.listOfComplaints.noReply' | artemisTranslate }}
                                                        </span>
                                                    }
                                                    @if (moreFeedbackRequest.complaint.accepted === true) {
                                                        <span class="text-success">
                                                            {{ 'artemisApp.moreFeedback.accepted' | artemisTranslate }}
                                                        </span>
                                                    }
                                                </td>
                                                <td>
                                                    <ng-container
                                                        *jhiExtensionPoint="
                                                            overrideOpenAssessmentButton;
                                                            context: {
                                                                submission: moreFeedbackRequest.submission,
                                                                queryParams: getComplaintQueryParams(moreFeedbackRequest.complaint),
                                                                buttonLabel:
                                                                    moreFeedbackRequest.complaint.accepted === undefined
                                                                        ? 'evaluateMoreFeedbackRequest'
                                                                        : 'showMoreFeedbackRequests',
                                                            }
                                                        "
                                                    >
                                                        @if (moreFeedbackRequest.complaint.accepted === undefined) {
                                                            <a
                                                                class="btn btn-success btn-sm"
                                                                [class.disabled]="isComplaintLocked(moreFeedbackRequest.complaint)"
                                                                [routerLink]="getAssessmentLink(moreFeedbackRequest.submission)"
                                                                [queryParams]="getComplaintQueryParams(moreFeedbackRequest.complaint)"
                                                            >
                                                                <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />
                                                                {{ 'artemisApp.exerciseAssessmentDashboard.evaluateMoreFeedbackRequest' | artemisTranslate }}
                                                            </a>
                                                        } @else {
                                                            <button
                                                                class="btn btn-primary btn-sm"
                                                                [routerLink]="getAssessmentLink(moreFeedbackRequest.submission)"
                                                                [queryParams]="getComplaintQueryParams(moreFeedbackRequest.complaint)"
                                                            >
                                                                <fa-icon [icon]="faFolderOpen" [fixedWidth]="true" />
                                                                {{ 'artemisApp.exerciseAssessmentDashboard.showMoreFeedbackRequests' | artemisTranslate }}
                                                            </button>
                                                        }
                                                    </ng-container>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            } @else {
                                @if (moreFeedbackRequestsDashboardInfo.total === 0) {
                                    <div class="alert alert-info">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.noMoreFeedbackRequests' | artemisTranslate }}
                                    </div>
                                }
                                @if (moreFeedbackRequestsDashboardInfo.total !== 0) {
                                    <div class="alert alert-info">
                                        {{ 'artemisApp.exerciseAssessmentDashboard.noMoreFeedbackRequestsDisplayed' | artemisTranslate }}
                                    </div>
                                }
                            }
                        </div>
                    }
                </div>
                <jhi-collapsable-assessment-instructions class="collapsable-instructions" [readOnly]="true" [exercise]="exercise" [collapsed]="true" />
            </div>
        }

        @if (this.tutorParticipation.status! === TRAINED || exercise.isAtLeastInstructor) {
            <div>
                @if (!isExamMode) {
                    <h2>{{ 'artemisApp.instructorExerciseDashboard.leaderboardTitle' | artemisTranslate }}</h2>
                }
                <jhi-tutor-leaderboard [exam]="exam" [tutorsData]="statsForDashboard.tutorLeaderboardEntries" [exercise]="exercise" />
            </div>
        }
    </div>
}
