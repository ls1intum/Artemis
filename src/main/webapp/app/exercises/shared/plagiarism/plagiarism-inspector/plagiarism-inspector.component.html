<div class="plagiarism-inspector">
    <div class="plagiarism-header">
        <div class="plagiarism-header-top">
            <div class="plagiarism-header-top-left">
                <h4 class="plagiarism-page-title fw-medium" (click)="showOptions = !showOptions" [class.active]="showOptions">
                    <fa-icon class="plagiarism-options-toggle" [icon]="faChevronRight"></fa-icon>
                    <span>{{ 'artemisApp.plagiarism.plagiarismDetection' | artemisTranslate }}</span>
                </h4>

                <div class="plagiarism-warning">
                    <fa-icon [icon]="faExclamationTriangle" id="plagiarismCaution"></fa-icon>
                    <span>{{ 'artemisApp.plagiarism.caution' | artemisTranslate }}</span>
                </div>
            </div>
            <div class="plagiarism-header-top-right">
                <button *ngIf="chartFilterApplied" class="check-plagiarism btn btn-info" (click)="resetFilter()">
                    <span>{{ 'artemisApp.plagiarism.resetFilter' | artemisTranslate }}</span>
                </button>
                <button
                    [jhiFeatureToggle]="FeatureToggle.PlagiarismChecks"
                    class="check-plagiarism btn btn-primary"
                    (click)="checkPlagiarism()"
                    [overwriteDisabled]="detectionInProgress"
                >
                    <span>{{ plagiarismResult ? ('artemisApp.plagiarism.rerun' | artemisTranslate) : ('artemisApp.plagiarism.detect' | artemisTranslate) }}</span>
                </button>
                <ng-template #toggleDeleteModal let-modal>
                    <div class="modal-header">
                        <h4 class="modal-title">
                            <span jhiTranslate="artemisApp.plagiarism.cleanUp.confirmDialog.title">Clean up plagiarism results</span>
                        </h4>
                        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
                    </div>
                    <div class="modal-body">
                        <p jhiTranslate="artemisApp.plagiarism.cleanUp.confirmDialog.question">Are you sure you want to delete the plagiarism comparisons?</p>
                        <div class="form-check flex-grow-0">
                            <input
                                id="deleteAllPlagiarismComparisons"
                                class="form-check-input"
                                type="checkbox"
                                [checked]="deleteAllPlagiarismComparisons"
                                (change)="toggleDeleteAllPlagiarismComparisons()"
                            />
                            <label for="deleteAllPlagiarismComparisons" class="form-check-label">{{
                                'artemisApp.plagiarism.cleanUp.confirmDialog.deleteAll' | artemisTranslate
                            }}</label>
                        </div>
                        <p *ngIf="deleteAllPlagiarismComparisons" jhiTranslate="artemisApp.plagiarism.cleanUp.confirmDialog.warning" class="text-warning"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" (click)="modal.close('confirm')">
                            <span jhiTranslate="artemisApp.plagiarism.cleanUp.confirmDialog.submit">Clean up</span>
                        </button>
                    </div>
                </ng-template>
                <button
                    *ngIf="exercise.isAtLeastInstructor && plagiarismResult"
                    [jhiFeatureToggle]="FeatureToggle.PlagiarismChecks"
                    class="check-plagiarism btn btn-danger"
                    (click)="openCleanUpModal(toggleDeleteModal)"
                    [overwriteDisabled]="detectionInProgress"
                >
                    <span jhiTranslate="artemisApp.plagiarism.cleanUp.confirmDialog.submit">Clean up</span>
                </button>

                <div ngbDropdown *ngIf="plagiarismResult">
                    <button class="btn btn-secondary btn-block" id="download-plagiarism" ngbDropdownToggle>
                        <span>Download</span>
                    </button>
                    <div ngbDropdownMenu aria-labelledby="download-plagiarism">
                        <button type="button" (click)="downloadPlagiarismResultsJson()" ngbDropdownItem>JSON</button>
                        <button type="button" (click)="downloadPlagiarismResultsCsv()" ngbDropdownItem>CSV</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="plagiarism-header-options" [hidden]="!showOptions">
            <div class="plagiarism-option">
                <div class="plagiarism-option-label" jhiTranslate="artemisApp.plagiarism.similarityThreshold">Similarity Threshold</div>
                <fa-icon [icon]="faQuestionCircle" placement="bottom auto" [ngbTooltip]="'artemisApp.plagiarism.similarityThresholdTooltip' | artemisTranslate"></fa-icon>
                <input type="number" required class="form-control" min="0" max="100" step="5" id="plagiarism-similarity-threshold" [(ngModel)]="similarityThreshold" />
            </div>

            <div class="plagiarism-option" [class.disabled]="!enableMinimumScore">
                <div class="plagiarism-checkbox form-check" for="enableMinimumScore">
                    <input type="checkbox" id="enableMinimumScore" class="plagiarism-option-checkbox form-check-input" [(ngModel)]="enableMinimumScore" checked />
                    <div class="plagiarism-option-label form-check-label" jhiTranslate="artemisApp.plagiarism.minimumScore">Minimum Score</div>
                </div>
                <fa-icon [icon]="faQuestionCircle" placement="bottom auto" [ngbTooltip]="'artemisApp.plagiarism.minimumScoreTooltip' | artemisTranslate"></fa-icon>
                <input required type="number" [disabled]="!enableMinimumScore" class="form-control" min="0" max="100" id="plagiarism-minimum-score" [(ngModel)]="minimumScore" />
            </div>

            <div class="plagiarism-option" [class.disabled]="!enableMinimumSize" *ngIf="exercise.type !== PROGRAMMING">
                <div class="plagiarism-checkbox form-check" for="enableMinimumSize">
                    <input type="checkbox" id="enableMinimumSize" class="plagiarism-option-checkbox form-check-input" [(ngModel)]="enableMinimumSize" checked />
                    <label for="enableMinimumSize" class="plagiarism-option-label form-check-label" jhiTranslate="artemisApp.plagiarism.minimumSize">Minimum Size</label>
                </div>
                <fa-icon [icon]="faQuestionCircle" placement="bottom auto" [ngbTooltip]="getMinimumSizeTooltip() | artemisTranslate"></fa-icon>
                <input required type="number" [disabled]="!enableMinimumSize" class="form-control" min="0" max="100" id="plagiarism-minimum-size" [(ngModel)]="minimumSize" />
            </div>

            <div *ngIf="isProgrammingExercise()" class="plagiarism-checkbox form-check" for="generateJPlagReport">
                <input class="form-check-input" type="checkbox" id="generateJPlagReport" [(ngModel)]="generateJPlagReport" checked />
                <label for="generateJPlagReport" class="plagiarism-option-label" jhiTranslate="artemisApp.plagiarism.generateJplagReport">Generate JPlag Report</label>
            </div>
        </div>
    </div>

    <div class="plagiarism-body" *ngIf="plagiarismResult && !detectionInProgress">
        <jhi-plagiarism-sidebar
            [showRunDetails]="showRunDetails"
            (showRunDetailsChange)="showSimilarityDistribution($event)"
            [comparisons]="visibleComparisons"
            [offset]="sidebarOffset"
            (selectIndex)="selectComparisonWithID($event)"
            [activeID]="selectedComparisonId"
            [casesFiltered]="chartFilterApplied"
        ></jhi-plagiarism-sidebar>

        <jhi-plagiarism-details
            [hidden]="showRunDetails"
            [comparison]="plagiarismResult.comparisons ? getSelectedComparison() : undefined"
            [exercise]="exercise"
        ></jhi-plagiarism-details>

        <jhi-plagiarism-run-details [hidden]="!showRunDetails" [plagiarismResult]="plagiarismResult" (similaritySelected)="filterByChart($event)"></jhi-plagiarism-run-details>
    </div>

    <div class="plagiarism-empty" *ngIf="!plagiarismResult || detectionInProgress">
        <div class="d-flex flex-column" *ngIf="detectionInProgress">
            <div class="spinner-border text-primary align-self-center mb-1" role="status">
                <span class="sr-only"></span>
            </div>
            <p>{{ detectionInProgressMessage }}</p>
        </div>
        <span class="plagiarism-empty-label" *ngIf="!detectionInProgress">
            {{ 'artemisApp.plagiarism.empty' | artemisTranslate }}
        </span>
    </div>
</div>
