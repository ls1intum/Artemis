<div class="row justify-content-center">
    <form name="editForm" role="form" novalidate #editForm="ngForm" class="col-md-8">
        <div class="d-flex align-items-center">
            @if (!mathExercise.id) {
                <h2 id="jhi-math-exercise-heading-create" class="mb-0" jhiTranslate="artemisApp.mathExercise.home.createLabel">Create a new Math Exercise</h2>
            } @else if (!isImport && mathExercise.id) {
                <h2 id="jhi-math-exercise-heading-edit" class="mb-0" jhiTranslate="artemisApp.mathExercise.home.editLabel">Edit Math Exercise</h2>
            } @else if (isImport) {
                <h2 id="jhi-math-exercise-heading-import" class="mb-0" jhiTranslate="artemisApp.mathExercise.home.importLabel">Import Math Exercise</h2>
            }
            <jhi-documentation-button [type]="documentationType" />
        </div>
        <hr />
        <div>
            <div class="form-group" [hidden]="isImport || !mathExercise.id">
                <label for="id" jhiTranslate="global.field.id">ID</label>
                <input type="text" class="form-control" id="id" name="id" [(ngModel)]="mathExercise.id" readonly />
            </div>
            <jhi-exercise-title-channel-name [exercise]="mathExercise" [course]="mathExercise.course" [minTitleLength]="3" [isImport]="isImport" [isExamMode]="isExamMode" />
            @if (!isExamMode) {
                <div class="form-group position-relative">
                    <label class="form-control-label" jhiTranslate="artemisApp.exercise.categories">Categories</label>
                    <jhi-help-icon text="artemisApp.exercise.categoriesTooltip" />
                    <jhi-category-selector [categories]="exerciseCategories" [existingCategories]="existingCategories" (selectedCategories)="updateCategories($event)" />
                </div>
            }
            <div class="form-group">
                <label class="form-control-label" jhiTranslate="artemisApp.exercise.difficulty">Difficulty</label>
                <div>
                    <jhi-difficulty-picker [exercise]="mathExercise" />
                </div>
            </div>
            <jhi-team-config-form-group class="form-element" [exercise]="mathExercise" [isImport]="isImport" />
            @if (!isExamMode) {
                <div class="d-flex">
                    <div class="form-group flex-grow-1">
                        <jhi-date-time-picker
                            class="form-element"
                            id="pick-releaseDate"
                            labelName="{{ 'artemisApp.exercise.releaseDate' | artemisTranslate }}"
                            [(ngModel)]="mathExercise.releaseDate"
                            (valueChange)="validateDate()"
                            [error]="false"
                            name="releaseDate"
                        />
                    </div>
                    <div class="form-group flex-grow-1 ms-3">
                        <jhi-date-time-picker
                            class="form-element"
                            id="pick-startDate"
                            name="startDate"
                            [error]="!!mathExercise.startDateError"
                            labelName="{{ 'artemisApp.exercise.startDate' | artemisTranslate }}"
                            (valueChange)="validateDate()"
                            [(ngModel)]="mathExercise.startDate"
                        />
                        @if (mathExercise.startDateError) {
                            <span class="invalid-feedback">{{ 'artemisApp.exercise.startDateError' | artemisTranslate }}</span>
                        }
                    </div>
                </div>
            }
            @if (!isExamMode) {
                <div class="d-flex">
                    <div class="form-group flex-grow-1">
                        <jhi-date-time-picker
                            class="form-element"
                            id="pick-dueDate"
                            name="dueDate"
                            [error]="!!mathExercise.dueDateError"
                            labelName="{{ 'artemisApp.exercise.dueDate' | artemisTranslate }}"
                            (valueChange)="validateDate()"
                            [(ngModel)]="mathExercise.dueDate"
                        />
                        @if (mathExercise.dueDateError) {
                            <span class="invalid-feedback">{{ 'artemisApp.exercise.dueDateError' | artemisTranslate }}</span>
                        }
                    </div>
                    <div class="form-group flex-grow-1 ms-3">
                        <jhi-date-time-picker
                            class="form-element"
                            id="pick-assessmentDueDate"
                            name="assessmentDueDate"
                            [error]="!!mathExercise.assessmentDueDateError"
                            labelName="{{ 'artemisApp.exercise.assessmentDueDate' | artemisTranslate }}"
                            (valueChange)="validateDate()"
                            [(ngModel)]="mathExercise.assessmentDueDate"
                        />
                        @if (mathExercise.assessmentDueDateError) {
                            <span class="invalid-feedback">{{ 'artemisApp.exercise.assessmentDueDateError' | artemisTranslate }}</span>
                        }
                    </div>
                </div>
            }
            <div class="form-group">
                <label class="form-control-label">{{
                    'artemisApp.exercise.includedInOverallScore' + (mathExercise.course ? 'Course' : 'Exam') + 'Label' | artemisTranslate
                }}</label>
                <div>
                    <jhi-included-in-overall-score-picker
                        [(includedInOverallScore)]="mathExercise.includedInOverallScore"
                        (includedInOverallScoreChange)="validateDate()"
                        [allowNotIncluded]="!isExamMode"
                    />
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label class="form-control-label" jhiTranslate="artemisApp.exercise.points" for="field_points">Points</label>
                        <input
                            required
                            type="number"
                            class="form-control"
                            [customMin]="1"
                            [customMax]="9999"
                            name="points"
                            #points="ngModel"
                            id="field_points"
                            [(ngModel)]="mathExercise.maxPoints"
                        />
                        @if (points?.invalid && (points?.dirty || points?.touched) && points?.errors) {
                            <div class="alert alert-danger">
                                {{ 'artemisApp.exercise.pointsError' | artemisTranslate }}
                            </div>
                        }
                    </div>
                </div>
                <div class="col">
                    <div class="form-group" [hidden]="mathExercise.includedInOverallScore !== IncludedInOverallScore.INCLUDED_COMPLETELY">
                        <label class="form-control-label" jhiTranslate="artemisApp.exercise.bonusPoints" for="field_bonusPoints">Bonus Points</label>
                        <input
                            type="number"
                            [required]="mathExercise.includedInOverallScore === IncludedInOverallScore.INCLUDED_COMPLETELY"
                            class="form-control"
                            [customMin]="0"
                            [customMax]="9999"
                            name="bonusPoints"
                            id="field_bonusPoints"
                            [(ngModel)]="mathExercise.bonusPoints"
                            #bonusPoints="ngModel"
                        />
                        @if (bonusPoints?.invalid && (bonusPoints?.dirty || bonusPoints?.touched) && bonusPoints?.errors) {
                            <div class="alert alert-danger" [hidden]="mathExercise.includedInOverallScore !== IncludedInOverallScore.INCLUDED_COMPLETELY">
                                {{ 'artemisApp.exercise.bonusPointsError' | artemisTranslate }}
                            </div>
                        }
                    </div>
                </div>
            </div>
            @if ((isAthenaEnabled$ | async) && !isExamMode) {
                <div class="form-group">
                    <div class="form-check custom-control custom-checkbox">
                        <input
                            type="checkbox"
                            id="feedbackSuggestionsEnabled"
                            [ngModel]="mathExercise.feedbackSuggestionsEnabled"
                            (ngModelChange)="mathExercise.feedbackSuggestionsEnabled = !!$event"
                            class="form-check-input custom-control-input"
                            name="feedbackSuggestionsEnabled"
                        />
                        <label class="form-check-label custom-control-label" for="feedbackSuggestionsEnabled" jhiTranslate="artemisApp.exercise.feedbackSuggestionsEnabled"></label>
                        <jhi-help-icon placement="right auto" [text]="'artemisApp.exercise.feedbackSuggestionsEnabledTooltip'" />
                    </div>
                </div>
            }
            <!--        <jhi-exercise-update-plagiarism *ngIf="!isExamMode" [exercise]="mathExercise"></jhi-exercise-update-plagiarism>-->
            <jhi-presentation-score-checkbox [exercise]="mathExercise" />

            <!--        <div class='form-group'>-->
            <!--            <label jhiTranslate='artemisApp.exercise.exampleSolution' for='exampleSolution'>Example Solution</label>-->
            <!--            <jhi-markdown-editor-->
            <!--                id='exampleSolution'-->
            <!--                class='markdown-editor'-->
            <!--                [domainCommands]='domainCommandsSampleSolution'-->
            <!--                [(markdown)]='mathExercise.exampleSolution'-->
            <!--                [editorMode]='EditorMode.LATEX'-->
            <!--            ></jhi-markdown-editor>-->
            <!--        </div>-->
            @if (!isExamMode) {
                <div class="form-group">
                    <jhi-date-time-picker
                        class="form-element"
                        name="exampleSolutionPublicationDate"
                        labelName="{{ 'artemisApp.exercise.exampleSolutionPublicationDate' | artemisTranslate }}"
                        [(ngModel)]="mathExercise.exampleSolutionPublicationDate"
                        [error]="mathExercise.exampleSolutionPublicationDateError!"
                        (valueChange)="validateDate()"
                    />
                    @if (mathExercise.exampleSolutionPublicationDateError) {
                        <span class="invalid-feedback">{{ 'artemisApp.exercise.exampleSolutionPublicationDateError' | artemisTranslate }}</span>
                    }
                </div>
            }
            @if (!isExamMode) {
                <div class="form-group">
                    <jhi-competency-selection
                        id="competencies"
                        [labelName]="'artemisApp.competency.link.title' | artemisTranslate"
                        [labelTooltip]="'artemisApp.competency.link.exercise' | artemisTranslate"
                        [(ngModel)]="mathExercise.competencies"
                        name="competencies"
                    />
                </div>
            }
            <div class="form-group">
                <label class="form-control-label" jhiTranslate="artemisApp.exercise.assessmentInstructions" for="gradingInstructions">Assessment Instructions</label>
                <jhi-grading-instructions-details id="gradingInstructions" [exercise]="mathExercise" />
            </div>
            <jhi-exercise-update-notification [exercise]="mathExercise" [isImport]="isImport" [(notificationText)]="notificationText" />
        </div>

        <div>
            <button type="button" class="btn btn-secondary" (click)="previousState()">
                <fa-icon [icon]="faBan" />&nbsp;<span jhiTranslate="entity.action.cancel">Cancel</span>
            </button>

            <button
                type="submit"
                (click)="save()"
                class="btn btn-primary"
                id="submit-entity"
                [disabled]="
                    editForm.form.invalid || isSaving || mathExercise.dueDateError || mathExercise.assessmentDueDateError || mathExercise.exampleSolutionPublicationDateError
                "
            >
                <fa-icon [icon]="faSave" />
                @if (isImport) {
                    <span jhiTranslate="artemisApp.mathExercise.submitButton.import">Import</span>
                }
                @if (!isImport && mathExercise.id) {
                    <span jhiTranslate="artemisApp.mathExercise.submitButton.save">Save</span>
                }
                @if (!isImport && !mathExercise.id) {
                    <span jhiTranslate="artemisApp.mathExercise.submitButton.create">Create</span>
                }
            </button>
        </div>
    </form>
</div>
