@if (isLoading || competencyLinks?.length) {
    <div>
        <div class="d-flex align-items-center">
            @if (labelName) {
                <label for="competency-selector">
                    {{ labelName }}
                </label>
            }
            @if (labelTooltip) {
                <fa-stack class="text-secondary icon-full-size" [ngbTooltip]="labelTooltip">
                    <fa-icon [icon]="faQuestionCircle" stackItemSize="1x" />
                </fa-stack>
            }
            <button
                type="button"
                class="btn btn-outline-primary btn-sm ms-2"
                [disabled]="isSuggesting || disabled || !exerciseDescription?.trim()"
                (click)="suggestCompetencies()"
                [ngbTooltip]="exerciseDescription ? 'Get AI suggestions based on exercise description' : 'Enter exercise description to get suggestions'"
            >
                @if (isSuggesting) {
                    <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                } @else {
                    <fa-icon [icon]="faLightbulb" class="me-1" />
                }
                Suggest
            </button>
        </div>
        @if (isLoading) {
            <div>
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        } @else {
            <div class="competency-selector p-2" id="competency-selector">
                @for (competencyLink of competencyLinks; track competencyLink) {
                    @if (competencyLink && competencyLink.competency && competencyLink.competency.id) {
                        <div>
                            <input
                                id="competency-{{ competencyLink.competency.id }}"
                                type="checkbox"
                                [ngModel]="checkboxStates[competencyLink.competency.id]"
                                (ngModelChange)="toggleCompetency(competencyLink)"
                                [disabled]="disabled"
                            />
                            <label for="competency-{{ competencyLink.competency.id }}" class="d-flex align-items-center">
                                <fa-icon [icon]="getIcon(competencyLink.competency.taxonomy)" [fixedWidth]="true" />
                                <span>{{ competencyLink.competency.title }}</span>
                                @if (isSuggested(competencyLink.competency.id)) {
                                    <fa-icon [icon]="faStar" class="text-warning ms-2" [ngbTooltip]="'AI suggested competency'" />
                                }
                            </label>
                            @if (checkboxStates[competencyLink.competency.id]) {
                                <select
                                    [ngModel]="
                                        competencyLink.weight < LOW_COMPETENCY_LINK_WEIGHT_CUT_OFF
                                            ? LOW_COMPETENCY_LINK_WEIGHT
                                            : competencyLink.weight < MEDIUM_COMPETENCY_LINK_WEIGHT_CUT_OFF
                                              ? MEDIUM_COMPETENCY_LINK_WEIGHT
                                              : HIGH_COMPETENCY_LINK_WEIGHT
                                    "
                                    (ngModelChange)="updateLinkWeight(competencyLink, $event)"
                                    ngbTooltip="{{ 'artemisApp.competency.link.weightTooltip' | artemisTranslate }}"
                                >
                                    <option [ngValue]="LOW_COMPETENCY_LINK_WEIGHT" [jhiTranslate]="'artemisApp.competency.link.weightLabels.low'"></option>
                                    <option [ngValue]="MEDIUM_COMPETENCY_LINK_WEIGHT" [jhiTranslate]="'artemisApp.competency.link.weightLabels.medium'"></option>
                                    <option [ngValue]="HIGH_COMPETENCY_LINK_WEIGHT" [jhiTranslate]="'artemisApp.competency.link.weightLabels.high'"></option>
                                </select>
                            }
                        </div>
                    }
                }
            </div>
        }
    </div>
}
