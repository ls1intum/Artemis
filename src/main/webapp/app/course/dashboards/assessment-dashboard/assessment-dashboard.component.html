<div class="course-info-bar">
    <div class="row justify-content-between">
        <div class="col-8">
            <h2>
                <h2 *ngIf="!isExamMode">{{ 'artemisApp.assessmentDashboard.pageHeader' | translate }} {{ course?.title }}</h2>
                <h2 *ngIf="isExamMode">
                    {{ !isTestRun ? ('artemisApp.assessmentDashboard.pageHeaderExam' | translate) : ('artemisApp.assessmentDashboard.pageHeaderExamTestRun' | translate) }}
                    {{ exam?.title }}
                </h2>
                <a
                    *ngIf="!isExamMode && course?.studentQuestionsEnabled && course?.isAtLeastTutor"
                    routerLinkActive="active"
                    [routerLink]="['/course-management', course?.id, 'questions']"
                    class="text-white card-link"
                >
                    <fa-icon [icon]="'comment'"></fa-icon>
                    <span jhiTranslate="entity.action.questionsAndAnswers">Q&A</span>
                </a>
            </h2>
        </div>
    </div>
    <div *ngIf="isExamMode && !isTestRun" class="row justify-content-between">
        <div class="col-8">
            <ul>
                <li><span jhiTranslate="artemisApp.exam.endDate">Exam End Date</span> : {{ exam?.endDate | artemisDate }}</li>
                <li><span jhiTranslate="artemisApp.exam.publishResultsDate">Publish Results Date</span> : {{ exam?.publishResultsDate | artemisDate }}</li>
            </ul>
        </div>
    </div>
</div>

<jhi-alert></jhi-alert>
<div
    *ngIf="isTestRun && exam?.numberOfCorrectionRoundsInExam > 1"
    style="margin-top: 1em"
    class="alert alert-warning"
    jhiTranslate="artemisApp.examManagement.testRun.secondCorrectionHint"
>
    Hint: The second correction is not applicable to test runs.
</div>

<div *ngIf="course">
    <!-- TODO: also support this for the exam mode -->
    <div id="assessment-statistics" class="guided-tour-assessment-stats">
        <div class="container-fluid">
            <div class="row mt-3">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4 class="card-title">{{ 'artemisApp.assessmentDashboard.informationAboutYourAssessments' | translate }}</h4>
                        </div>
                        <div class="card-body">
                            <ul *ngIf="!isExamMode">
                                <li>
                                    <b>{{ 'artemisApp.assessmentDashboard.yourAssessments' | translate }}:</b> {{ numberOfTutorAssessments }}
                                </li>
                                <li>
                                    <a [routerLink]="['/course-management', courseId, 'complaints']" [queryParams]="{ tutorId: tutor.id }">
                                        <b> {{ 'artemisApp.assessmentDashboard.complaintsAboutYourAssessments' | translate }}:</b> {{ numberOfTutorComplaints }}
                                    </a>
                                </li>
                                <li>
                                    <a [routerLink]="['/course-management', courseId, 'more-feedback-requests']" [queryParams]="{ tutorId: tutor.id }">
                                        <b> {{ 'artemisApp.assessmentDashboard.moreFeedbackRequestsForYourAssessments' | translate }}:</b> {{ numberOfTutorMoreFeedbackRequests }}
                                    </a>
                                </li>
                                <li>
                                    <a [routerLink]="['/course-management', courseId, 'assessment-locks']" [queryParams]="{ tutorId: tutor.id }">
                                        <b>{{ 'artemisApp.assessmentDashboard.yourAssessmentLocks' | translate }}:</b> {{ numberOfAssessmentLocks }}
                                    </a>
                                </li>
                            </ul>
                            <!-- Information about assessments for exam mode -->
                            <ul *ngIf="isExamMode">
                                <li>
                                    <b>{{ 'artemisApp.assessmentDashboard.yourAssessments' | translate }}:</b> {{ numberOfTutorAssessments }}
                                </li>
                                <li>
                                    <a [routerLink]="['/course-management', courseId, 'exams', examId, 'complaints']" [queryParams]="{ tutorId: tutor.id }">
                                        <b> {{ 'artemisApp.assessmentDashboard.complaintsAboutYourAssessments' | translate }}:</b> {{ numberOfTutorComplaints }}
                                    </a>
                                </li>
                                <li>
                                    <a [routerLink]="['/course-management', courseId, 'exams', examId, 'assessment-locks']" [queryParams]="{ tutorId: tutor.id }">
                                        <b>{{ 'artemisApp.assessmentDashboard.yourAssessmentLocks' | translate }}:</b> {{ numberOfAssessmentLocks }}
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4 class="card-title">{{ 'artemisApp.instructorCourseDashboard.informationAboutCourse' | translate }}</h4>
                        </div>
                        <div class="card-body">
                            <ul>
                                <li>
                                    <b>{{ 'artemisApp.assessmentDashboard.totalAssessments' | translate }}:</b>
                                    {{ totalNumberOfAssessments.total }} / {{ numberOfSubmissions.total * numberOfCorrectionRounds }} ({{ totalAssessmentPercentage }}%)
                                </li>
                                <li *ngIf="isExamMode">
                                    <b>{{ 'artemisApp.assessmentDashboard.totalAssessmentsForCorrectionrounds' | translate }}:</b>
                                    {{ numberOfAssessmentsOfCorrectionRounds[0].inTime }} -
                                    <span *ngIf="numberOfAssessmentsOfCorrectionRounds[1]">{{ numberOfAssessmentsOfCorrectionRounds[1].inTime }}</span>
                                </li>
                                <li>
                                    <b>{{ 'artemisApp.assessmentDashboard.totalComplaints' | translate }}:</b> {{ numberOfComplaints }}
                                </li>
                                <li *ngIf="!isExamMode">
                                    <b>{{ 'artemisApp.assessmentDashboard.totalMoreFeedbackRequests' | translate }}:</b> {{ numberOfMoreFeedbackRequests }}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <div *ngIf="!isTestRun" class="guided-tour-form-check form-check col-6 align-baseline">
            <input type="checkbox" name="showFinishedExercise" id="field_showFinishedExercise" [ngModel]="showFinishedExercises" (ngModelChange)="triggerFinishedExercises()" />
            <label class="form-check-label" for="field_showFinishedExercise">
                {{ 'artemisApp.assessmentDashboard.showFinishedExercises' | translate }}
            </label>
        </div>
        <table class="table exercise-table guided-tour-exercise-table">
            <thead>
                <tr jhiSort [(predicate)]="exercisesSortingPredicate" [(ascending)]="exercisesReverseOrder" [callback]="sortRows.bind(this)">
                    <th jhiSortBy="type">
                        <a class="th-link">{{ 'artemisApp.assessmentDashboard.exerciseType' | translate }}</a>
                        <fa-icon [icon]="'sort'"></fa-icon>
                    </th>
                    <th jhiSortBy="title">
                        <a class="th-link">{{ 'artemisApp.assessmentDashboard.exercise' | translate }}</a>
                        <fa-icon [icon]="'sort'"></fa-icon>
                    </th>
                    <th *ngIf="!isTestRun">{{ 'artemisApp.assessmentDashboard.yourStatus' | translate }}</th>
                    <th jhiSortBy="dueDate" *ngIf="!isExamMode">
                        <a class="th-link">{{ 'artemisApp.assessmentDashboard.exerciseDueDate' | translate }}</a>
                        <fa-icon [icon]="'sort'"></fa-icon>
                    </th>
                    <th jhiSortBy="assessmentDueDate" *ngIf="!isExamMode">
                        <a class="th-link">{{ 'artemisApp.assessmentDashboard.assessmentsDueDate' | translate }}</a>
                        <fa-icon [icon]="'sort'"></fa-icon>
                    </th>
                    <th>{{ 'artemisApp.assessmentDashboard.actions' | translate }}</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let exercise of exercises">
                    <td>
                        <fa-icon [icon]="getIcon(exercise.type)" placement="right" [ngbTooltip]="getIconTooltip(exercise.type) | translate" container="body"></fa-icon>
                    </td>
                    <td>
                        <span>{{ exercise.title }}</span>
                        <span
                            class="badge badge-warning"
                            *ngIf="!exercise.visibleToStudents"
                            placement="right"
                            ngbTooltip="Only visible to teaching assistants and instructors. Release date: {{ exercise.releaseDate | artemisDate }}"
                        >
                            {{ 'artemisApp.assessmentDashboard.notReleased' | translate }}</span
                        >
                        <span class="badge badge-success" [hidden]="!exercise.isActiveQuiz">Live</span>
                    </td>
                    <td *ngIf="!isTestRun">
                        <jhi-tutor-participation-graph
                            [exercise]="exercise"
                            [class.guided-tour]="exercise === exerciseForGuidedTour"
                            [tutorParticipation]="exercise.tutorParticipations[0]"
                            [numberOfSubmissions]="exercise.numberOfSubmissions"
                            [totalNumberOfAssessments]="exercise.totalNumberOfAssessments"
                            [numberOfComplaints]="exercise.numberOfComplaints"
                            [numberOfOpenComplaints]="exercise.numberOfOpenComplaints"
                            [numberOfMoreFeedbackRequests]="exercise.numberOfMoreFeedbackRequests"
                            [numberOfOpenMoreFeedbackRequests]="exercise.numberOfOpenMoreFeedbackRequests"
                            [numberOfAssessmentsOfCorrectionRounds]="exercise.numberOfAssessmentsOfCorrectionRounds"
                        >
                        </jhi-tutor-participation-graph>
                    </td>
                    <td *ngIf="!isExamMode">
                        <span placement="right" [hidden]="!exercise.dueDate" ngbTooltip="{{ exercise.dueDate | artemisDate }}">
                            {{ exercise.dueDate | amTimeAgo }}
                        </span>
                    </td>
                    <td *ngIf="!isExamMode">
                        <span placement="right" [hidden]="!exercise.assessmentDueDate" ngbTooltip="{{ exercise.assessmentDueDate | artemisDate }}">
                            {{ exercise.assessmentDueDate | amTimeAgo }}
                        </span>
                    </td>

                    <td>
                        <ng-container *ngIf="!exercise.teamMode; else teamsLink">
                            <ng-container *ngIf="!isTestRun; else testRun">
                                <a
                                    [routerLink]="['/course-management', courseId, 'exercises', exercise.id, 'tutor-dashboard']"
                                    class="btn btn-info btn-sm mr-1"
                                    [class.guided-tour]="exercise === exerciseForGuidedTour"
                                >
                                    <span class="d-none d-md-inline" jhiTranslate="entity.action.exerciseDashboard">Exercise dashboard</span>
                                </a>
                            </ng-container>
                            <ng-template #testRun>
                                <a
                                    [routerLink]="['/course-management', courseId, 'exercises', exercise.id, 'test-run-exercise-assessment-dashboard']"
                                    class="btn btn-info btn-sm mr-1"
                                    [class.guided-tour]="exercise === exerciseForGuidedTour"
                                >
                                    <span class="d-none d-md-inline" jhiTranslate="entity.action.exerciseDashboard">Exercise dashboard</span>
                                </a>
                            </ng-template>
                        </ng-container>

                        <ng-template #teamsLink>
                            <a
                                [routerLink]="['/course-management', courseId, 'exercises', exercise.id, 'teams']"
                                [queryParams]="{ filter: TeamFilterProp.OWN }"
                                class="btn btn-info btn-sm mr-1"
                                [class.guided-tour]="exercise === exerciseForGuidedTour"
                            >
                                <span class="d-none d-md-inline" jhiTranslate="artemisApp.assessmentDashboard.exerciseTeams">Exercise Teams</span>
                            </a>
                        </ng-template>

                        <span
                            class="col-lg-3 col-md-6 col-sm-6 align-self-center"
                            *ngIf="isAtLeastInstructor && isExamMode && !isTestRun && exam?.numberOfCorrectionRoundsInExam > 1"
                        >
                            <ng-container *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_INSTRUCTOR']">
                                <jhi-second-correction-enable-button
                                    (ngModelChange)="toggleSecondCorrection(exercise.id)"
                                    [(secondCorrectionEnabled)]="exercise.secondCorrectionEnabled"
                                    [(toggelingSecondCorrectionButton)]="toggelingSecondCorrectionButton"
                                ></jhi-second-correction-enable-button>
                            </ng-container>
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <h2 *ngIf="!isExamMode">{{ 'artemisApp.instructorCourseDashboard.tutorLeaderboard.courseTitle' | translate }}</h2>

    <jhi-tutor-leaderboard *ngIf="!isExamMode" [tutorsData]="stats.tutorLeaderboardEntries" [course]="course"></jhi-tutor-leaderboard>
</div>
