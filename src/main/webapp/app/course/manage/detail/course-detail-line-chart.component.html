<div class="course-detail-parent-container col">
    <div class="d-flex flex-nowrap justify-content-center gap-2 mt-3">
        <a [routerLink]="['/course-management', course.id, 'course-statistics']" class="text-center">
            <h5>{{ 'artemisApp.courseStatistics.activeStudents' | artemisTranslate }}</h5>
        </a>
        <jhi-help-icon class="chart-explanation-tooltip" placement="right auto" text="artemisApp.courseStatistics.activeStudentsExplanation"></jhi-help-icon>
    </div>
    @if (startDateAlreadyPassed) {
        <ng-container>
            <div>
                <div class="d-flex justify-content-between me-3">
                    <div class="d-flex gap-1">
                        <button class="btn" [disabled]="startDateDisplayed" (click)="switchTimeSpan(LEFT)">
                            <fa-icon [icon]="faArrowLeft"></fa-icon>
                        </button>
                        <button class="btn" [disabled]="showsCurrentWeek" (click)="switchTimeSpan(RIGHT)">
                            <fa-icon [icon]="faArrowRight"></fa-icon>
                        </button>
                    </div>
                    @if (course.startDate) {
                        <div class="d-flex gap-2">
                            <button
                                class="btn"
                                [disabled]="!showLifetimeOverview"
                                (click)="displayDefaultChartScope()"
                                ngbTooltip="{{ 'artemisApp.courseStatistics.scopeButton.recentWeekTooltip' | artemisTranslate }}"
                            >
                                {{ 'artemisApp.courseStatistics.scopeButton.recentWeekButton' | artemisTranslate }}
                            </button>
                            <button
                                class="btn"
                                [disabled]="showLifetimeOverview"
                                (click)="displayLifetimeOverview()"
                                ngbTooltip="{{ 'artemisApp.courseStatistics.scopeButton.lifetimeOverviewTooltip' | artemisTranslate }}"
                            >
                                {{ 'artemisApp.courseStatistics.scopeButton.lifetimeOverviewButtonLabel' | artemisTranslate }}
                            </button>
                        </div>
                    }
                </div>
                <div #containerRef class="d-flex mt-1 justify-content-center align-items-center h-99">
                    @if (!loading) {
                        <ngx-charts-line-chart
                            [view]="[containerRef.offsetWidth, 320]"
                            [scheme]="chartColor"
                            [legend]="legend"
                            [showXAxisLabel]="showXAxisLabel"
                            [showYAxisLabel]="showYAxisLabel"
                            [xAxis]="xAxis"
                            [yAxis]="yAxis"
                            [xAxisLabel]="xAxisLabel"
                            [yAxisLabel]="yAxisLabel"
                            [timeline]="timeline"
                            [results]="data"
                            [yScaleMin]="0"
                            [yScaleMax]="100"
                            [yAxisTickFormatting]="formatYAxis"
                            [curve]="curve"
                            [referenceLines]="[average]"
                            [showRefLines]="true"
                            [showRefLabels]="true"
                        >
                            <ng-template #tooltipTemplate let-model="model">
                                <span>{{ model.series }} in {{ model.name }}: </span><br />
                                <b class="tooltip-header">{{ findAbsoluteValue(model) }} ({{ model.value }}%)</b>
                            </ng-template>
                            <ng-template #seriesTooltipTemplate let-model="model">
                                @if (model.length) {
                                    <span> {{ model[0].name }}: {{ findAbsoluteValue(model[0]) }} </span>
                                }
                            </ng-template>
                        </ngx-charts-line-chart>
                    } @else {
                        <h1 class="spinner">
                            <fa-icon [icon]="faSpinner" [spin]="true">&nbsp;</fa-icon>
                        </h1>
                    }
                </div>
            </div>
        </ng-container>
    } @else {
        <ng-template>
            <h4 class="text-center mt-3">{{ 'artemisApp.course.notStartedYet' | artemisTranslate }}</h4>
            <h3 class="text-center">{{ course.startDate | artemisDate }}</h3>
        </ng-template>
    }
</div>
