<div class="row">
    <div class="col-12 mb-2">
        <div class="alert alert-info">
            {{ 'artemisApp.generic.timeZone' | artemisTranslate: { timeZone } }}
        </div>
    </div>
    <!-- Todo: ButtonRadio timeframe selector -->
    <div class="col-12">
        @if (form) {
            <form class="row" [formGroup]="form" (ngSubmit)="submitForm()">
                <div class="btn-group" role="group">
                    <input
                        type="radio"
                        class="btn-check"
                        name="timeFrame"
                        id="FreePeriod"
                        autocomplete="off"
                        [checked]="timeFrame === TimeFrame.Period"
                        (click)="setTimeFrame(TimeFrame.Period)"
                    />
                    <label class="btn btn-outline-primary" for="FreePeriod">{{ 'artemisApp.forms.tutorialFreePeriodForm.timeFrame.period' | artemisTranslate }}</label>

                    <input
                        type="radio"
                        class="btn-check"
                        name="timeFrame"
                        id="FreeDay"
                        autocomplete="off"
                        [checked]="timeFrame === TimeFrame.Day"
                        (click)="setTimeFrame(TimeFrame.Day)"
                    />
                    <label class="btn btn-outline-primary" for="FreeDay">{{ 'artemisApp.forms.tutorialFreePeriodForm.timeFrame.day' | artemisTranslate }}</label>

                    <input
                        type="radio"
                        class="btn-check"
                        name="timeFrame"
                        id="FreePeriodWithinDay"
                        autocomplete="off"
                        [checked]="timeFrame === TimeFrame.PeriodWithinDay"
                        (click)="setTimeFrame(TimeFrame.PeriodWithinDay)"
                    />
                    <label class="btn btn-outline-primary" for="FreePeriodWithinDay">{{
                        'artemisApp.forms.tutorialFreePeriodForm.timeFrame.periodWithinDay' | artemisTranslate
                    }}</label>
                </div>

                <!-- Date -->
                <!--Todo: display correct labels for different timeframes-->
                <div>
                    @if (TimeFrameControl != TimeFrame.Period) {
                        <label class="form-label" for="startDate">{{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.label' | artemisTranslate }}</label>
                    } @else {
                        <label class="form-label" for="startDate">{{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.labelStart' | artemisTranslate }}</label>
                    }
                    <div class="input-group">
                        <input formControlName="startDate" required [owlDateTime]="startDate" class="d-none" />
                        <input
                            name="startDate"
                            id="startDate"
                            required
                            [class.is-invalid]="isStartDateInvalid"
                            (focus)="markStartDateAsTouched()"
                            [value]="startDateControl?.value | artemisDate: 'long-date' : false : undefined : true"
                            [owlDateTimeTrigger]="startDate"
                            readonly
                            class="form-control"
                        />
                        <button type="button" class="btn btn-secondary" [owlDateTimeTrigger]="startDate"><fa-icon [icon]="faCalendarAlt"></fa-icon></button>
                        <owl-date-time [firstDayOfWeek]="1" [pickerType]="'calendar'" #startDate [pickerMode]="'dialog'"></owl-date-time>
                    </div>
                    @if (startDateControl?.invalid && (startDateControl?.dirty || startDateControl?.touched) && startDateControl?.errors?.required) {
                        <div class="alert alert-danger">
                            {{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.requiredDateError' | artemisTranslate }}
                        </div>
                    }
                </div>
                <!--Todo: EndDate selector and lables. Where is the endDate saved before submitting the form?-->
                @if (TimeFrameControl === TimeFrame.Period) {
                    <label class="form-label" for="endDate">{{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.labelEnd' | artemisTranslate }}</label>
                    <div class="input-group">
                        <input formControlName="endDate" [(ngModel)]="formData.endDate" required [owlDateTime]="endDate" class="d-none" />
                        <input
                            name="endDate"
                            id="endDate"
                            required
                            [class.is-invalid]="isEndDateInvalid"
                            (focus)="markEndDateAsTouched()"
                            [value]="endDateControl?.value | artemisDate: 'long-date' : false : undefined : true"
                            [owlDateTimeTrigger]="endDate"
                            readonly
                            class="form-control"
                        />
                        <button type="button" class="btn btn-secondary" [owlDateTimeTrigger]="endDate">
                            <fa-icon [icon]="faCalendarAlt"></fa-icon>
                        </button>
                        <owl-date-time [firstDayOfWeek]="1" [pickerType]="'calendar'" #endDate [pickerMode]="'dialog'"></owl-date-time>
                    </div>
                    @if (endDateControl?.invalid && (endDateControl?.dirty || endDateControl?.touched) && endDateControl?.errors?.required) {
                        <div class="alert alert-danger">
                            {{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.requiredEndDateError' | artemisTranslate }}
                        </div>
                    } @else if (endDateControl?.dirty && !isStartBeforeEnd) {
                        <div class="alert alert-danger">
                            {{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.invalidEndDateError' | artemisTranslate }}
                        </div>
                    }
                } @else if (TimeFrameControl === TimeFrame.PeriodWithinDay) {
                    <label class="form-label" for="startTime">{{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.labelStartTime' | artemisTranslate }}</label>
                    <div class="input-group">
                        <input formControlName="startTime" [(ngModel)]="formData.startTime" required [owlDateTime]="startTime" class="d-none" />
                        <input
                            name="startTime"
                            id="startTime"
                            required
                            (focus)="markStartTimeAsTouched()"
                            [owlDateTimeTrigger]="startTime"
                            [owlDateTime]="startTime"
                            readonly
                            class="form-control"
                        />
                        <owl-date-time [pickerType]="'timer'" #startTime [pickerMode]="'dialog'"></owl-date-time>
                    </div>

                    <label class="form-label" for="endTime">{{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.labelEndTime' | artemisTranslate }}</label>
                    <div class="input-group">
                        <input formControlName="endTime" [(ngModel)]="formData.endTime" required [owlDateTime]="endTime" class="d-none" />
                        <input
                            name="endTime"
                            id="endTime"
                            required
                            (focus)="markEndTimeAsTouched()"
                            [owlDateTimeTrigger]="endTime"
                            [owlDateTime]="endTime"
                            readonly
                            class="form-control"
                        />
                        <owl-date-time [pickerType]="'timer'" #endTime [pickerMode]="'dialog'"></owl-date-time>
                    </div>
                    @if (endTimeControl?.dirty && startTimeControl?.dirty && !isStartBeforeEnd) {
                        <div class="alert alert-danger">
                            {{ 'artemisApp.forms.tutorialFreePeriodForm.dateInput.invalidEndDateError' | artemisTranslate }}
                        </div>
                    }
                }
                <!-- Reason -->
                <div class="form-group">
                    <label for="reason">{{ 'artemisApp.forms.tutorialFreePeriodForm.reasonInput.label' | artemisTranslate }}</label>
                    <textarea
                        class="form-control"
                        id="reason"
                        rows="6"
                        formControlName="reason"
                        [placeholder]="'artemisApp.forms.tutorialFreePeriodForm.reasonInput.placeholder' | artemisTranslate"
                    ></textarea>
                    @if (reasonControl?.invalid && (reasonControl?.dirty || (reasonControl?.touched && reasonControl?.errors?.maxlength))) {
                        <div class="alert alert-danger">
                            {{ 'artemisApp.forms.tutorialFreePeriodForm.reasonInput.maxLengthValidationError' | artemisTranslate: { max: '256' } }}
                        </div>
                    }
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <button id="submitButton" class="btn btn-primary" type="submit" [disabled]="!isSubmitPossible">
                            <span>{{ (isEditMode ? 'global.generic.edit' : 'global.generic.create') | artemisTranslate }}</span>
                        </button>
                    </div>
                </div>
            </form>
        }
    </div>
</div>
