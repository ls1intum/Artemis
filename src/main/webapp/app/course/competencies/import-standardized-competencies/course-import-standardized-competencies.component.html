<div class="container">
    <h2 jhiTranslate="artemisApp.standardizedCompetency.courseImport.title"></h2>
    <jhi-standardized-competency-filter
        [knowledgeAreasForSelect]="knowledgeAreasForSelect"
        [knowledgeAreaFilter]="knowledgeAreaFilter"
        [competencyTitleFilter]="competencyTitleFilter"
        (knowledgeAreaFilterChange)="filterByKnowledgeArea($event)"
        (competencyTitleFilterChange)="filterByCompetencyTitle($event)"
    />
    <div class="d-flex flex-wrap align-items-center mt-3 mb-2">
        <h3 class="me-3 mb-0" jhiTranslate="artemisApp.standardizedCompetency.title"></h3>
        <jhi-button
            class="me-1"
            [btnSize]="ButtonSize.SMALL"
            [icon]="faMinimize"
            (onClick)="treeControl.collapseAll()"
            tooltip="artemisApp.standardizedCompetency.manage.collapseButtonTooltip"
        />
        <jhi-button [btnSize]="ButtonSize.SMALL" [icon]="faMaximize" (onClick)="treeControl.expandAll()" tooltip="artemisApp.standardizedCompetency.manage.expandButtonTooltip" />
    </div>
    @if (dataSource.data.length) {
        <jhi-knowledge-area-tree [dataSource]="dataSource" [treeControl]="treeControl">
            <ng-template let-competency="competency" #competencyTemplate>
                <!-- TODO: add selection to template -->
                <div class="d-flex align-items-center">
                    <fa-icon
                        class="me-2"
                        [icon]="getIcon(competency.taxonomy)"
                        [ngbTooltip]="'artemisApp.competency.taxonomies.' + (competency.taxonomy ?? 'none') | artemisTranslate"
                        [fixedWidth]="true"
                    />
                    <h6 class="mb-0">{{ competency.title }}</h6>
                </div>
            </ng-template>
        </jhi-knowledge-area-tree>
        <!-- TODO: details component -->
    } @else if (isLoading) {
        <div class="d-flex justify-content-center">
            <div class="spinner-border" role="status">
                <span class="sr-only" jhiTranslate="loading"></span>
            </div>
        </div>
    } @else {
        <span jhiTranslate="artemisApp.standardizedCompetency.courseImport.empty"></span>
    }
    <h3 class="mt-3" jhiTranslate="artemisApp.standardizedCompetency.courseImport.selectedTitle"></h3>
    @if (competenciesToImport.length) {
        <table class="table table-striped align-middle flex">
            <thead class="thead-dark">
                <tr class="flex-row">
                    <th jhiSortBy="ID" class="col-0.5">
                        <span>#</span>
                    </th>
                    <th jhiSortBy="TITLE" class="col-2">
                        <span [jhiTranslate]="'artemisApp.standardizedCompetency.model.title'"></span>
                    </th>
                    <!-- do not allow sorting by description -->
                    <th class="col">
                        <span [jhiTranslate]="'artemisApp.standardizedCompetency.model.description'"></span>
                    </th>
                    <th class="col-2">
                        <span [jhiTranslate]="'artemisApp.standardizedCompetency.model.knowledgeArea'"></span>
                    </th>
                    <!-- column for buttons -->
                    <th class="col-1"></th>
                </tr>
            </thead>
            <tbody>
                @for (competency of competenciesToImport; track competency.id) {
                    <tr>
                        <td class="col-0.5">{{ competency.id }}</td>
                        <td class="col-2">{{ competency.title }}</td>
                        <td class="markdown-preview col" [innerHTML]="competency.description | htmlForMarkdown"></td>
                        <!-- TODO: replace this with real comps i guess -->
                        <td class="col-2">{{ competency.knowledgeAreaId }}</td>
                        <td class="col-1">
                            <!-- TODO: delete button -->
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    } @else {
        <span jhiTranslate="artemisApp.standardizedCompetency.courseImport.selectedEmpty"></span>
    }
    <div class="mt-3">
        @if (competenciesToImport.length) {
            <div class="mb-1" jhiTranslate="artemisApp.standardizedCompetency.courseImport.selectedCompetencies" [translateValues]="{ count: competenciesToImport.length }"></div>
        }
        <jhi-button [btnType]="ButtonType.SECONDARY" [title]="'entity.action.cancel'" [icon]="faBan" (onClick)="cancel()" />
        <jhi-button
            [disabled]="!this.competenciesToImport.length"
            [isLoading]="isLoading"
            [icon]="faFileImport"
            [title]="'entity.action.to-import'"
            (onClick)="importCompetencies()"
        />
    </div>
</div>
