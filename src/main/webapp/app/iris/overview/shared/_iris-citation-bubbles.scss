@mixin iris-citation-bubble-colors {
    --iris-citation-bg: var(--iris-rate-background);
    --iris-citation-agg-bg: var(--iris-chat-citation-aggregation);
    --iris-citation-agg-text: var(--iris-rate-background);
    --iris-citation-meta-color: var(--iris-chat-history-label-color);
    --iris-citation-nav-color: var(--iris-chat-history-label-color);
    --iris-citation-nav-hover-bg: var(--iris-chat-header-button-background);
    --iris-citation-icon-bg: var(--secondary);
    --iris-citation-summary-icon-bg: var(--iris-chat-history-label-color);
    --iris-citation-source-color: var(--iris-chat-history-label-color);
}

@mixin iris-citation-bubbles {
    .iris-citation-group {
        display: inline-flex;
        align-items: center;
        position: relative;
        padding-right: 10px;

        --iris-citation-shift: 0px;
    }

    .iris-citation {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 6px;
        border-radius: 999px;
        background-color: var(--iris-citation-bg);
        font-size: 0.85em;
        line-height: 1.2;
        vertical-align: middle;
        margin: 0 2px;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        position: relative;
        z-index: 1;

        --iris-citation-shift: 0px;
    }

    .iris-citation__count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 2px 6px;
        border-radius: 999px;
        font-size: 0.85em;
        line-height: 1.2;
        background-color: var(--iris-citation-agg-bg);
        color: var(--iris-citation-agg-text);
        pointer-events: none;
        margin-left: -7px;
    }

    .iris-citation__summary {
        position: absolute;
        top: 100%;
        left: 50%;
        width: 280px;
        max-width: 70vw;
        padding: 8px 10px;
        border-radius: 8px;
        background-color: var(--iris-citation-bg);
        line-height: 1.4;
        white-space: normal;
        text-align: center;
        z-index: 2;
        transform: translate(-50%, -100%) translateX(var(--iris-citation-shift));
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition:
            opacity 120ms ease,
            visibility 120ms ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }

    .iris-citation-group .iris-citation__summary {
        font-size: 0.85em;
    }

    .iris-citation__summary-keyword {
        font-size: 0.95rem;
        font-weight: 500;
    }

    .iris-citation__summary-meta {
        font-size: 0.7rem;
        line-height: 1.2;
        color: var(--iris-citation-meta-color);
    }

    .iris-citation--has-summary,
    .iris-citation-group--has-summary {
        overflow: visible;
    }

    .iris-citation--has-summary:hover,
    .iris-citation--has-summary:focus-within,
    .iris-citation-group--has-summary:hover,
    .iris-citation-group--has-summary:focus-within {
        z-index: 20;
    }

    .iris-citation--has-summary:hover .iris-citation__text,
    .iris-citation--has-summary:focus-within .iris-citation__text,
    .iris-citation-group--has-summary:hover .iris-citation__text,
    .iris-citation-group--has-summary:focus-within .iris-citation__text {
        visibility: hidden;
    }

    .iris-citation--has-summary:hover .iris-citation__summary,
    .iris-citation--has-summary:focus-within .iris-citation__summary,
    .iris-citation-group--has-summary:hover .iris-citation__summary,
    .iris-citation-group--has-summary:focus-within .iris-citation__summary {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }

    .iris-citation__summary-content {
        display: block;
        min-height: 1.2em;
    }

    .iris-citation__summary-item {
        display: none;
    }

    .iris-citation__summary-item.is-active {
        display: block;
    }

    .iris-citation__nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding-top: 6px;
        font-size: 0.9em;
    }

    .iris-citation__nav-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        border: none;
        background: transparent;
        padding: 0 6px;
        cursor: pointer;
        user-select: none;
        color: var(--iris-citation-nav-color);
        font: inherit;
    }

    .iris-citation__nav-icon {
        width: 12px;
        height: 12px;
        display: inline-grid;
        place-items: center;
        background-color: currentColor;
        -webkit-mask: url('data:image/svg+xml,%3Csvg%20width=%2216%22%20height=%2216%22%20viewBox=%220%200%2016%2016%22%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22currentColor%22%3E%3Cpath%20d=%22M13.5%208.5C13.7761%208.5%2014%208.27614%2014%208C14%207.72386%2013.7761%207.5%2013.5%207.5L3.80298%207.5L7.83448%203.87165C8.03974%203.68692%208.05638%203.37078%207.87165%203.16552C7.68692%202.96027%207.37077%202.94363%207.16552%203.12836L2.16552%207.62835C2.06016%207.72317%202%207.85826%202%208C2%208.14174%202.06016%208.27683%202.16552%208.37165L7.16552%2012.8716C7.37077%2013.0564%207.68692%2013.0397%207.87165%2012.8345C8.05638%2012.6292%208.03974%2012.3131%207.83448%2012.1283L3.80298%208.5L13.5%208.5Z%22/%3E%3C/svg%3E')
            no-repeat center / contain;
        mask: url('data:image/svg+xml,%3Csvg%20width=%2216%22%20height=%2216%22%20viewBox=%220%200%2016%2016%22%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22currentColor%22%3E%3Cpath%20d=%22M13.5%208.5C13.7761%208.5%2014%208.27614%2014%208C14%207.72386%2013.7761%207.5%2013.5%207.5L3.80298%207.5L7.83448%203.87165C8.03974%203.68692%208.05638%203.37078%207.87165%203.16552C7.68692%202.96027%207.37077%202.94363%207.16552%203.12836L2.16552%207.62835C2.06016%207.72317%202%207.85826%202%208C2%208.14174%202.06016%208.27683%202.16552%208.37165L7.16552%2012.8716C7.37077%2013.0564%207.68692%2013.0397%207.87165%2012.8345C8.05638%2012.6292%208.03974%2012.3131%207.83448%2012.1283L3.80298%208.5L13.5%208.5Z%22/%3E%3C/svg%3E')
            no-repeat center / contain;
    }

    .iris-citation__nav-icon--next {
        -webkit-mask: url('data:image/svg+xml,%3Csvg%20width=%2216%22%20height=%2216%22%20viewBox=%220%200%2016%2016%22%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22currentColor%22%3E%3Cpath%20d=%22M2.5%207.5C2.22386%207.5%202%207.72386%202%208C2%208.27614%202.22386%208.5%202.5%208.5L12.197%208.5L8.16552%2012.1283C7.96026%2012.3131%207.94362%2012.6292%208.12835%2012.8345C8.31308%2013.0397%208.62923%2013.0564%208.83448%2012.8716L13.8345%208.37164C13.9398%208.27682%2014%208.14174%2014%208C14%207.85825%2013.9398%207.72317%2013.8345%207.62835L8.83448%203.12835C8.62923%202.94362%208.31308%202.96026%208.12835%203.16551C7.94362%203.37077%207.96026%203.68691%208.16552%203.87164L12.197%207.5L2.5%207.5Z%22/%3E%3C/svg%3E')
            no-repeat center / contain;
        mask: url('data:image/svg+xml,%3Csvg%20width=%2216%22%20height=%2216%22%20viewBox=%220%200%2016%2016%22%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22currentColor%22%3E%3Cpath%20d=%22M2.5%207.5C2.22386%207.5%202%207.72386%202%208C2%208.27614%202.22386%208.5%202.5%208.5L12.197%208.5L8.16552%2012.1283C7.96026%2012.3131%207.94362%2012.6292%208.12835%2012.8345C8.31308%2013.0397%208.62923%2013.0564%208.83448%2012.8716L13.8345%208.37164C13.9398%208.27682%2014%208.14174%2014%208C14%207.85825%2013.9398%207.72317%2013.8345%207.62835L8.83448%203.12835C8.62923%202.94362%208.31308%202.96026%208.12835%203.16551C7.94362%203.37077%207.96026%203.68691%208.16552%203.87164L12.197%207.5L2.5%207.5Z%22/%3E%3C/svg%3E')
            no-repeat center / contain;
    }

    .iris-citation__nav-button:hover {
        background-color: var(--iris-citation-nav-hover-bg);
    }

    .iris-citation__nav-button:focus-visible {
        outline: 2px solid var(--iris-citation-nav-hover-bg);
        outline-offset: 1px;
    }

    .iris-citation__icon {
        width: 16px;
        height: 16px;
        display: grid;
        place-items: center;
        background-color: var(--iris-citation-icon-bg);
        font-size: 0.55em;
        font-weight: 600;
        flex: 0 0 auto;
    }

    .iris-citation__summary-icon {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: var(--iris-citation-summary-icon-bg);
        display: grid;
        place-items: center;
        flex-shrink: 0;
    }

    .iris-citation--slide .iris-citation__icon {
        -webkit-mask: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M96%200C60.7%200%2032%2028.7%2032%2064l0%20384c0%2035.3%2028.7%2064%2064%2064l80%200%200-112c0-35.3%2028.7-64%2064-64l176%200%200-165.5c0-17-6.7-33.3-18.7-45.3L290.7%2018.7C278.7%206.7%20262.5%200%20245.5%200L96%200zM357.5%20176L264%20176c-13.3%200-24-10.7-24-24L240%2058.5%20357.5%20176zM240%20380c-11%200-20%209-20%2020l0%20128c0%2011%209%2020%2020%2020s20-9%2020-20l0-28%2012%200c33.1%200%2060-26.9%2060-60s-26.9-60-60-60l-32%200zm32%2080l-12%200%200-40%2012%200c11%200%2020%209%2020%2020s-9%2020-20%2020zm96-80c-11%200-20%209-20%2020l0%20128c0%2011%209%2020%2020%2020l32%200c28.7%200%2052-23.3%2052-52l0-64c0-28.7-23.3-52-52-52l-32%200zm20%20128l0-88%2012%200c6.6%200%2012%205.4%2012%2012l0%2064c0%206.6-5.4%2012-12%2012l-12%200zm88-108l0%20128c0%2011%209%2020%2020%2020s20-9%2020-20l0-44%2028%200c11%200%2020-9%2020-20s-9-20-20-20l-28%200%200-24%2028%200c11%200%2020-9%2020-20s-9-20-20-20l-48%200c-11%200-20%209-20%2020z%22/%3E%3C/svg%3E')
            no-repeat center / 12px 12px;
        mask: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M96%200C60.7%200%2032%2028.7%2032%2064l0%20384c0%2035.3%2028.7%2064%2064%2064l80%200%200-112c0-35.3%2028.7-64%2064-64l176%200%200-165.5c0-17-6.7-33.3-18.7-45.3L290.7%2018.7C278.7%206.7%20262.5%200%20245.5%200L96%200zM357.5%20176L264%20176c-13.3%200-24-10.7-24-24L240%2058.5%20357.5%20176zM240%20380c-11%200-20%209-20%2020l0%20128c0%2011%209%2020%2020%2020s20-9%2020-20l0-28%2012%200c33.1%200%2060-26.9%2060-60s-26.9-60-60-60l-32%200zm32%2080l-12%200%200-40%2012%200c11%200%2020%209%2020%2020s-9%2020-20%2020zm96-80c-11%200-20%209-20%2020l0%20128c0%2011%209%2020%2020%2020l32%200c28.7%200%2052-23.3%2052-52l0-64c0-28.7-23.3-52-52-52l-32%200zm20%20128l0-88%2012%200c6.6%200%2012%205.4%2012%2012l0%2064c0%206.6-5.4%2012-12%2012l-12%200zm88-108l0%20128c0%2011%209%2020%2020%2020s20-9%2020-20l0-44%2028%200c11%200%2020-9%2020-20s-9-20-20-20l-28%200%200-24%2028%200c11%200%2020-9%2020-20s-9-20-20-20l-48%200c-11%200-20%209-20%2020z%22/%3E%3C/svg%3E')
            no-repeat center / 12px 12px;
    }

    .iris-citation--video .iris-citation__icon {
        -webkit-mask: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M0%2064C0%2028.7%2028.7%200%2064%200L213.5%200c17%200%2033.3%206.7%2045.3%2018.7L365.3%20125.3c12%2012%2018.7%2028.3%2018.7%2045.3L384%20448c0%2035.3-28.7%2064-64%2064L64%20512c-35.3%200-64-28.7-64-64L0%2064zm208-5.5l0%2093.5c0%2013.3%2010.7%2024%2024%2024L325.5%20176%20208%2058.5zM80%20304l0%2096c0%2017.7%2014.3%2032%2032%2032l96%200c17.7%200%2032-14.3%2032-32l0-24%2035%2035c3.2%203.2%207.5%205%2012%205%209.4%200%2017-7.6%2017-17l0-94.1c0-9.4-7.6-17-17-17-4.5%200-8.8%201.8-12%205l-35%2035%200-24c0-17.7-14.3-32-32-32l-96%200c-17.7%200-32%2014.3-32%2032z%22/%3E%3C/svg%3E')
            no-repeat center / 12px 12px;
        mask: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M0%2064C0%2028.7%2028.7%200%2064%200L213.5%200c17%200%2033.3%206.7%2045.3%2018.7L365.3%20125.3c12%2012%2018.7%2028.3%2018.7%2045.3L384%20448c0%2035.3-28.7%2064-64%2064L64%20512c-35.3%200-64-28.7-64-64L0%2064zm208-5.5l0%2093.5c0%2013.3%2010.7%2024%2024%2024L325.5%20176%20208%2058.5zM80%20304l0%2096c0%2017.7%2014.3%2032%2032%2032l96%200c17.7%200%2032-14.3%2032-32l0-24%2035%2035c3.2%203.2%207.5%205%2012%205%209.4%200%2017-7.6%2017-17l0-94.1c0-9.4-7.6-17-17-17-4.5%200-8.8%201.8-12%205l-35%2035%200-24c0-17.7-14.3-32-32-32l-96%200c-17.7%200-32%2014.3-32%2032z%22/%3E%3C/svg%3E')
            no-repeat center / 12px 12px;
    }

    .iris-citation--faq .iris-citation__icon {
        -webkit-mask: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20320%20512%22%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M64%20160c0-53%2043-96%2096-96s96%2043%2096%2096c0%2042.7-27.9%2078.9-66.5%2091.4-28.4%209.2-61.5%2035.3-61.5%2076.6l0%2024c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32l0-24c0-1.7%20.6-4.1%203.5-7.3%203-3.3%207.9-6.5%2013.7-8.4%2064.3-20.7%20110.8-81%20110.8-152.3%200-88.4-71.6-160-160-160S0%2071.6%200%20160c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm96%20352c22.1%200%2040-17.9%2040-40s-17.9-40-40-40-40%2017.9-40%2040%2017.9%2040%2040%2040z%22/%3E%3C/svg%3E')
            no-repeat center / 12px 12px;
        mask: url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20320%20512%22%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M64%20160c0-53%2043-96%2096-96s96%2043%2096%2096c0%2042.7-27.9%2078.9-66.5%2091.4-28.4%209.2-61.5%2035.3-61.5%2076.6l0%2024c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32l0-24c0-1.7%20.6-4.1%203.5-7.3%203-3.3%207.9-6.5%2013.7-8.4%2064.3-20.7%20110.8-81%20110.8-152.3%200-88.4-71.6-160-160-160S0%2071.6%200%20160c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm96%20352c22.1%200%2040-17.9%2040-40s-17.9-40-40-40-40%2017.9-40%2040%2017.9%2040%2040%2040z%22/%3E%3C/svg%3E')
            no-repeat center / 12px 12px;
    }

    .iris-citation--source .iris-citation__icon {
        background-color: transparent;
    }

    .iris-citation--source .iris-citation__icon::before {
        content: '!';
        color: var(--iris-citation-source-color);
    }
}
