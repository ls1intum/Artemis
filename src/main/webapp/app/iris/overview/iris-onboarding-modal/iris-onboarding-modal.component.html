<div class="onboarding-container">
    <!-- Step 0: Welcome Modal with full backdrop -->
    @if (step() === 0) {
        <div class="full-backdrop"></div>
        <div class="centered-modal-wrapper">
            <div class="iris-onboarding-modal-welcome" role="dialog" aria-modal="true" aria-labelledby="onboarding-welcome-title" cdkTrapFocus [cdkTrapFocusAutoCapture]="true">
                <!-- Left Side: Text Content -->
                <div class="welcome-text-section">
                    <div class="text-content">
                        <h2 id="onboarding-welcome-title" class="title" jhiTranslate="artemisApp.iris.onboarding.title"></h2>
                        <p class="description" jhiTranslate="artemisApp.iris.onboarding.description"></p>
                    </div>

                    <div class="actions">
                        <jhi-button [btnType]="ButtonType.PRIMARY" [title]="'artemisApp.iris.onboarding.getStarted'" (onClick)="onStartTour()" />
                        <p class="note" jhiTranslate="artemisApp.iris.onboarding.note"></p>
                    </div>
                </div>

                <!-- Right Side: Iris Chat Illustration -->
                <div class="welcome-illustration-section">
                    <button type="button" class="close-button" (click)="close()" [attr.aria-label]="'artemisApp.iris.onboarding.close' | artemisTranslate">
                        <span aria-hidden="true">&times;</span>
                    </button>

                    <div class="chat-preview" aria-hidden="true">
                        <div class="chat-widget-preview">
                            <div class="chat-header-preview">
                                <!-- Toolbar icons placeholder -->
                                <div class="toolbar-icons">
                                    <div class="icon-btn"></div>
                                    <div class="icon-btn"></div>
                                    <div class="icon-btn"></div>
                                </div>
                            </div>
                            <div class="chat-body-preview">
                                <p class="chat-greeting" jhiTranslate="artemisApp.iris.chat.helpOffer"></p>
                                <div class="chat-bubble-preview"></div>
                                <div class="chat-input-preview">
                                    <span class="input-placeholder" jhiTranslate="artemisApp.exerciseChatbot.inputMessage"></span>
                                </div>
                            </div>
                        </div>
                        <div class="iris-logo-badge">
                            <jhi-iris-logo [size]="IrisLogoSize.SMALL" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Steps 1 and 3: Sidebar Spotlight -->
    @if (sidebarTooltipConfig(); as sidebarStep) {
        <div class="spotlight-backdrop" aria-hidden="true">
            <div class="spotlight-section spotlight-top" [style.height.px]="sidebarStep.spotlight.top"></div>
            <div
                class="spotlight-section spotlight-left"
                [style.top.px]="sidebarStep.spotlight.top"
                [style.height.px]="sidebarStep.spotlight.height"
                [style.width.px]="sidebarStep.spotlight.left"
            ></div>
            <div
                class="spotlight-section spotlight-right"
                [style.top.px]="sidebarStep.spotlight.top"
                [style.height.px]="sidebarStep.spotlight.height"
                [style.left.px]="sidebarStep.spotlight.left + sidebarStep.spotlight.width"
            ></div>
            <div class="spotlight-section spotlight-bottom" [style.top.px]="sidebarStep.spotlight.top + sidebarStep.spotlight.height"></div>
        </div>

        <div class="coach-mark" aria-hidden="true" [style.top.px]="sidebarStep.coachMarkPosition.top" [style.left.px]="sidebarStep.coachMarkPosition.left"></div>

        <div
            class="onboarding-tooltip sidebar-tooltip"
            [style.top.px]="sidebarStep.tooltipPosition.top"
            [style.left.px]="sidebarStep.tooltipPosition.left"
            cdkTrapFocus
            [cdkTrapFocusAutoCapture]="true"
        >
            <p class="tooltip-description" [jhiTranslate]="sidebarStep.descriptionTranslationKey"></p>
            <jhi-stepper [currentStep]="sidebarStep.currentStep" [totalSteps]="3" />
        </div>
    }

    <!-- Step 2: Iris Icon Tooltip (Exercise Page) -->
    @if (step() === 2 && isStep2PositionReady()) {
        <div class="spotlight-click-guard" aria-hidden="true"></div>
        <div
            aria-hidden="true"
            class="spotlight-blocker rounded-cutout"
            [style.top.px]="irisIconSpotlight().top"
            [style.left.px]="irisIconSpotlight().left"
            [style.width.px]="irisIconSpotlight().width"
            [style.height.px]="irisIconSpotlight().height"
        ></div>

        <!-- Tooltip positioned above/beside Iris icon -->
        <div class="onboarding-tooltip tooltip-bottom-right-arrow" [style.top.px]="tooltipPosition().top" [style.right.px]="tooltipPosition().right">
            <div class="tooltip-header">
                <p class="tooltip-header-text" jhiTranslate="artemisApp.iris.onboarding.step2.header"></p>
            </div>
            <p class="tooltip-description" jhiTranslate="artemisApp.iris.onboarding.step2.description"></p>
            <div class="tooltip-footer">
                <jhi-stepper [currentStep]="2" [totalSteps]="3" />
                <jhi-button [btnType]="ButtonType.PRIMARY" [title]="'artemisApp.iris.onboarding.next'" (onClick)="next()" />
            </div>
        </div>
    }

    <!-- Step 4: Try a First Question Modal -->
    @if (step() === 4) {
        <div class="full-backdrop final-modal-backdrop"></div>
        <div class="centered-modal-wrapper">
            <div
                class="prompt-selection-modal final-modal-enter"
                role="dialog"
                aria-modal="true"
                aria-labelledby="onboarding-prompt-title"
                cdkTrapFocus
                [cdkTrapFocusAutoCapture]="true"
            >
                <button type="button" class="close-button" (click)="close()" [attr.aria-label]="'artemisApp.iris.onboarding.close' | artemisTranslate">
                    <span aria-hidden="true">&times;</span>
                </button>

                <div class="modal-content-group">
                    <div class="modal-header-section">
                        <h2 id="onboarding-prompt-title" class="title" jhiTranslate="artemisApp.iris.onboarding.step4.title"></h2>
                        <p class="description" jhiTranslate="artemisApp.iris.onboarding.step4.description"></p>
                    </div>

                    <div class="prompt-options" role="group" [attr.aria-label]="'artemisApp.iris.onboarding.step4.promptSuggestions' | artemisTranslate">
                        @for (prompt of promptOptions; track prompt.type) {
                            <button type="button" class="prompt-chip" (click)="selectPrompt(prompt.type)">
                                <fa-icon [icon]="prompt.icon" aria-hidden="true" />
                                <span [jhiTranslate]="prompt.labelKey"></span>
                            </button>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>
