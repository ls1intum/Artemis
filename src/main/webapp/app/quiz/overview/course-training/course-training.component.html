@if (!isLoading()) {
    <div class="course-training-container">
        <p-dialog [(visible)]="showDialog" [modal]="true" [draggable]="false" [closable]="false" [style]="{ width: '450px' }">
            <ng-template pTemplate="header">
                <h5 jhiTranslate="artemisApp.quizQuestion.unratedConfirmationTitle"></h5>
            </ng-template>

            <div class="training-description mb-3">
                <p jhiTranslate="artemisApp.quizTraining.description"></p>
            </div>

            <div class="leaderboard-toggle mb-3">
                <label>
                    <input type="checkbox" [(ngModel)]="showInLeaderboard" [title]="'artemisApp.quizTraining.showInLeaderboard'" />
                </label>
            </div>

            <ng-template pTemplate="footer">
                <jhi-button [title]="'Save'" (click)="onSaveDialog()" />
            </ng-template>
        </p-dialog>

        @if (!isFirstVisit() && isDataLoaded()) {
            <div class="header-section d-flex">
                <div class="ms-auto d-flex align-items-center">
                    <jhi-button (onClick)="navigateToTraining()" class="button-class" [title]="'artemisApp.exercise.startTraining'" />
                </div>
            </div>

            <hr class="mt-2 mb-4" />

            <div class="main-body-section">
                <div class="legend-section p-3">
                    <h5 jhiTranslate="artemisApp.quizTraining.scorecard"></h5>
                    <div class="league-display">
                        @if (league() === 'Bronze') {
                            <div class="league-badge bronze">
                                <app-league-bronze-icon [league]="league()" />
                                <div class="league-info">
                                    <div class="league-name" jhiTranslate="artemisApp.quizTraining.bronzeLeague"></div>
                                    <div class="league-points">{{ points() }} / {{ pointsBronzeLeague }}</div>
                                    <div class="progress-bar">
                                        <div class="progress" [style.width]="(points() / 100) * 100 + '%'"></div>
                                        <app-league-silver-icon [league]="'Silver'" class="small-icon" />
                                    </div>
                                </div>
                            </div>
                        }
                        @if (league() === 'Silver') {
                            <div class="league-badge silver">
                                <app-league-silver-icon [league]="league()" />
                                <div class="league-info">
                                    <div class="league-header">
                                        <div class="league-name-points-container">
                                            <div class="league-name" jhiTranslate="artemisApp.quizTraining.silverLeague"></div>
                                            <div class="league-points">{{ points() }} / {{ pointsSilverLeague }}</div>
                                        </div>
                                        <div class="info-button">i</div>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress" [style.width]="((points() - pointsBronzeLeague) / (pointsSilverLeague - pointsBronzeLeague)) * 100 + '%'"></div>
                                        </div>
                                        <div class="next-league-icon">
                                            <app-league-gold-icon [league]="'Gold'" class="small-icon" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        @if (league() === 'Gold') {
                            <div class="league-badge gold">
                                <app-league-gold-icon [league]="league()" />
                                <div class="league-info">
                                    <div class="league-header">
                                        <div class="league-name-points-container">
                                            <div class="league-name" jhiTranslate="artemisApp.quizTraining.goldLeague"></div>
                                            <div class="league-points">{{ points() }} / {{ pointsGoldLeague }}</div>
                                        </div>
                                        <div class="info-button">i</div>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress" [style.width]="((points() - pointsSilverLeague) / (pointsGoldLeague - pointsSilverLeague)) * 100 + '%'"></div>
                                        </div>
                                        <div class="next-league-icon">
                                            <app-league-diamond-icon [league]="'Diamond'" class="small-icon" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        @if (league() === 'Diamond') {
                            <div class="league-badge diamond">
                                <app-league-diamond-icon [league]="league()" />
                                <div class="league-info">
                                    <div class="league-header">
                                        <div class="league-name-points-container">
                                            <div class="league-name" jhiTranslate="artemisApp.quizTraining.diamondLeague"></div>
                                            <div class="league-points">{{ points() }} / {{ pointsDiamondLeague }}</div>
                                        </div>
                                        <div class="info-button">i</div>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress" [style.width]="((points() - pointsGoldLeague) / (pointsDiamondLeague - pointsGoldLeague)) * 100 + '%'"></div>
                                        </div>
                                        <div class="next-league-icon">
                                            <app-league-master-icon [league]="'Master'" class="small-icon" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        @if (league() === 'Master') {
                            <div class="league-badge master">
                                <app-league-master-icon [league]="league()" />
                                <div class="league-info">
                                    <div class="league-header">
                                        <div class="league-name-points-container">
                                            <div class="league-name" jhiTranslate="artemisApp.quizTraining.masterLeague"></div>
                                            <div class="league-points">{{ points() }}</div>
                                        </div>
                                        <div class="info-button">i</div>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress" [style.width]="100 + '%'"></div>
                                        </div>
                                        <div class="next-league-icon">
                                            <fa-icon [icon]="faStar" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        @if (league() === 'No League') {
                            <div class="league-badge no-league">
                                <span jhiTranslate="artemisApp.quizTraining.noLeague"></span>
                            </div>
                        }
                    </div>
                    <div class="due-date-container mt-5">
                        <fa-icon [icon]="faClock" />
                        @if (!dueIn().isValid) {
                            <span jhiTranslate="artemisApp.quizTraining.noData"></span>
                        } @else if (dueIn().isPast) {
                            <span jhiTranslate="artemisApp.quizTraining.dueNow"></span>
                        } @else {
                            <span>
                                <span jhiTranslate="artemisApp.quizTraining.nextQuestionsDue"></span>
                                @if (dueIn().days > 0) {
                                    <span>{{ dueIn().days }} d, </span>
                                }
                                @if (dueIn().hours > 0 || dueIn().days > 0) {
                                    <span>{{ dueIn().hours }} h, </span>
                                }
                                <span>{{ dueIn().minutes }} min</span>
                            </span>
                        }
                    </div>
                    <div>
                        <span> <fa-icon [icon]="faQuestion" /> {{ totalQuestions() }} <span jhiTranslate="artemisApp.quizTraining.totalQuestions"></span> </span>
                    </div>
                    <div>
                        <span> <fa-icon [icon]="faCheck" /> {{ correctQuestions() }} <span jhiTranslate="artemisApp.quizTraining.correctQuestions"></span> </span>
                    </div>
                    <div>
                        <span> <fa-icon [icon]="faXmark" /> {{ wrongQuestions() }} <span jhiTranslate="artemisApp.quizTraining.wrongQuestions"></span> </span>
                    </div>
                </div>
                <div class="leaderboard-section">
                    <jhi-leaderboard [leaderboard]="leaderboardEntries()" [currentUserId]="currentUserId()" [leaderboardName]="leaderboardName()" />
                </div>
            </div>
        }
    </div>
}
