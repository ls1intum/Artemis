<div class="edit-mc-question">
    @if (!reEvaluationInProgress()) {
        <div class="question-options card-header question-card-header" [hidden]="showPreview">
            <button
                class="btn question-collapse"
                (click)="isQuestionCollapsed = !isQuestionCollapsed"
                [attr.aria-expanded]="!isQuestionCollapsed"
                [attr.aria-controls]="'collapseQuestion' + questionIndex()"
            >
                <fa-icon size="3x" [icon]="isQuestionCollapsed ? faAngleRight : faAngleDown" />
            </button>
            <div class="form-group question-title">
                <input
                    id="mc-question-title"
                    class="form-control"
                    [(ngModel)]="question().title"
                    (ngModelChange)="questionUpdated.emit()"
                    placeholder="{{ 'artemisApp.quizExercise.placeholder.shortQuestionTitle' | artemisTranslate }}"
                />
            </div>
            <div class="question-card-header-inputs">
                <div class="form-group question-score">
                    <span jhiTranslate="artemisApp.quizQuestion.score" class="colon-suffix"></span>
                    <input
                        id="score"
                        class="form-control"
                        title="score"
                        type="number"
                        min="0"
                        [max]="MAX_POINTS"
                        [(ngModel)]="question().points!"
                        (ngModelChange)="questionUpdated.emit()"
                    />
                </div>
                <div class="question-type">
                    <h3 class="mb-0"><span class="badge bg-info align-text-top">MC</span></h3>
                </div>
            </div>
        </div>
    } @else {
        <div class="question-options card-header question-card-header-reevaluation">
            <div class="row">
                <div class="col-3 col-lg-1 mt-1">
                    <button
                        class="btn question-collapse"
                        (click)="isQuestionCollapsed = !isQuestionCollapsed"
                        [attr.aria-expanded]="!isQuestionCollapsed"
                        [attr.aria-controls]="'collapseQuestion' + questionIndex"
                    >
                        <fa-icon size="3x" [icon]="isQuestionCollapsed ? faAngleRight : faAngleDown" />
                    </button>
                </div>
                <div class="col-9 col-lg-8 text-start mt-3">
                    <div class="input-group row">
                        <div class="col-10 col-lg-11">
                            <input
                                class="form-control"
                                [(ngModel)]="question().title"
                                placeholder="{{ 'artemisApp.quizExercise.placeholder.shortQuestionTitle' | artemisTranslate }}"
                                attr.aria-label="{{ 'artemisApp.quizExercise.placeholder.shortQuestionTitle' | artemisTranslate }}"
                                style="width: 100%"
                            />
                        </div>
                        <div class="col-2 col-lg-1">
                            <span class="input-group-btn">
                                <button
                                    class="btn btn-outline-secondary"
                                    type="button"
                                    (click)="resetQuestionTitle()"
                                    [ngbTooltip]="'artemisApp.quizExercise.re-evaluate.resetQuestionTitle' | artemisTranslate"
                                >
                                    <fa-icon [icon]="faUndo" />
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="col-3 col-lg-1 mt-lg-3">
                    <div class="question-type">
                        <h3 class="mb-0"><span class="badge bg-info align-text-top" style="width: 60px">MC</span></h3>
                    </div>
                </div>
                <div class="col-9 col-lg-2 text-end mt-lg-3">
                    <button
                        id="move-up-button"
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="moveUp()"
                        [ngbTooltip]="'artemisApp.quizExercise.re-evaluate.moveUp' | artemisTranslate"
                    >
                        <fa-icon [icon]="faChevronUp" />
                    </button>
                    <button
                        id="move-down-button"
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="moveDown()"
                        [ngbTooltip]="'artemisApp.quizExercise.re-evaluate.moveDown' | artemisTranslate"
                    >
                        <fa-icon [icon]="faChevronDown" />
                    </button>
                    <button
                        id="reset-button"
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="resetQuestion()"
                        [ngbTooltip]="'artemisApp.quizExercise.re-evaluate.resetQuestion' | artemisTranslate"
                    >
                        <fa-icon [icon]="faUndo" />
                    </button>
                </div>
            </div>
        </div>
    }

    <div class="card-body question-card-body" [ngbCollapse]="isQuestionCollapsed" id="collapseQuestion{{ questionIndex() }}">
        <div [ngClass]="reEvaluationInProgress() ? 'question-options row' : 'question-options'" [hidden]="showPreview">
            <div [ngClass]="reEvaluationInProgress() ? 'col-12 col-lg-4' : ''">
                <div class="form-group">
                    <span jhiTranslate="artemisApp.quizQuestion.scoringType" class="colon-suffix no-flex-shrink"></span>
                    <select
                        class="form-select"
                        [(ngModel)]="question().scoringType"
                        (ngModelChange)="questionUpdated.emit()"
                        [disabled]="question().singleChoice ?? false"
                        title="scoring type"
                    >
                        <option value="ALL_OR_NOTHING" jhiTranslate="artemisApp.quizExercise.scoringType.all_or_nothing"></option>
                        <option value="PROPORTIONAL_WITH_PENALTY" jhiTranslate="artemisApp.quizExercise.scoringType.proportional_with_penalty"></option>
                        <option value="PROPORTIONAL_WITHOUT_PENALTY" jhiTranslate="artemisApp.quizExercise.scoringType.proportional_without_penalty"></option>
                    </select>
                    @if (!reEvaluationInProgress()) {
                        <jhi-quiz-scoring-info-modal />
                    }
                </div>
            </div>
            @if (reEvaluationInProgress()) {
                <div class="col-12 col-lg-2">
                    <div class="form-group">
                        <span jhiTranslate="artemisApp.quizQuestion.score" class="colon-suffix"></span>
                        <input class="form-control point-input" title="score" type="number" [value]="question().points" disabled style="width: 100%" />
                    </div>
                </div>
            }
            <div [ngClass]="reEvaluationInProgress() ? 'col-12 col-lg-3' : ''">
                <div class="form-group">
                    <div class="form-check custom-control custom-checkbox">
                        <input
                            type="checkbox"
                            id="{{ 'cbRandomizeOrderMC' + questionIndex() }}"
                            [(ngModel)]="question().randomizeOrder"
                            class="form-check-input custom-control-input"
                        />
                        <label
                            class="form-check-label custom-control-label"
                            for="{{ 'cbRandomizeOrderMC' + questionIndex() }}"
                            jhiTranslate="artemisApp.multipleChoiceQuestion.randomizeOrder"
                        ></label>
                    </div>
                </div>
            </div>
            @if (!reEvaluationInProgress()) {
                <div class="form-group">
                    <div class="form-check custom-control custom-checkbox">
                        <input
                            type="checkbox"
                            id="{{ 'cbSingleChoiceMC' + questionIndex() }}"
                            [(ngModel)]="question().singleChoice"
                            (ngModelChange)="onSingleChoiceChanged(); questionUpdated.emit()"
                            class="form-check-input custom-control-input"
                        />
                        <label
                            class="form-check-label custom-control-label"
                            for="{{ 'cbSingleChoiceMC' + questionIndex() }}"
                            jhiTranslate="artemisApp.multipleChoiceQuestion.singleChoice"
                        ></label>
                        <fa-icon [icon]="faQuestionCircle" [ngbTooltip]="'artemisApp.multipleChoiceQuestion.singleChoiceInfo' | artemisTranslate" />
                    </div>
                </div>
            }
            @if (reEvaluationInProgress()) {
                <div class="col-12 col-lg-3 row justify-content-lg-end">
                    <div class="col-8 form-group">
                        <button
                            class="btn btn-outline-secondary invalid-button"
                            [hidden]="question().invalid"
                            (click)="question().invalid = true"
                            jhiTranslate="artemisApp.quizExercise.re-evaluate.setQuestionInvalid"
                        ></button>
                        <button
                            class="btn btn-outline-secondary invalid-button"
                            [hidden]="!question().invalid"
                            [disabled]="question().invalid"
                            jhiTranslate="artemisApp.quizExercise.re-evaluate.questionIsInvalid"
                        ></button>
                    </div>
                    <div class="col-2 col-lg-1">
                        <div class="re-evaluate-button" id="delete-button" class="delete-button" (click)="deleteQuestion()">
                            <fa-icon [icon]="faTrash" size="2x" />
                        </div>
                    </div>
                </div>
            } @else {
                <div class="form-group">
                    <div class="delete-button" (click)="deleteQuestion()">
                        <fa-icon [icon]="faTrash" size="2x" />
                    </div>
                </div>
            }
        </div>
        <div class="markupEditorArea">
            <div class="question-content">
                @if (!reEvaluationInProgress()) {
                    <jhi-markdown-editor-monaco
                        #markdownEditor
                        [markdown]="questionEditorText"
                        [showPreviewButton]="true"
                        [showVisualButton]="true"
                        [domainActions]="multipleChoiceActions"
                        (markdownChange)="changesInMarkdown()"
                        (textWithDomainActionsFound)="domainActionsFound($event)"
                        (onLeaveVisualTab)="onLeaveVisualTab()"
                        [showDefaultPreview]="false"
                        class="h-auto"
                    >
                        <!-- Preview -->
                        <ng-container id="previewMonaco">
                            @if (showMultipleChoiceQuestionPreview) {
                                <jhi-multiple-choice-question [question]="question()" [selectedAnswerOptions]="[]" [questionIndex]="questionIndex()" />
                            }
                            <hr />
                        </ng-container>
                        <!-- End of Preview-->
                        <!-- Visual -->
                        <ng-container id="visual">
                            @if (showMultipleChoiceQuestionVisual) {
                                <jhi-multiple-choice-visual-question #visual [question]="question()" (questionChanged)="changesInVisualMode()" />
                            }
                        </ng-container>
                        <!-- End of Visual -->
                    </jhi-markdown-editor-monaco>
                } @else {
                    <jhi-multiple-choice-visual-question #visual [question]="question()" [reEvaluationInProgress]="true" (questionChanged)="changesInVisualMode()" />
                }
            </div>
        </div>
    </div>
</div>
