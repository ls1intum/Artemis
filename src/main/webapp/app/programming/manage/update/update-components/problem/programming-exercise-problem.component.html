<section>
    <h3 jhiTranslate="artemisApp.programmingExercise.wizardMode.detailedSteps.problemStepTitle" id="artemisApp.programmingExercise.wizardMode.detailedSteps.problemStepTitle"></h3>
    <p jhiTranslate="artemisApp.programmingExercise.wizardMode.detailedSteps.problemStepMessage"></p>
    @if (isEditFieldDisplayedRecord().problemStatement) {
        <div class="form-group" id="field_problemStatement" name="problemStatement">
            <label class="form-control-label" for="field_problemStatement" jhiTranslate="artemisApp.programmingExercise.problemStatement.title"></label>
            @if (programmingExerciseCreationConfig.isImportFromExistingExercise || programmingExerciseCreationConfig.isImportFromFile) {
                <ngb-alert [dismissible]="false">
                    <span class="font-weight-bold">
                        {{ 'artemisApp.exercise.import.attention' | artemisTranslate }}
                    </span>
                    <span
                        jhiTranslate="{{
                            programmingExerciseCreationConfig.isImportFromExistingExercise
                                ? 'artemisApp.exercise.import.markdownWarning'
                                : 'artemisApp.exercise.import.embeddedFilesWarning'
                        }}"
                    ></span>
                </ngb-alert>
            }
            @if (programmingExerciseCreationConfig.isImportFromExistingExercise) {
                <jhi-programming-exercise-instructions
                    [exercise]="programmingExercise"
                    [participation]="programmingExercise.templateParticipation!"
                    [personalParticipation]="false"
                />
            }
            @if (
                programmingExerciseCreationConfig.problemStatementLoaded &&
                programmingExerciseCreationConfig.templateParticipationResultLoaded &&
                !programmingExerciseCreationConfig.isImportFromExistingExercise
            ) {
                <jhi-programming-exercise-editable-instructions
                    [participation]="programmingExercise.templateParticipation!"
                    [(exercise)]="exercise"
                    [initialEditorHeight]="MarkdownEditorHeight.MEDIUM"
                    [showStatus]="!!programmingExercise?.id"
                    [editMode]="!!programmingExercise?.id"
                    (hasUnsavedChanges)="programmingExerciseCreationConfig.hasUnsavedChanges = $event"
                    (instructionChange)="problemStatementChange.emit($event)"
                    [forceRender]="programmingExerciseCreationConfig.rerenderSubject"
                    class="form__editable-instructions"
                />
            }
        </div>

        @if (programmingExercise?.id && !programmingExerciseCreationConfig.isImportFromExistingExercise && !programmingExerciseCreationConfig.isImportFromFile) {
            <div class="form-group mt-3">
                <div class="d-flex align-items-center gap-2">
                    <button id="generate-code-btn" type="button" class="btn btn-primary btn-sm" [disabled]="isGeneratingCode" (click)="generateCode()">
                        @if (isGeneratingCode) {
                            <fa-icon [icon]="faSpinner" animation="spin" class="me-2" />
                            {{ 'artemisApp.programmingExercise.codeGeneration.generating' | artemisTranslate }}
                        } @else {
                            <fa-icon [icon]="faRobot" class="me-2" />
                            {{ 'artemisApp.programmingExercise.codeGeneration.generateCode' | artemisTranslate }}
                        }
                    </button>
                    <small class="text-muted">{{ 'artemisApp.programmingExercise.codeGeneration.description' | artemisTranslate }}</small>
                </div>
                @if (generationResult) {
                    <div class="mt-2">
                        <div class="alert" [ngClass]="generationResult.success ? 'alert-success' : 'alert-warning'" role="alert">
                            <fa-icon [icon]="generationResult.success ? faCheckCircle : faExclamationTriangle" class="me-2" />
                            {{ generationResult.message }}
                            @if (!generationResult.success) {
                                <small class="d-block mt-1">{{
                                    'artemisApp.programmingExercise.codeGeneration.attempts' | artemisTranslate: { attempts: generationResult.attempts }
                                }}</small>
                            }
                        </div>
                    </div>
                }
            </div>
        }
    }
    @if (isEditFieldDisplayedRecord().linkedCompetencies && !programmingExerciseCreationConfig.isExamMode) {
        <div class="form-group">
            <jhi-competency-selection
                id="competencies"
                [labelName]="'artemisApp.competency.link.title' | artemisTranslate"
                [labelTooltip]="'artemisApp.competency.link.exercise' | artemisTranslate"
                [(ngModel)]="programmingExercise.competencyLinks"
                name="competencyLinks"
            />
        </div>
    }
</section>
