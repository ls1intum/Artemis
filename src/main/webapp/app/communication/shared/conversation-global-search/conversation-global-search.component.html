<div class="input-group mb-2 rounded-3 p-2 me-2 module-bg">
    <!-- search bar with selected channel -->
    <div class="tag-input-container">
        @for (conversation of selectedConversations; track conversation) {
            <span class="badge bg-primary me-1">
                <span class="me-1">in:#{{ getConversationName(conversation) }}</span>
                <button type="button" class="btn-close btn-close-white btn-sm ms-1" aria-label="Remove" (click)="removeSelectedChannel(conversation)"></button>
            </span>
        }
        @for (author of selectedAuthors; track author) {
            <span class="badge bg-secondary me-1">
                <span class="me-1">by:&#64;{{ author.name }}</span>
                <button type="button" class="btn-close btn-close-white btn-sm ms-1" aria-label="Remove" (click)="removeSelectedAuthor(author)"></button>
            </span>
        }
        <input
            #searchInput
            name="searchText"
            id="search"
            [(ngModel)]="courseWideSearchTerm"
            class="form-control"
            (keyup.enter)="onTriggerSearch()"
            (input)="filterItems($event)"
            (keydown.arrowDown)="navigateDropdown(1, $event)"
            (keydown.arrowUp)="navigateDropdown(-1, $event)"
            (keydown.enter)="selectActiveOption()"
            placeholder="{{ 'artemisApp.metis.globalSearch.searchBarDefault' | artemisTranslate }}"
        />
    </div>
    <jhi-button [btnType]="ButtonType.SECONDARY" [icon]="faTimes" (onClick)="clearSearch()" />
    <jhi-button id="search-submit" class="ms-1" [icon]="faSearch" (onClick)="onTriggerSearch()" />
</div>
@if (showDropdown) {
    <ul class="list-group autocomplete-dropdown" tabindex="0">
        @if (filteredOptions.length === 0) {
            <li class="list-group-item">
                @if (searchMode === SearchMode.CONVERSATION) {
                    <span class="text-muted" jhiTranslate="artemisApp.metis.globalSearch.noConversationFound" [translateValues]="{ search: courseWideSearchTerm }"></span>
                } @else if (searchMode === SearchMode.USER) {
                    @if (userSearchStatus === UserSearchStatus.RESULTS) {
                        <span class="text-muted" jhiTranslate="artemisApp.metis.globalSearch.noUserFound" [translateValues]="{ search: courseWideSearchTerm }"></span>
                    } @else if (userSearchStatus === UserSearchStatus.LOADING) {
                        <span><fa-icon [icon]="faSpinner" animation="spin" />&nbsp;</span>
                    } @else if (userSearchStatus === UserSearchStatus.TOO_SHORT) {
                        <span class="text-muted" jhiTranslate="artemisApp.metis.globalSearch.userQueryTooShort"></span>
                    }
                }
            </li>

            <li class="list-group-item"></li>
        } @else {
            @for (option of filteredOptions; let i = $index; track option) {
                <li class="list-group-item list-group-item-action" [class.active]="i === activeDropdownIndex" (mousedown)="selectOption(option)">
                    @if (option.type === 'conversation') {
                        <span class="me-2">#</span>
                        {{ option.name }}
                    } @else if (option.type === 'user') {
                        <div class="d-flex align-items-center">
                            <jhi-profile-picture
                                [imageSizeInRem]="'1.1'"
                                [fontSizeInRem]="'0.5'"
                                [imageId]="'user-profile-picture'"
                                [defaultPictureId]="'user-default-profile-picture'"
                                [isGray]="false"
                                [authorId]="option.id"
                                [authorName]="option.name"
                                [imageUrl]="addPublicFilePrefix(option.img)"
                                [isEditable]="false"
                                class="me-2"
                            />
                            {{ option.name }}
                        </div>
                    }
                </li>
            }
        }
    </ul>
}
