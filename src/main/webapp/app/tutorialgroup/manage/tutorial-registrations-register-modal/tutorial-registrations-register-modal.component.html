<p-dialog [header]="header()" [modal]="true" [visible]="isOpen()" (visibleChange)="isOpen.set($event)">
    <div class="frame">
        <p-iconfield class="search-field">
            <p-inputicon class="pi pi-search" />
            <input
                #searchInput
                pInputText
                class="search-input p-inputtext-sm"
                type="text"
                [placeholder]="searchBarPlaceholder()"
                [(ngModel)]="searchString"
                (focus)="openPanel()"
                (keydown)="onKeyDown($event)"
            />
            @if (isLoading()) {
                <p-inputicon class="pi pi-spin pi-spinner" />
            }
        </p-iconfield>

        <ng-template #panelTemplate>
            <div class="search-panel">
                <cdk-virtual-scroll-viewport class="search-viewport" [itemSize]="36" minBufferPx="200" maxBufferPx="400">
                    <button
                        class="student-row"
                        *cdkVirtualFor="let student of suggestedStudents(); let i = index; trackBy: trackStudentById"
                        (mouseenter)="suggestionHighlightIndex.set(i)"
                        [class.active]="suggestionHighlightIndex() === i"
                    >
                        <span class="student-name">
                            {{ student.login + (student.name ? ' | ' + student.name : '') }}
                        </span>
                    </button>
                    @if (isLoading()) {
                        <div class="loading-row">
                            <span class="pi pi-spin pi-spinner"></span>
                        </div>
                    }
                </cdk-virtual-scroll-viewport>
            </div>
        </ng-template>
    </div>
</p-dialog>
