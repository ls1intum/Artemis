<div class="container">
    <div class="d-flex flex-wrap">
        <div class="d-flex align-items-center">
            <h2 jhiTranslate="artemisApp.standardizedCompetency.manage.title"></h2>
        </div>
        <div class="ms-auto justify-content-end"></div>
    </div>
    <div class="card mb-3">
        <div class="card-header">
            <h5 class="mb-0" jhiTranslate="artemisApp.standardizedCompetency.manage.filter"></h5>
        </div>
        <div class="card-body row pb-0">
            <div class="form-group col">
                <label for="title-filter" jhiTranslate="artemisApp.standardizedCompetency.model.title"> </label>
                <input id="title-filter" class="form-control" [(ngModel)]="competencyTitleFilter" (input)="titleFilterSubject.next()" />
            </div>
            <div class="form-group col">
                <label for="knowledge-area-filter" jhiTranslate="artemisApp.standardizedCompetency.model.knowledgeArea"></label>
                <select [(ngModel)]="knowledgeAreaFilter" (ngModelChange)="filterByKnowledgeArea()" class="form-select" id="knowledge-area-filter">
                    <option [ngValue]="undefined"></option>
                    @for (knowledgeArea of knowledgeAreasForSelect; track knowledgeArea.id) {
                        <option [ngValue]="knowledgeArea">
                            {{ knowledgeArea.title }}
                        </option>
                    }
                </select>
            </div>
        </div>
    </div>
    <div class="d-flex flex-wrap align-items-center mb-2">
        <h3 class="me-3 mb-0" jhiTranslate="artemisApp.standardizedCompetency.title"></h3>
        <jhi-button
            class="me-1"
            [btnSize]="ButtonSize.SMALL"
            [icon]="faMinimize"
            (onClick)="treeControl.collapseAll()"
            tooltip="artemisApp.standardizedCompetency.manage.collapseButtonTooltip"
        />
        <jhi-button [btnSize]="ButtonSize.SMALL" [icon]="faMaximize" (onClick)="treeControl.expandAll()" tooltip="artemisApp.standardizedCompetency.manage.expandButtonTooltip" />
    </div>
    <div class="d-flex">
        <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" [trackBy]="trackBy" class="card d-flex flex-grow-1 h-100 w-50">
            <mat-nested-tree-node *matTreeNodeDef="let node" [class.d-none]="!node.isVisible">
                <div class="card tree-card light-background">
                    <div class="tree-card-row clickable me-2" matTreeNodeToggle>
                        <div class="icon-container me-2">
                            <fa-icon [icon]="faChevronRight" class="rotate-icon chevron-position" [class.rotated]="treeControl.isExpanded(node)" />
                        </div>
                        <h5 class="mb-0">{{ node.title }}</h5>
                    </div>
                    <div class="tree-card-row">
                        <jhi-button
                            [btnSize]="ButtonSize.SMALL"
                            [icon]="faPlus"
                            (onClick)="openNewCompetency(node)"
                            tooltip="artemisApp.standardizedCompetency.manage.createButtonTooltip"
                        />
                    </div>
                </div>
                <div [ngbCollapse]="!treeControl.isExpanded(node)" class="tree-indent">
                    <ng-container matTreeNodeOutlet />
                    @for (competency of node.competencies; track competency.id) {
                        <div class="card tree-card light-background" [class.d-none]="!competency.isVisible">
                            <div class="tree-card-row clickable" (click)="selectCompetency(competency)">
                                <fa-icon
                                    class="me-2"
                                    [icon]="getIcon(competency.taxonomy)"
                                    [ngbTooltip]="'artemisApp.competency.taxonomies.' + (competency.taxonomy ?? 'none') | artemisTranslate"
                                    [fixedWidth]="true"
                                />
                                <h6 class="mb-0">{{ competency.title }}</h6>
                            </div>
                        </div>
                    }
                    @if (!node.children?.length && !node.competencies?.length) {
                        <div class="card tree-card light-background">
                            <h6 class="mb-0" jhiTranslate="artemisApp.knowledgeArea.empty"></h6>
                        </div>
                    }
                </div>
            </mat-nested-tree-node>
        </mat-tree>
        @if (selectedCompetency) {
            <div class="card light-background d-flex flex-grow-1 w-100 h-100 p-3 ms-1">
                <jhi-standardized-competency-detail
                    [competency]="selectedCompetency"
                    [knowledgeAreas]="knowledgeAreasForSelect"
                    [(isEditing)]="isEditing"
                    (onSave)="saveCompetency($event)"
                    (onDelete)="deleteCompetency()"
                    (onClose)="closeCompetency()"
                    [dialogError]="dialogError"
                />
            </div>
        }
    </div>
</div>
