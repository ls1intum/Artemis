<div class="frame">
    <div class="header">
        @for (dayNameKey of utils.getWeekDayNameKeys(); track dayNameKey) {
            <div class="day-name">{{ dayNameKey | artemisTranslate }}</div>
        }
    </div>
    @for (week of weeks(); track utils.identify(week)) {
        <div class="week-row">
            @for (day of week; track utils.identify(day)) {
                <div class="day-cell">
                    @if (utils.areDaysInSameMonth(day, firstDayOfCurrentMonth())) {
                        <day-badge [date]="day" />
                        @let events = getEventsOf(day);
                        @if (events.length > 3) {
                            @for (event of utils.limitToLengthTwo(events); track event.id) {
                                @let eventDescriptor = utils.getEventDescriptor(event);
                                <div
                                    class="event-cell"
                                    [ngClass]="{
                                        'exam-event-cell': event.isExamEvent,
                                        'lecture-event-cell': event.isLectureEvent(),
                                        'tutorial-event-cell': event.isTutorialEvent(),
                                        'exercise-event-cell': event.isExerciseEvent(),
                                    }"
                                    [ngbPopover]="eventPopover"
                                    triggers="manual"
                                    [autoClose]="false"
                                    [placement]="['bottom', 'right', 'left', 'top']"
                                    (click)="openPopover(event, popover)"
                                    #popover="ngbPopover"
                                >
                                    @if (eventDescriptor) {
                                        {{ eventDescriptor | artemisTranslate }}: {{ event.title }}
                                    } @else {
                                        {{ event.title }}
                                    }
                                </div>
                            }
                            <div class="more-events-info">+{{ events.length - 2 }} more</div>
                        } @else {
                            @for (event of events; track event.id) {
                                @let eventDescriptor = utils.getEventDescriptor(event);
                                <div
                                    class="event-cell"
                                    [ngClass]="{
                                        'exam-event-cell': event.isExamEvent,
                                        'lecture-event-cell': event.isLectureEvent(),
                                        'tutorial-event-cell': event.isTutorialEvent(),
                                        'exercise-event-cell': event.isExerciseEvent(),
                                    }"
                                    [ngbPopover]="eventPopover"
                                    triggers="manual"
                                    [autoClose]="false"
                                    [placement]="['bottom', 'right', 'left', 'top']"
                                    (click)="openPopover(event, popover)"
                                    #popover="ngbPopover"
                                >
                                    <div class="event-label">
                                        @if (eventDescriptor) {
                                            {{ eventDescriptor | artemisTranslate }}: {{ event.title }}
                                        } @else {
                                            {{ event.title }}
                                        }
                                    </div>
                                    @if (event.isExerciseEvent()) {
                                        <fa-icon [icon]="utils.getIconForExerciseEvent(event)" />
                                    }
                                </div>
                            }
                        }
                    }
                </div>
            }
        </div>
    }
</div>

<ng-template #eventPopover let-pop="popover">
    @if (selectedEvent) {
        <jhi-calendar-event-detail-popover [event]="selectedEvent" (onClosePopover)="closePopover()" />
    }
</ng-template>
