<jhi-lecture-unit-card
    [courseId]="courseId()"
    [lectureUnit]="lectureUnit()"
    [icon]="getAttachmentIcon()"
    [showViewIsolatedButton]="hasAttachment()"
    [showOriginalVersionButton]="!!lectureUnit().attachment?.studentVersion"
    [viewIsolatedButtonLabel]="'artemisApp.attachmentVideoUnit.download'"
    [viewIsolatedButtonIcon]="faDownload"
    [isPresentationMode]="isPresentationMode()"
    (onCompletion)="toggleCompletion($event)"
    (onCollapse)="toggleCollapse($event)"
    (onShowIsolated)="handleDownload()"
    (onShowOriginalVersion)="handleOriginalVersion()"
>
    @if (lectureUnit().attachment?.uploadDate) {
        <div>
            <span class="font-weight-bold" jhiTranslate="artemisApp.attachmentVideoUnit.uploadDate">: </span>
            {{ lectureUnit().attachment?.uploadDate | artemisDate }}
        </div>
    }
    @if (lectureUnit().attachment?.version) {
        <div>
            <span class="font-weight-bold" jhiTranslate="artemisApp.attachmentVideoUnit.version">: </span>
            {{ lectureUnit().attachment?.version }}
        </div>
    }
    @if (lectureUnit().attachment?.link) {
        <div>
            <span class="font-weight-bold" jhiTranslate="artemisApp.attachmentVideoUnit.FileName">: </span>
            {{ getFileName() }}
        </div>
    }

    @if (lectureUnit()?.description) {
        <div>
            <hr />
            {{ lectureUnit().description }}
        </div>
    }

    @if (!!lectureUnit().attachment && !!videoUrl()) {
        <hr />
    }

    @if (shouldShowTranscriptionStatus()) {
        <div class="mt-3 mb-3">
            @if (transcriptionStatus() === TranscriptionStatus.PENDING || transcriptionStatus() === TranscriptionStatus.PROCESSING) {
                <div class="alert alert-info d-flex align-items-center justify-content-between" role="alert">
                    <div class="d-flex align-items-center">
                        <fa-icon [icon]="faSpinner" animation="spin" class="me-2" />
                        <span jhiTranslate="artemisApp.attachmentVideoUnit.transcription.statusProcessing"></span>
                    </div>
                    @if (accountService.isAtLeastEditorInCourse(lectureUnit().lecture?.course)) {
                        <button class="btn btn-danger btn-sm" (click)="cancelTranscription()" [disabled]="isCancelling()">
                            <fa-icon [icon]="faTimes" class="me-1" />
                            <span jhiTranslate="artemisApp.attachmentVideoUnit.transcription.cancelButton"></span>
                        </button>
                    }
                </div>
            }
            @if (transcriptionStatus() === TranscriptionStatus.FAILED) {
                <div class="alert alert-danger d-flex align-items-center" role="alert">
                    <fa-icon [icon]="faExclamationTriangle" class="me-2" />
                    <span jhiTranslate="artemisApp.attachmentVideoUnit.transcription.statusFailed"></span>
                </div>
            }
        </div>
    }

    @if (!!videoUrl()) {
        @if (isLoading()) {
            <div class="d-flex justify-content-center p-3">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden" jhiTranslate="artemisApp.attachmentVideoUnit.videoPlayer.loading">Loading...</span>
                </div>
            </div>
        } @else if (playlistUrl() && hasTranscript()) {
            <jhi-video-player [videoUrl]="playlistUrl()!" [transcriptSegments]="transcriptSegments()" />
        } @else {
            <div class="video-player-container">
                <div class="ratio ratio-16x9">
                    <iframe id="videoFrame" class="rounded" [src]="videoUrl() | safeResourceUrl" allow="fullscreen"></iframe>
                </div>
            </div>
        }
    }
</jhi-lecture-unit-card>
