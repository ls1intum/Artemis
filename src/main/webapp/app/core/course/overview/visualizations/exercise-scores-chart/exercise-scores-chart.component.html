<div class="d-flex">
    <h2 class="col-9" jhiTranslate="artemisApp.exercise-scores-chart.title"></h2>
    @if (exerciseTypeFilter.typeSet.size > 0) {
        <div class="filter mb-2" aria-label="Filter Dropdown" ngbDropdown>
            <button
                class="btn"
                [class.btn-secondary]="exerciseTypeFilter.numberOfActiveFilters === 0"
                [class.btn-success]="exerciseTypeFilter.numberOfActiveFilters > 0"
                ngbDropdownToggle
                id="filter-dropdown-button"
            >
                <fa-icon [icon]="faFilter" />
                <span jhiTranslate="artemisApp.courseOverview.exerciseList.filter" [translateValues]="{ num: exerciseTypeFilter.numberOfActiveFilters }"></span>
            </button>
            <ul ngbDropdownMenu class="checkbox-menu text-nowrap pe-2" aria-labelledby="filter-dropdown-button">
                <li>
                    <b class="ms-2" jhiTranslate="artemisApp.exercise-scores-chart.includeType"></b>
                </li>
                @for (type of exerciseTypeFilter.typeSet; track type) {
                    <li>
                        <label>
                            <input
                                class="ms-2 form-check-input"
                                (change)="toggleType(type)"
                                [checked]="exerciseTypeFilter.getCurrentFilterState(convertToMapKey(type))"
                                type="checkbox"
                            />
                            <span class="ms-2">{{ 'artemisApp.exercise-scores-chart.' + type.toLowerCase() + 'Plural' | artemisTranslate }}</span>
                        </label>
                    </li>
                }
            </ul>
        </div>
    }
</div>
<div class="d-flex mt-2 justify-content-center">
    <div #containerRef class="line-chart-container">
        <ngx-charts-line-chart
            [view]="[containerRef.offsetWidth, 350]"
            [results]="ngxData"
            [scheme]="ngxColor"
            [yAxisLabel]="yAxisLabel"
            [xAxisLabel]="xAxisLabel"
            [legend]="true"
            [legendTitle]="''"
            [xAxis]="true"
            [yAxis]="true"
            [showYAxisLabel]="true"
            [showXAxisLabel]="true"
            [yScaleMax]="maxScale"
            [yScaleMin]="1"
            [maxXAxisTickLength]="15"
            (select)="onSelect($event)"
            [id]="'scores-line-chart'"
        >
            <ng-template #tooltipTemplate let-model="model">
                <b>{{ model.name }}</b> <br />
                <span>{{ model.series }}: {{ Math.max(model.value, 0) }} %</span>
            </ng-template>
            <ng-template #seriesTooltipTemplate let-model="model">
                @if (model.length) {
                    <h6>{{ model[0].name }}</h6>
                    @for (entry of model; track entry) {
                        <div>{{ entry.series }}: {{ Math.max(entry.value, 0) }}%</div>
                    }
                    <b>
                        {{ 'artemisApp.exercise-scores-chart.exerciseType' | artemisTranslate }}
                        {{ 'artemisApp.exercise-scores-chart.' + model[0].exerciseType.toLowerCase() | artemisTranslate }}</b
                    >
                }
            </ng-template>
        </ngx-charts-line-chart>
    </div>
</div>
