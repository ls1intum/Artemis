<p-dialog [header]="headerTitle()" [modal]="true" [visible]="show()" [closable]="true" (visibleChange)="show.set($event)" [style]="{ width: '50rem' }" appendTo="body">
    @if (currentStep() === 'selectCourse') {
        <!-- Step 1: Course Selection -->
        <div class="course-selection-step">
            <div class="search-container mb-3">
                <span class="p-input-icon-left w-100">
                    <input
                        pInputText
                        type="text"
                        [ngModel]="searchTerm()"
                        (ngModelChange)="searchTerm.set($event)"
                        (input)="onSearchChange()"
                        [placeholder]="'artemisApp.course.import.searchPlaceholder' | artemisTranslate"
                        class="w-100"
                    />
                </span>
            </div>

            <p-table [value]="courses()" [tableStyle]="{ 'min-width': '100%' }" styleClass="p-datatable-sm p-datatable-striped" [loading]="isLoadingCourses()">
                <ng-template #header>
                    <tr>
                        <th jhiTranslate="artemisApp.course.title"></th>
                        <th jhiTranslate="artemisApp.course.shortName"></th>
                        <th jhiTranslate="artemisApp.course.semester"></th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template #body let-course>
                    <tr>
                        <td>{{ course.title }}</td>
                        <td>{{ course.shortName }}</td>
                        <td>{{ course.semester }}</td>
                        <td>
                            <button pButton severity="primary" size="small" (click)="selectCourse(course)" jhiTranslate="entity.action.select"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template #emptymessage>
                    <tr>
                        <td colspan="4" class="text-center" jhiTranslate="artemisApp.course.import.noCourses"></td>
                    </tr>
                </ng-template>
            </p-table>

            @if (totalRecords() > rows()) {
                <p-paginator [first]="first()" [rows]="rows()" [totalRecords]="totalRecords()" (onPageChange)="onPageChange($event)" />
            }
        </div>
    } @else {
        <!-- Step 2: Import Options -->
        <div class="import-options-step">
            @if (isLoadingSummary()) {
                <div class="loading-container">
                    <p-progressSpinner [style]="{ width: '50px', height: '50px' }" />
                </div>
            } @else {
                <div class="selected-course-info mb-3">
                    <span jhiTranslate="artemisApp.course.import.selectedCourse"></span>
                    <strong>{{ selectedCourse()?.title }}</strong>
                    @if (selectedCourse()?.semester) {
                        <span class="text-muted">({{ selectedCourse()?.semester }})</span>
                    }
                </div>

                <p class="mb-3" jhiTranslate="artemisApp.course.import.selectOptionsHint"></p>

                <div class="options-grid">
                    <!-- Exercises -->
                    <div class="option-row">
                        <p-checkbox
                            [inputId]="'import-exercises'"
                            [ngModel]="importExercises()"
                            (ngModelChange)="importExercises.set($event)"
                            [binary]="true"
                            [disabled]="!hasExercises()"
                        />
                        <label for="import-exercises" [class.text-muted]="!hasExercises()">
                            <span jhiTranslate="artemisApp.course.import.exercises"></span>
                            <span class="count-badge">({{ sourceSummary()?.numberOfExercises ?? 0 }})</span>
                        </label>
                    </div>

                    <!-- Lectures -->
                    <div class="option-row">
                        <p-checkbox
                            [inputId]="'import-lectures'"
                            [ngModel]="importLectures()"
                            (ngModelChange)="importLectures.set($event)"
                            [binary]="true"
                            [disabled]="!hasLectures()"
                        />
                        <label for="import-lectures" [class.text-muted]="!hasLectures()">
                            <span jhiTranslate="artemisApp.course.import.lectures"></span>
                            <span class="count-badge">({{ sourceSummary()?.numberOfLectures ?? 0 }})</span>
                        </label>
                    </div>

                    <!-- Exams -->
                    <div class="option-row">
                        <p-checkbox [inputId]="'import-exams'" [ngModel]="importExams()" (ngModelChange)="importExams.set($event)" [binary]="true" [disabled]="!hasExams()" />
                        <label for="import-exams" [class.text-muted]="!hasExams()">
                            <span jhiTranslate="artemisApp.course.import.exams"></span>
                            <span class="count-badge">({{ sourceSummary()?.numberOfExams ?? 0 }})</span>
                        </label>
                    </div>

                    <!-- Competencies -->
                    <div class="option-row">
                        <p-checkbox
                            [inputId]="'import-competencies'"
                            [ngModel]="importCompetencies()"
                            (ngModelChange)="importCompetencies.set($event)"
                            [binary]="true"
                            [disabled]="!hasCompetencies()"
                        />
                        <label for="import-competencies" [class.text-muted]="!hasCompetencies()">
                            <span jhiTranslate="artemisApp.course.import.competencies"></span>
                            <span class="count-badge">({{ sourceSummary()?.numberOfCompetencies ?? 0 }})</span>
                        </label>
                    </div>

                    <!-- Tutorial Groups -->
                    <div class="option-row">
                        <p-checkbox
                            [inputId]="'import-tutorial-groups'"
                            [ngModel]="importTutorialGroups()"
                            (ngModelChange)="importTutorialGroups.set($event)"
                            [binary]="true"
                            [disabled]="!hasTutorialGroups()"
                        />
                        <label for="import-tutorial-groups" [class.text-muted]="!hasTutorialGroups()">
                            <span jhiTranslate="artemisApp.course.import.tutorialGroups"></span>
                            <span class="count-badge">({{ sourceSummary()?.numberOfTutorialGroups ?? 0 }})</span>
                        </label>
                    </div>

                    <!-- FAQs -->
                    <div class="option-row">
                        <p-checkbox [inputId]="'import-faqs'" [ngModel]="importFaqs()" (ngModelChange)="importFaqs.set($event)" [binary]="true" [disabled]="!hasFaqs()" />
                        <label for="import-faqs" [class.text-muted]="!hasFaqs()">
                            <span jhiTranslate="artemisApp.course.import.faqs"></span>
                            <span class="count-badge">({{ sourceSummary()?.numberOfFaqs ?? 0 }})</span>
                        </label>
                    </div>
                </div>
            }
        </div>
    }

    <ng-template pTemplate="footer">
        @if (currentStep() === 'selectCourse') {
            <button pButton severity="secondary" (click)="close()" jhiTranslate="entity.action.cancel"></button>
        } @else {
            <button pButton severity="secondary" (click)="backToCourseSelection()" jhiTranslate="entity.action.back"></button>
            <button pButton [disabled]="!canImport() || isImporting()" [loading]="isImporting()" (click)="executeImport()" jhiTranslate="entity.action.import"></button>
        }
    </ng-template>
</p-dialog>
