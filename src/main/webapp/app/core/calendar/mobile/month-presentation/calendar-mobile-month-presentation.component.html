<div class="frame">
    @for (week of utils.getWeeksOfMonthFor(firstDayOfMonth()); track utils.identify(week)) {
        <div class="week-row">
            @for (day of week; track utils.identify(day)) {
                @if (utils.areDaysInSameMonth(day, firstDayOfMonth())) {
                    <div class="day" (click)="selectDay.emit(day)">
                        <calendar-day-badge [day]="day" />
                        <div class="event-stack">
                            @if (getEventsOfDay(day).length > 3) {
                                @for (event of utils.limitToLengthTwo(getEventsOfDay(day)); track event.id) {
                                    <ng-container *ngTemplateOutlet="eventCell; context: { $implicit: event }" />
                                }
                                <div class="ellipsis">
                                    <span class="dot"></span>
                                    <span class="dot"></span>
                                    <span class="dot"></span>
                                </div>
                            } @else {
                                @for (event of getEventsOfDay(day); track event.id) {
                                    <ng-container *ngTemplateOutlet="eventCell; context: { $implicit: event }" />
                                }
                            }
                        </div>
                    </div>
                } @else {
                    <div class="day-placeholder"></div>
                }
            }
        </div>
    }
</div>

<ng-template #eventCell let-event>
    <div
        class="event-cell"
        [ngClass]="{
            'exam-event-cell': event.isOfType(CalendarEventType.Exam),
            'lecture-event-cell': event.isOfType(CalendarEventType.Lecture),
            'tutorial-event-cell': event.isOfType(CalendarEventType.Tutorial),
            'exercise-event-cell': event.isOfExerciseType(),
        }"
    ></div>
</ng-template>
