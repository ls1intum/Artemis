<div class="frame">
    @for (week of weeks(); track week.id) {
        <div class="week-row">
            @for (day of week.days; track day.id) {
                @if (day.isInDisplayedMonth) {
                    <div class="day" (click)="onDateSelected.emit(day.date)">
                        <jhi-calendar-day-badge [date]="day.date" />
                        <div class="event-stack">
                            @if (day.eventsAndMetadata.length > 3) {
                                @for (eventAndMetadata of day.firstTwoEventsAndMetadata; track eventAndMetadata.event.id) {
                                    <ng-container *ngTemplateOutlet="eventCell; context: { $implicit: eventAndMetadata }" />
                                }
                                <div class="ellipsis">
                                    <span class="dot"></span>
                                    <span class="dot"></span>
                                    <span class="dot"></span>
                                </div>
                            } @else {
                                @for (eventAndMetadata of day.eventsAndMetadata; track eventAndMetadata.event.id) {
                                    <ng-container *ngTemplateOutlet="eventCell; context: { $implicit: eventAndMetadata }" />
                                }
                            }
                        </div>
                    </div>
                } @else {
                    <div class="day-placeholder"></div>
                }
            }
        </div>
    }
</div>

<ng-template #eventCell let-eventAndMetadata>
    @let color = eventAndMetadata.color;
    <div class="event-cell" [style.background-color]="color"></div>
</ng-template>
