<div class="frame">
    <div class="header">
        <span class="h3">{{ monthDescription() }}</span>
        <div class="spacer"></div>
        <p-multiSelect
            [options]="filterOptions()"
            [ngModel]="selectedFilterOptions()"
            (ngModelChange)="onSelectionOptionsChange($event)"
            optionLabel="name"
            [placeholder]="filterComponentPlaceholder()"
            [showHeader]="false"
        >
            <ng-template pTemplate="selectedItems">
                @if (selectedFilterOptions().length) {
                    <div class="chips-section">
                        @for (optionWithMetadata of selectedFilterOptions(); track optionWithMetadata.option) {
                            <div class="chip" [attr.data-testid]="'chip-' + optionWithMetadata.option">
                                <div class="legend-circle" [class]="optionWithMetadata.colorClassName"></div>
                                <span>{{ optionWithMetadata.name }}</span>
                                <button class="remove-button" (click)="removeOption(optionWithMetadata.option); $event.stopPropagation()">
                                    <fa-icon [icon]="faXmark" />
                                </button>
                            </div>
                        }
                    </div>
                }
            </ng-template>
        </p-multiSelect>
        <p-selectbutton
            [options]="presentationOptions()"
            [ngModel]="presentation()"
            (ngModelChange)="presentation.set($event)"
            [unselectable]="true"
            optionLabel="label"
            optionValue="value"
            size="small"
            id="presentation-select-button"
        />
        @let currentCourseId = courseId();
        @let subscriptionToken = calendarSubscriptionToken();
        @if (currentCourseId && subscriptionToken) {
            <div>
                <button
                    data-testid="subscribe-button"
                    pButton
                    size="small"
                    outlined
                    (click)="subscriptionPopover.open($event)"
                    jhiTranslate="artemisApp.calendar.subscribeButtonLabel"
                ></button>
                <jhi-calendar-subscription-popover [subscriptionToken]="subscriptionToken" [courseId]="currentCourseId" #subscriptionPopover />
            </div>
        }
        <button id="today-button" pButton size="small" outlined (click)="goToToday()" jhiTranslate="artemisApp.calendar.todayButtonLabel"></button>
        <p-buttongroup>
            <button id="previous-button" pButton size="small" outlined (click)="goToPrevious()">
                <fa-icon [icon]="faChevronLeft" />
            </button>

            <button id="next-button" pButton size="small" outlined (click)="goToNext()">
                <fa-icon [icon]="faChevronRight" />
            </button>
        </p-buttongroup>
    </div>

    <div class="calendar-presentation-container">
        @if (presentation() === 'month') {
            <jhi-calendar-desktop-month-presentation [firstDateOfCurrentMonth]="firstDateOfCurrentMonth()" />
        } @else {
            <jhi-calendar-desktop-week-presentation [firstDayOfCurrentWeek]="firstDateOfCurrentWeek()" />
        }
        @if (isLoading()) {
            <div class="loading-overlay">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden" jhiTranslate="loading"></span>
                </div>
            </div>
        }
    </div>
</div>
