<p-dialog [(visible)]="visible" [modal]="true" [closable]="true" [dismissableMask]="true" [draggable]="false" [appendTo]="'body'" [style]="{ width: '35dvw' }">
    <ng-template #header>
        @if (health(); as h) {
            <h4 id="showHealthLabel">
                {{ 'health.indicator.' + h.key | artemisTranslate }}
            </h4>
        }
    </ng-template>
    @if (health(); as h) {
        <div>
            <h5 jhiTranslate="health.details.properties"></h5>
            <div class="table-responsive">
                <table class="table table-striped" aria-describedby="showHealthLabel">
                    <thead>
                        <tr>
                            <th scope="col" class="text-left" jhiTranslate="health.details.name"></th>
                            <th scope="col" class="text-left" jhiTranslate="health.details.value"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (healthDetail of h.value.details! | keyvalue; track healthDetail) {
                            <tr>
                                <td class="text-left align-top">{{ healthDetail.key }}</td>
                                <td class="text-left">
                                    @if (isBuildAgentsArray(healthDetail.value, healthDetail.key)) {
                                        <!-- Special formatting for LocalCI build agents -->
                                        <div class="build-agents-health">
                                            @for (agent of formatBuildAgents(healthDetail.value, healthDetail.key); track agent.name) {
                                                <div class="build-agent-card mb-3 p-2 border rounded">
                                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                                        <strong>{{ agent.displayName }}</strong>
                                                        <span class="badge" [ngClass]="getStatusBadgeClass(agent.status)">{{ agent.status }}</span>
                                                    </div>
                                                    <div class="small text-muted mb-1">
                                                        <span class="me-3">{{ agent.name }}</span>
                                                        <span>{{ agent.memberAddress }}</span>
                                                    </div>
                                                    <div class="mb-1">
                                                        <span class="me-2" jhiTranslate="health.details.jobs"></span>
                                                        <strong>{{ agent.currentJobs }}</strong> / {{ agent.maxJobs }}
                                                    </div>
                                                    @if (agent.runningJobNames.length > 0) {
                                                        <div class="small">
                                                            <span class="text-muted" jhiTranslate="health.details.running"></span>
                                                            @for (jobName of agent.runningJobNames; track jobName; let last = $last) {
                                                                <span class="ms-1">{{ jobName }}{{ last ? '' : ',' }}</span>
                                                            }
                                                        </div>
                                                    }
                                                    @if (agent.gitRevision) {
                                                        <div class="small text-muted mt-1">
                                                            <span jhiTranslate="health.details.version"></span> <span>{{ agent.gitRevision }}</span>
                                                            @if (agent.startDate) {
                                                                <span class="ms-2">| </span>
                                                                <span jhiTranslate="health.details.started"></span>
                                                                <span>{{ agent.startDate }}</span>
                                                            }
                                                        </div>
                                                    }
                                                </div>
                                            } @empty {
                                                <div class="text-muted small" jhiTranslate="health.details.noBuildAgents"></div>
                                            }
                                        </div>
                                    } @else {
                                        <span [ngStyle]="{ 'white-space': 'pre-line' }">{{ readableValue(healthDetail.value) }}</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    <ng-template #footer>
        <button class="btn btn-secondary float-left" type="button" (click)="dismiss()">Done</button>
    </ng-template>
</p-dialog>
