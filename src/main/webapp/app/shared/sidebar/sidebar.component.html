<div class="d-flex sidebar rounded-3 px-3 sidebar-width hide-on_print" [ngClass]="{ 'sidebar-height-dev': !isProduction || isTestServer, collapsed: isCollapsed }">
    <div class="w-100 bg-module">
        <div class="sidebar-content" [ngClass]="{ collapsed: isCollapsed }">
            @if (searchFieldEnabled) {
                <div class="mt-2 mb-2">
                    <jhi-search-filter (newSearchEvent)="setSearchValue($event)" class="mb-2" />
                    @if (showFilter) {
                        <div class="ms-2 mt-1 text-primary">
                            <a (click)="openFilterExercisesDialog()">
                                @if (isFilterActive) {
                                    <fa-icon [icon]="faFilterCurrentlyApplied" />
                                } @else {
                                    <fa-icon [icon]="faFilter" />
                                }
                                <span jhiTranslate="artemisApp.courseOverview.exerciseFilter.filter"></span>
                            </a>
                        </div>
                    }
                </div>
            }
            @if (inCommunication) {
                <div class="row g-1 mb-1">
                    <div class="col-6">
                        <div class="dropdown-container">
                            <button type="button" class="btn btn-primary" (click)="toggleChatDropdown()" jhiTranslate="artemisApp.courseOverview.sidebar.createChat"></button>

                            <div [hidden]="!showChatDropdown" class="dropdown-menu">
                                <button (click)="createDirectChat()" class="dropdown-item" jhiTranslate="artemisApp.courseOverview.sidebar.createDirectChat"></button>
                                <button (click)="createGroupChat()" class="dropdown-item" jhiTranslate="artemisApp.courseOverview.sidebar.createGroupChat"></button>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="dropdown-container">
                            <button
                                type="button"
                                class="btn btn-secondary w-100"
                                (click)="toggleChannelDropdown()"
                                jhiTranslate="artemisApp.courseOverview.sidebar.addChannel"
                            ></button>
                            <div [hidden]="!showChannelDropdown" class="dropdown-menu">
                                <button (click)="createNewChannel()" class="dropdown-item" jhiTranslate="artemisApp.courseOverview.sidebar.createChannel"></button>
                                <button (click)="browseChannels()" class="dropdown-item" jhiTranslate="artemisApp.courseOverview.sidebar.browseChannels"></button>
                            </div>
                        </div>
                    </div>
                </div>
            }

            @if (!sidebarData?.ungroupedData || !(sidebarData?.ungroupedData | searchFilter: ['title', 'type'] : searchValue)?.length) {
                <div
                    [ngClass]="{ 'content-height-dev': !isProduction || isTestServer }"
                    [jhiTranslate]="
                        (sidebarDataBeforeFiltering?.ungroupedData?.length ?? 0) > 0 && sidebarData.ungroupedData?.length === 0
                            ? 'artemisApp.courseOverview.general.noElementFoundWithAppliedFilter'
                            : 'artemisApp.courseOverview.general.noDataFound'
                    "
                    class="mt-2 text-center scrollable-item-content"
                ></div>
            } @else {
                <div
                    class="scrollable-item-content my-2"
                    [ngClass]="{
                        'content-height-dev': !isProduction || isTestServer,
                        'search-height-conversations': sidebarData?.sidebarType === 'conversation',
                        'search-height-normal': sidebarData?.sidebarType !== 'conversation',
                    }"
                >
                    @if (sidebarData?.groupByCategory && sidebarData.groupedData) {
                        <jhi-sidebar-accordion
                            [searchValue]="searchValue"
                            [groupedData]="sidebarData.groupedData"
                            [sidebarType]="sidebarData.sidebarType"
                            [storageId]="sidebarData.storageId"
                            [routeParams]="routeParams"
                            [courseId]="courseId"
                            [itemSelected]="itemSelected"
                            [showLeadingIcon]="sidebarData.showAccordionLeadingIcon ?? false"
                            [channelTypeIcon]="channelTypeIcon"
                            [collapseState]="collapseState"
                            (onUpdateSidebar)="onUpdateSidebar.emit()"
                            [isFilterActive]="isFilterActive"
                        />
                    } @else {
                        @for (sidebarItem of sidebarData?.ungroupedData | searchFilter: ['title', 'type'] : searchValue; track sidebarItem; let last = $last) {
                            <div [ngClass]="{ 'mb-2': !last }">
                                <div
                                    jhiSidebarCard
                                    [size]="sidebarItem.size"
                                    [itemSelected]="itemSelected"
                                    [sidebarType]="sidebarData.sidebarType"
                                    [sidebarItem]="sidebarItem"
                                ></div>
                            </div>
                        }
                    }
                </div>
            }
        </div>
    </div>
</div>
