<div
    #wrapper
    class="markdown-editor-wrapper"
    [style.overflow]="inPreviewMode ? 'auto' : 'hidden'"
    [style.height.px]="inPreviewMode ? undefined : targetWrapperHeight"
    [style.height.%]="targetWrapperHeight ? undefined : 100"
>
    <nav ngbNav #actionPalette #nav="ngbNav" class="nav-tabs" [destroyOnHide]="false" (navChange)="onNavChanged($event)">
        <!-- TODO if show edit -->
        <ng-container ngbNavItem="editor_edit">
            <a ngbNavLink class="btn-sm text-normal px-2 py-0 m-0"><span jhiTranslate="entity.action.edit"></span></a>
            <ng-template ngbNavContent>
                <div
                    class="markdown-editor-wrapper d-grid"
                    [style.grid-template-columns]="'auto'"
                    style="overflow: clip !important"
                    class="height-100 markdown-editor d-flex flex-column"
                >
                    <jhi-monaco-editor class="h-100" [shrinkToFit]="false" [stickyScroll]="false" (textChanged)="onTextChanged($event)" (drop)="onFileDrop($event)" />
                    @if (enableFileUpload) {
                        <div class="d-flex" #fileUploadFooter>
                            <input
                                [id]="'file-upload ' + uniqueMarkdownEditorId"
                                class="file-upload-footer-input"
                                type="file"
                                accept="image/*"
                                [multiple]="true"
                                (change)="onFileUpload($event)"
                            />
                            <label [for]="'file-upload ' + uniqueMarkdownEditorId" class="file-upload-footer-label d-inline">
                                <div class="row mx-0 align-items-baseline">
                                    <span class="col upload-subtitle">{{ 'artemisApp.markdownEditor.fileUpload' | artemisTranslate }}</span>
                                    <a class="col-auto" href="http://demo.showdownjs.com">
                                        <fa-icon [icon]="faQuestionCircle" [ngbTooltip]="'artemisApp.markdownEditor.guide' | artemisTranslate" />
                                    </a>
                                </div>
                            </label>
                        </div>
                    }
                </div>
            </ng-template>
        </ng-container>
        <ng-container ngbNavItem="editor_preview">
            <a ngbNavLink class="btn-sm text-normal px-2 py-0 m-0"><span jhiTranslate="entity.action.preview"></span></a>
            <ng-template ngbNavContent>
                <ng-content class="overflow-auto" select="[#previewMonaco]" />
                <!-- TODO preview handling for other exercise types -->
            </ng-template>
        </ng-container>
        @if (!inPreviewMode) {
            <ng-container ngbNavItem>
                <div class="markdown-editor__commands">
                    <div class="markdown-editor__commands-default">
                        <!-- Default -->
                        @for (action of defaultActions; track action) {
                            <button
                                type="button"
                                class="btn btn-sm py-0"
                                [ngbTooltip]="action.icon ? (action.translationKey | artemisTranslate) : undefined"
                                (click)="triggerAction(action.id)"
                            >
                                @if (action.icon) {
                                    <fa-icon [icon]="action.icon" />
                                } @else {
                                    <span [jhiTranslate]="action.translationKey"></span>
                                }
                            </button>
                        }
                        <!-- Headers -->
                        @if (headerActions.actions.length > 0) {
                            <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
                                <button class="btn btn-sm px-2 py-0" type="button" id="dropdownBasic1" ngbDropdownToggle>
                                    <span [jhiTranslate]="headerActions.translationKey"></span>
                                </button>
                                <div class="dropdown-menu" ngbDropdownMenu>
                                    @for (action of headerActions.actions; track action) {
                                        <button type="button" class="dropdown-item" (click)="triggerAction(action.id)">
                                            <span [jhiTranslate]="action.translationKey"></span>
                                        </button>
                                    }
                                </div>
                            </div>
                        }
                        <!-- Color -->
                        @if (colorAction) {
                            <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
                                <button class="btn btn-sm px-2 py-0" type="button" ngbDropdownToggle>
                                    <span [jhiTranslate]="colorAction.translationKey"></span>
                                </button>
                                <div class="dropdown-menu markdown-color-picker" ngbDropdownMenu>
                                    @for (color of colorAction.possibleValues; track color) {
                                        <button type="button" class="dropdown-item" (click)="triggerAction(colorAction.id, color)">
                                            <span>{{ color }}</span>
                                        </button>
                                    }
                                </div>
                            </div>
                        }
                        <!-- Domain -->
                        @if (domainActions?.length) {
                            <div class="d-inline-flex">
                                @for (action of domainActions; track action) {
                                    @if (action['possibleValues']) {
                                        <!-- dropdown -->
                                        <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown">
                                            <button class="btn btn-sm px-2 py-0" type="button" ngbDropdownToggle>
                                                <span [jhiTranslate]="action.translationKey"></span>
                                            </button>
                                            <div class="dropdown-menu" ngbDropdownMenu>
                                                @for (value of action['possibleValues']; track value) {
                                                    <button type="button" class="dropdown-item" (click)="triggerAction(action.id, value.value)">
                                                        <span>{{ value.value }}</span>
                                                    </button>
                                                }
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        }
                    </div>
                </div>
            </ng-container>
        }
    </nav>
    <div [ngbNavOutlet]="nav"></div>
</div>
